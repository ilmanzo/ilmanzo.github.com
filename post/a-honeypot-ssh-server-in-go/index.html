<!doctype html><html lang=en><head><title>a honeypot ssh server in Go &ndash; ilManzo's blog</title><meta name=description content="A minimalist, pragmatic website and personal blog"><meta name=viewport content="width=device-width,initial-scale=1"><meta charset=utf-8><link rel=stylesheet href=https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.2/css/all.min.css integrity="sha512-HK5fgLBL+xu6dm/Ii3z4xhlSUyZgTT9tuc/hSrtw6uzJOvgRr2a9jyxxT1ely+B+xFAmJKVSTbpM/CuL7qxO8w==" crossorigin=anonymous><link rel=stylesheet href=https://cdnjs.cloudflare.com/ajax/libs/academicons/1.9.1/css/academicons.min.css integrity="sha512-b1ASx0WHgVFL5ZQhTgiPWX+68KjS38Jk87jg7pe+qC7q9YkEtFq0z7xCglv7qGIs/68d3mAp+StfC8WKC5SSAg==" crossorigin=anonymous><link rel=stylesheet href=https://ilmanzo.github.io/css/colour/gruvbox-dark.css><link rel=stylesheet href=https://ilmanzo.github.io/css/colour/dark-mode.css><link rel=stylesheet href=https://ilmanzo.github.io/css/risotto.css><link rel=stylesheet href=https://ilmanzo.github.io/css/custom.css></head><body><div class=page><header class=page__header><h1 class=page__logo><a href=https://ilmanzo.github.io/ class=page__logo-inner>ilManzo's blog</a></h1><nav class="page__nav main-nav"><ul><li class=main-nav__item><a class=nav-main-item href=/curriculum title>Curriculum</a></li><li class=main-nav__item><a class=nav-main-item href=/categories title>Categories</a></li><li class=main-nav__item><a class=nav-main-item href=/tags title>Tags</a></li><li class=main-nav__item><a class="nav-main-item active" href=/post/ title=Posts>Posts</a></li></ul></nav></header><section class=page__body><header class=content__header><h1>a honeypot ssh server in Go</h1></header><div class=content__body><h2 id=honey-ssh-pot>honey-ssh-pot</h2><p>Curious about who and how attempts ssh login to your home server ? Me too&mldr; So I wrote a very simple ssh honeypot, just to collect interesting info about the kind guys who knocks my door :)</p><p>warning: this is safe, but don&rsquo;t run the service (well, ANY service) as root user. Even better if you can run it as a dedicate unprivileged user.</p><p>This program is only for didactic use and not intended for deployment in a production network environment.</p><p>If you want to have it exposed on the public internet, you must map port 22 of your wan router to the internal server port ( 2222 by default)&mldr; Do it at your risk!</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#f92672>package</span> <span style=color:#a6e22e>main</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> (
</span></span><span style=display:flex><span>        <span style=color:#e6db74>&#34;github.com/gliderlabs/ssh&#34;</span> 
</span></span><span style=display:flex><span>        <span style=color:#e6db74>&#34;io&#34;</span>
</span></span><span style=display:flex><span>        <span style=color:#e6db74>&#34;log&#34;</span>
</span></span><span style=display:flex><span>        <span style=color:#e6db74>&#34;log/syslog&#34;</span>
</span></span><span style=display:flex><span>        <span style=color:#e6db74>&#34;os&#34;</span>
</span></span><span style=display:flex><span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>// this is the function called when ssh client requests authentication
</span></span></span><span style=display:flex><span><span style=color:#75715e>// here we log attacker credentials on purpose
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>func</span> <span style=color:#a6e22e>authHandler</span>(<span style=color:#a6e22e>ctx</span> <span style=color:#a6e22e>ssh</span>.<span style=color:#a6e22e>Context</span>, <span style=color:#a6e22e>password</span> <span style=color:#66d9ef>string</span>) <span style=color:#66d9ef>bool</span> {
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>log</span>.<span style=color:#a6e22e>Printf</span>(<span style=color:#e6db74>&#34;User: %s connecting from %s with password: %s\n&#34;</span>, 
</span></span><span style=display:flex><span>          <span style=color:#a6e22e>ctx</span>.<span style=color:#a6e22e>User</span>(), <span style=color:#a6e22e>ctx</span>.<span style=color:#a6e22e>RemoteAddr</span>(), <span style=color:#a6e22e>password</span>)
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> <span style=color:#66d9ef>true</span>
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>// dear guest, your ssh session will be very short...
</span></span></span><span style=display:flex><span><span style=color:#75715e>// to free up resources we only send a message and quit
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>func</span> <span style=color:#a6e22e>sessionHandler</span>(<span style=color:#a6e22e>s</span> <span style=color:#a6e22e>ssh</span>.<span style=color:#a6e22e>Session</span>) {
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>io</span>.<span style=color:#a6e22e>WriteString</span>(<span style=color:#a6e22e>s</span>, <span style=color:#e6db74>&#34;Welcome!\n&#34;</span>)
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>func</span> <span style=color:#a6e22e>main</span>() {
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#75715e>// Configure logger to write to the syslog
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>        <span style=color:#a6e22e>logwriter</span>, <span style=color:#a6e22e>e</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>syslog</span>.<span style=color:#a6e22e>New</span>(<span style=color:#a6e22e>syslog</span>.<span style=color:#a6e22e>LOG_INFO</span>, <span style=color:#a6e22e>os</span>.<span style=color:#a6e22e>Args</span>[<span style=color:#ae81ff>0</span>])
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>if</span> <span style=color:#a6e22e>e</span> <span style=color:#f92672>==</span> <span style=color:#66d9ef>nil</span> {
</span></span><span style=display:flex><span>                <span style=color:#a6e22e>log</span>.<span style=color:#a6e22e>SetOutput</span>(<span style=color:#a6e22e>logwriter</span>)
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>s</span> <span style=color:#f92672>:=</span> <span style=color:#f92672>&amp;</span><span style=color:#a6e22e>ssh</span>.<span style=color:#a6e22e>Server</span>{
</span></span><span style=display:flex><span>                <span style=color:#a6e22e>Addr</span>:            <span style=color:#e6db74>&#34;:2222&#34;</span>,
</span></span><span style=display:flex><span>                <span style=color:#a6e22e>Handler</span>:         <span style=color:#a6e22e>sessionHandler</span>,
</span></span><span style=display:flex><span>                <span style=color:#a6e22e>PasswordHandler</span>: <span style=color:#a6e22e>authHandler</span>,
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>log</span>.<span style=color:#a6e22e>Println</span>(<span style=color:#e6db74>&#34;starting ssh server on port 2222...&#34;</span>)
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>log</span>.<span style=color:#a6e22e>Fatal</span>(<span style=color:#a6e22e>s</span>.<span style=color:#a6e22e>ListenAndServe</span>())
</span></span><span style=display:flex><span>}</span></span></code></pre></div><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>$ git clone https://github.com/ilmanzo/honey-ssh-pot.git
</span></span><span style=display:flex><span>$ go get github.com/gliderlabs/ssh
</span></span><span style=display:flex><span>$ go build -ldflags<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;-s -w&#34;</span> <span style=color:#75715e># makes a smaller binary</span>
</span></span><span style=display:flex><span>$ ./honey-ssh-pot </span></span></code></pre></div><p>now get some popcorn and watch on your syslog :)</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>$ tail -f /var/log/messages
</span></span><span style=display:flex><span>./honey-ssh-pot<span style=color:#f92672>[</span>24125<span style=color:#f92672>]</span>: 2018/06/26 21:50:09 starting ssh server on port 2222...
</span></span><span style=display:flex><span>./honey-ssh-pot<span style=color:#f92672>[</span>24125<span style=color:#f92672>]</span>: 2018/06/26 21:50:40 User: evilhacker connecting from 127.0.0.1:51182 with password: secretpassword</span></span></code></pre></div><p>credits to <a href=https://github.com/gliderlabs>gliderlabs</a> for the awesome ssh wrapper package. Thank you guys !</p></div><footer class=content__footer></footer></section><section class=page__aside><div class=aside__about><div class=aside__about><img class=about__logo src=https://ilmanzo.github.io/images/rice.svg alt=Logo><h1 class=about__title>Andrea Manzini</h1><p class=about__description>A minimalist, pragmatic website and personal blog</p></div><ul class=aside__social-links><li><a href=https://github.com/ilmanzo rel=me aria-label=GitHub title=GitHub><i class="fab fa-github" aria-hidden=true></i></a>&nbsp;</li><li><a href=mailto:ilmanzo@gmail.com rel=me aria-label=Email title=Email><i class="fas fa-envelope" aria-hidden=true></i></a>&nbsp;</li><li><a href=https://www.linkedin.com/in/andreamanzini rel=me aria-label=Linkedin title=Linkedin><i class="fab fa-linkedin" aria-hidden=true></i></a>&nbsp;</li><li><a href=https://twitter.com/ilmanzo rel=me aria-label=Twitter title=Twitter><i class="fab fa-twitter" aria-hidden=true></i></a>&nbsp;</li><li><a href=https://ilmanzo.github.io/index.xml rel=me aria-label="RSS Feed" title="RSS Feed"><i class="fas fa-rss-square" aria-hidden=true></i></a>&nbsp;</li></ul></div><hr><div class=aside__content><p>a fake ssh server that works as a honeypot, written in Go</p><p>By Andrea Manzini,
2018-06-26</p></div></section><footer class=page__footer><p class=copyright>© 2022 Andrea Manzini</p><p class=advertisement>Powered by <a href=https://gohugo.io/>hugo</a> and <a href=https://github.com/joeroe/risotto>risotto</a>.</p><script async src="https://www.googletagmanager.com/gtag/js?id=G-6PN4FTRLNL"></script>
<script>var doNotTrack=!1;if(!doNotTrack){window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-6PN4FTRLNL",{anonymize_ip:!1})}</script></footer></div></body></html>