<!doctype html><html lang=en dir=auto><head><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>Playing with Rust on ARM architecture | ilManzo's blog</title>
<meta name=keywords content="rust,device,programming,arm"><meta name=description content="Easy cross compilation for everyone"><meta name=author content="Andrea Manzini"><link rel=canonical href=https://ilmanzo.github.io/post/experiments_with_rust_on_arm_architecture/><link crossorigin=anonymous href=/assets/css/stylesheet.b609c58d5c11bb90b1a54e04005d74ad1ddf22165eb79f5533967e57df9c3b50.css integrity="sha256-tgnFjVwRu5CxpU4EAF10rR3fIhZet59VM5Z+V9+cO1A=" rel="preload stylesheet" as=style><link rel=icon href=https://ilmanzo.github.io/favicon.ico><link rel=icon type=image/png sizes=16x16 href=https://ilmanzo.github.io/favicon-16x16.png><link rel=icon type=image/png sizes=32x32 href=https://ilmanzo.github.io/favicon-32x32.png><link rel=apple-touch-icon href=https://ilmanzo.github.io/apple-touch-icon.png><link rel=mask-icon href=https://ilmanzo.github.io/safari-pinned-tab.svg><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><link rel=alternate hreflang=en href=https://ilmanzo.github.io/post/experiments_with_rust_on_arm_architecture/><noscript><style>#theme-toggle,.top-link{display:none}</style></noscript><script async src="https://www.googletagmanager.com/gtag/js?id=G-6PN4FTRLNL"></script><script>var doNotTrack=!1;if(!doNotTrack){window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-6PN4FTRLNL",{anonymize_ip:!1})}</script><meta property="og:title" content="Playing with Rust on ARM architecture"><meta property="og:description" content="Easy cross compilation for everyone"><meta property="og:type" content="article"><meta property="og:url" content="https://ilmanzo.github.io/post/experiments_with_rust_on_arm_architecture/"><meta property="article:section" content="post"><meta property="article:published_time" content="2024-03-01T00:00:00+00:00"><meta property="article:modified_time" content="2024-03-01T00:00:00+00:00"><meta name=twitter:card content="summary"><meta name=twitter:title content="Playing with Rust on ARM architecture"><meta name=twitter:description content="Easy cross compilation for everyone"><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Posts","item":"https://ilmanzo.github.io/post/"},{"@type":"ListItem","position":2,"name":"Playing with Rust on ARM architecture","item":"https://ilmanzo.github.io/post/experiments_with_rust_on_arm_architecture/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"Playing with Rust on ARM architecture","name":"Playing with Rust on ARM architecture","description":"Easy cross compilation for everyone","keywords":["rust","device","programming","arm"],"articleBody":"An old find I found an old cubieboard3 (cubietruck) collecting dust in a drawer, so I took the chance to try out Rust cross compilation and collect here some notes about the process. Hereâ€™s the baby:\nGive it a penguin First of all, I installed an ARM linux distro on a MicroSD card and started the device:\n[user@arm ~]$ cat /proc/cpuinfo processor\t: 0 model name\t: ARMv7 Processor rev 4 (v7l) BogoMIPS\t: 50.52 Features\t: half thumb fastmult vfp edsp thumbee neon vfpv3 tls vfpv4 idiva idivt vfpd32 lpae evtstrm CPU implementer\t: 0x41 CPU architecture: 7 CPU variant\t: 0x0 CPU part\t: 0xc07 CPU revision\t: 4 processor\t: 1 model name\t: ARMv7 Processor rev 4 (v7l) BogoMIPS\t: 50.52 Features\t: half thumb fastmult vfp edsp thumbee neon vfpv3 tls vfpv4 idiva idivt vfpd32 lpae evtstrm CPU implementer\t: 0x41 CPU architecture: 7 CPU variant\t: 0x0 CPU part\t: 0xc07 CPU revision\t: 4 Hardware\t: Allwinner sun7i (A20) Family Revision\t: 0000 So our device is ARM model v7l ; this means is a 32bit CPU, if you are curious thereâ€™s also a reference manual around. Now we will work from a development machine.\nGet Rusty Letâ€™s check rust support:\n[x86]$ rustup target list | grep armv7 armv7-linux-androideabi armv7-unknown-linux-gnueabi armv7-unknown-linux-gnueabihf armv7-unknown-linux-musleabi armv7-unknown-linux-musleabihf armv7a-none-eabi armv7r-none-eabi armv7r-none-eabihf Plenty of options! Iâ€™d leave out android and musl variants for now.\n[x86]$ cargo init tryarm Created binary (application) package [x86]$ cd tryarm [x86]$ cargo build --target armv7-unknown-linux-gnueabihf error: could not compile `tryarm` (bin \"tryarm\") due to 1 previous error Please retry Seems not sufficient â€¦ Letâ€™s try cross tool from the rust embedded team\n[x86]$ cargo install cross [x86]$ /home/andrea/.cargo/bin/cross build --target armv7-unknown-linux-gnueabihf Trying to pull ghcr.io/cross-rs/armv7-unknown-linux-gnueabihf:0.2.5... Getting image source signatures Copying blob 5b4afa60d436 [===============================\u003e------] 146.3MiB / 172.0MiB | 6.6 M Copying blob 5b4afa60d436 done | Copying blob 58690f9b18fc done | Copying blob da8ef40b9eca done | Copying blob b51569e7c507 done | Copying blob 6c052f8b0b21 done | Copying blob fb15d46c38dc done | Copying blob 5afa4c181482 done | Copying blob b9d42a766612 done | Copying blob cc716323c93e done | Copying blob fe4038eab07b done | Copying blob 4accd797f995 done | Copying blob 3db4794ce9a5 done | Copying blob 8b1f228d2fc0 done | Copying blob 05f315b1fff9 done | Copying blob c0190749220c done | Copying blob 55483985fe64 done | Copying blob df8b7a9f8281 done | Copying blob 9de25b0c2608 done | Copying config 32cf786140 done | Writing manifest to image destination Compiling tryarm v0.1.0 (/project) Finished dev [unoptimized + debuginfo] target(s) in 0.26s This tool pulls a container with the right compiler toolchain and use it to build your project. Seems our program is in place, and itâ€™s compiled!\n[x86]$ file target/armv7-unknown-linux-gnueabihf/debug/tryarm target/armv7-unknown-linux-gnueabihf/debug/tryarm: ELF 32-bit LSB pie executable, ARM, EABI5 version 1 (SYSV), dynamically linked, interpreter /lib/ld-linux-armhf.so.3, for GNU/Linux 3.2.0, BuildID[sha1]=7ff3fc41deb8b4820cc64ff2857cddbfa577111c, with debug_info, not stripped [x86]$ objdump -d target/armv7-unknown-linux-gnueabihf/debug/tryarm 3428: e59d300c ldr r3, [sp, #12] 342c: e0802080 add r2, r0, r0, lsl #1 3430: e08b108b add r1, fp, fp, lsl #1 3434: e1a09003 mov r9, r3 3438: e1a00003 mov r0, r3 343c: e7b91181 ldr r1, [r9, r1, lsl #3]! 3440: e7b02182 ldr r2, [r0, r2, lsl #3]! 3444: e5993004 ldr r3, [r9, #4] 3448: e5904004 ldr r4, [r0, #4] 344c: e0521001 subs r1, r2, r1 3450: e0d41003 sbcs r1, r4, r3 Run baby run So, letâ€™s transfer our binary to the device and run it\n[x86]$ scp target/armv7-unknown-linux-gnueabihf/debug/tryarm user@cubietruck:/home/user user@cubietruck's password: tryarm 100% 3443KB 5.3MB/s 00:00 Switching to the device shell:\n[user@arm ~]$ ./tryarm Hello, world! [user@arm ~]$ ldd tryarm linux-vdso.so.1 (0xbefbd000) libgcc_s.so.1 =\u003e /usr/lib/libgcc_s.so.1 (0xb6e40000) librt.so.1 =\u003e /usr/lib/librt.so.1 (0xb6e20000) libpthread.so.0 =\u003e /usr/lib/libpthread.so.0 (0xb6e00000) libdl.so.2 =\u003e /usr/lib/libdl.so.2 (0xb6de0000) libc.so.6 =\u003e /usr/lib/libc.so.6 (0xb6c40000) /lib/ld-linux-armhf.so.3 =\u003e /usr/lib/ld-linux-armhf.so.3 (0xb6eda000) Itâ€™s working ðŸ˜„\nFuture awaits We are able to compile and run Rust code on our little device, so this Proof of Concept is over. In the future we will use it to develop and test software on a foreign architecture.\nSome resources for further reference:\nhttps://www.modio.se/cross-compiling-rust-binaries-to-armv7.html ","wordCount":"657","inLanguage":"en","datePublished":"2024-03-01T00:00:00Z","dateModified":"2024-03-01T00:00:00Z","author":{"@type":"Person","name":"Andrea Manzini"},"mainEntityOfPage":{"@type":"WebPage","@id":"https://ilmanzo.github.io/post/experiments_with_rust_on_arm_architecture/"},"publisher":{"@type":"Organization","name":"ilManzo's blog","logo":{"@type":"ImageObject","url":"https://ilmanzo.github.io/favicon.ico"}}}</script></head><body class=dark id=top><script>localStorage.getItem("pref-theme")==="light"&&document.body.classList.remove("dark")</script><header class=header><nav class=nav><div class=logo><a href=https://ilmanzo.github.io/ accesskey=h title="ilManzo's blog (Alt + H)">ilManzo's blog</a><div class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)"><svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button><ul class=lang-switch><li>|</li></ul></div></div><ul id=menu><li><a href=https://ilmanzo.github.io/curriculum title=Curriculum><span>Curriculum</span></a></li><li><a href=https://ilmanzo.github.io/tags title=Tags><span>Tags</span></a></li><li><a href=https://ilmanzo.github.io/categories title=Categories><span>Categories</span></a></li><li><a href=https://ilmanzo.github.io/search title="Search (Alt + /)" accesskey=/><span>Search</span></a></li><li><a href=https://ilmanzo.github.io/archives/ title><span></span></a></li><li><a href=https://ilmanzo.github.io/post/ title=Posts><span>Posts</span></a></li></ul></nav></header><main class=main><article class=post-single><header class=post-header><div class=breadcrumbs><a href=https://ilmanzo.github.io/>Home</a>&nbsp;Â»&nbsp;<a href=https://ilmanzo.github.io/post/>Posts</a></div><h1 class="post-title entry-hint-parent">Playing with Rust on ARM architecture</h1><div class=post-description>Easy cross compilation for everyone</div><div class=post-meta><span title='2024-03-01 00:00:00 +0000 UTC'>March 1, 2024</span>&nbsp;Â·&nbsp;Andrea Manzini</div></header><div class=post-content><h3 id=an-old-find>An old find<a hidden class=anchor aria-hidden=true href=#an-old-find>#</a></h3><p>I found an old <a href=http://cubieboard.org/tag/cubietruck/>cubieboard3 (cubietruck)</a> collecting dust in a drawer, so I took the chance to try out Rust cross compilation and collect here some notes about the process. Here&rsquo;s the baby:</p><p><img loading=lazy src=/img/cubietruck.jpg alt=cubietruck></p><h3 id=give-it-a-penguin>Give it a penguin<a hidden class=anchor aria-hidden=true href=#give-it-a-penguin>#</a></h3><p>First of all, I installed an ARM linux distro on a MicroSD card and started the device:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#f92672>[</span>user@arm ~<span style=color:#f92672>]</span>$ cat /proc/cpuinfo 
</span></span><span style=display:flex><span>processor	: <span style=color:#ae81ff>0</span>
</span></span><span style=display:flex><span>model name	: ARMv7 Processor rev <span style=color:#ae81ff>4</span> <span style=color:#f92672>(</span>v7l<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>BogoMIPS	: 50.52
</span></span><span style=display:flex><span>Features	: half thumb fastmult vfp edsp thumbee neon vfpv3 tls vfpv4 idiva idivt vfpd32 lpae evtstrm 
</span></span><span style=display:flex><span>CPU implementer	: 0x41
</span></span><span style=display:flex><span>CPU architecture: <span style=color:#ae81ff>7</span>
</span></span><span style=display:flex><span>CPU variant	: 0x0
</span></span><span style=display:flex><span>CPU part	: 0xc07
</span></span><span style=display:flex><span>CPU revision	: <span style=color:#ae81ff>4</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>processor	: <span style=color:#ae81ff>1</span>
</span></span><span style=display:flex><span>model name	: ARMv7 Processor rev <span style=color:#ae81ff>4</span> <span style=color:#f92672>(</span>v7l<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>BogoMIPS	: 50.52
</span></span><span style=display:flex><span>Features	: half thumb fastmult vfp edsp thumbee neon vfpv3 tls vfpv4 idiva idivt vfpd32 lpae evtstrm 
</span></span><span style=display:flex><span>CPU implementer	: 0x41
</span></span><span style=display:flex><span>CPU architecture: <span style=color:#ae81ff>7</span>
</span></span><span style=display:flex><span>CPU variant	: 0x0
</span></span><span style=display:flex><span>CPU part	: 0xc07
</span></span><span style=display:flex><span>CPU revision	: <span style=color:#ae81ff>4</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>Hardware	: Allwinner sun7i <span style=color:#f92672>(</span>A20<span style=color:#f92672>)</span> Family
</span></span><span style=display:flex><span>Revision	: <span style=color:#ae81ff>0000</span>
</span></span></code></pre></div><p>So our device is ARM model <code>v7l</code> ; this means is a 32bit CPU, if you are curious there&rsquo;s also a <a href=https://dl.linux-sunxi.org/A20/A20%20User%20Manual%202013-03-22.pdf>reference manual</a> around. Now we will work from a development machine.</p><h3 id=get-rusty>Get Rusty<a hidden class=anchor aria-hidden=true href=#get-rusty>#</a></h3><p>Let&rsquo;s check rust support:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#f92672>[</span>x86<span style=color:#f92672>]</span>$ rustup target list | grep armv7
</span></span><span style=display:flex><span>armv7-linux-androideabi
</span></span><span style=display:flex><span>armv7-unknown-linux-gnueabi
</span></span><span style=display:flex><span>armv7-unknown-linux-gnueabihf
</span></span><span style=display:flex><span>armv7-unknown-linux-musleabi
</span></span><span style=display:flex><span>armv7-unknown-linux-musleabihf
</span></span><span style=display:flex><span>armv7a-none-eabi
</span></span><span style=display:flex><span>armv7r-none-eabi
</span></span><span style=display:flex><span>armv7r-none-eabihf
</span></span></code></pre></div><p>Plenty of options! I&rsquo;d leave out android and musl variants for now.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#f92672>[</span>x86<span style=color:#f92672>]</span>$ cargo init tryarm
</span></span><span style=display:flex><span>     Created binary <span style=color:#f92672>(</span>application<span style=color:#f92672>)</span> package
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>x86<span style=color:#f92672>]</span>$ cd tryarm      
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>x86<span style=color:#f92672>]</span>$ cargo build --target armv7-unknown-linux-gnueabihf
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>error: could not compile <span style=color:#e6db74>`</span>tryarm<span style=color:#e6db74>`</span> <span style=color:#f92672>(</span>bin <span style=color:#e6db74>&#34;tryarm&#34;</span><span style=color:#f92672>)</span> due to <span style=color:#ae81ff>1</span> previous error
</span></span></code></pre></div><h3 id=please-retry>Please retry<a hidden class=anchor aria-hidden=true href=#please-retry>#</a></h3><p>Seems not sufficient &mldr; Let&rsquo;s try <a href=https://github.com/rust-embedded/cross>cross tool</a> from the rust embedded team</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#f92672>[</span>x86<span style=color:#f92672>]</span>$ cargo install cross
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>x86<span style=color:#f92672>]</span>$ /home/andrea/.cargo/bin/cross build --target armv7-unknown-linux-gnueabihf
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>Trying to pull ghcr.io/cross-rs/armv7-unknown-linux-gnueabihf:0.2.5...
</span></span><span style=display:flex><span>Getting image source signatures
</span></span><span style=display:flex><span>Copying blob 5b4afa60d436 <span style=color:#f92672>[===============================</span>&gt;------<span style=color:#f92672>]</span> 146.3MiB / 172.0MiB | 6.6 M
</span></span><span style=display:flex><span>Copying blob 5b4afa60d436 <span style=color:#66d9ef>done</span>   | 
</span></span><span style=display:flex><span>Copying blob 58690f9b18fc <span style=color:#66d9ef>done</span>   | 
</span></span><span style=display:flex><span>Copying blob da8ef40b9eca <span style=color:#66d9ef>done</span>   | 
</span></span><span style=display:flex><span>Copying blob b51569e7c507 <span style=color:#66d9ef>done</span>   | 
</span></span><span style=display:flex><span>Copying blob 6c052f8b0b21 <span style=color:#66d9ef>done</span>   | 
</span></span><span style=display:flex><span>Copying blob fb15d46c38dc <span style=color:#66d9ef>done</span>   | 
</span></span><span style=display:flex><span>Copying blob 5afa4c181482 <span style=color:#66d9ef>done</span>   | 
</span></span><span style=display:flex><span>Copying blob b9d42a766612 <span style=color:#66d9ef>done</span>   | 
</span></span><span style=display:flex><span>Copying blob cc716323c93e <span style=color:#66d9ef>done</span>   | 
</span></span><span style=display:flex><span>Copying blob fe4038eab07b <span style=color:#66d9ef>done</span>   | 
</span></span><span style=display:flex><span>Copying blob 4accd797f995 <span style=color:#66d9ef>done</span>   | 
</span></span><span style=display:flex><span>Copying blob 3db4794ce9a5 <span style=color:#66d9ef>done</span>   | 
</span></span><span style=display:flex><span>Copying blob 8b1f228d2fc0 <span style=color:#66d9ef>done</span>   | 
</span></span><span style=display:flex><span>Copying blob 05f315b1fff9 <span style=color:#66d9ef>done</span>   | 
</span></span><span style=display:flex><span>Copying blob c0190749220c <span style=color:#66d9ef>done</span>   | 
</span></span><span style=display:flex><span>Copying blob 55483985fe64 <span style=color:#66d9ef>done</span>   | 
</span></span><span style=display:flex><span>Copying blob df8b7a9f8281 <span style=color:#66d9ef>done</span>   | 
</span></span><span style=display:flex><span>Copying blob 9de25b0c2608 <span style=color:#66d9ef>done</span>   | 
</span></span><span style=display:flex><span>Copying config 32cf786140 <span style=color:#66d9ef>done</span>   | 
</span></span><span style=display:flex><span>Writing manifest to image destination
</span></span><span style=display:flex><span>   Compiling tryarm v0.1.0 <span style=color:#f92672>(</span>/project<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>    Finished dev <span style=color:#f92672>[</span>unoptimized + debuginfo<span style=color:#f92672>]</span> target<span style=color:#f92672>(</span>s<span style=color:#f92672>)</span> in 0.26s
</span></span></code></pre></div><p>This tool pulls a container with the right compiler toolchain and use it to build your project. Seems our program is in place, and it&rsquo;s compiled!</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#f92672>[</span>x86<span style=color:#f92672>]</span>$ file target/armv7-unknown-linux-gnueabihf/debug/tryarm
</span></span><span style=display:flex><span>target/armv7-unknown-linux-gnueabihf/debug/tryarm: ELF 32-bit LSB pie executable, ARM, EABI5 version <span style=color:#ae81ff>1</span> <span style=color:#f92672>(</span>SYSV<span style=color:#f92672>)</span>, dynamically linked, interpreter /lib/ld-linux-armhf.so.3, <span style=color:#66d9ef>for</span> GNU/Linux 3.2.0, BuildID<span style=color:#f92672>[</span>sha1<span style=color:#f92672>]=</span>7ff3fc41deb8b4820cc64ff2857cddbfa577111c, with debug_info, not stripped
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>x86<span style=color:#f92672>]</span>$ objdump -d target/armv7-unknown-linux-gnueabihf/debug/tryarm
</span></span><span style=display:flex><span>    3428:       e59d300c        ldr     r3, <span style=color:#f92672>[</span>sp, <span style=color:#75715e>#12]</span>
</span></span><span style=display:flex><span>    342c:       e0802080        add     r2, r0, r0, lsl <span style=color:#75715e>#1</span>
</span></span><span style=display:flex><span>    3430:       e08b108b        add     r1, fp, fp, lsl <span style=color:#75715e>#1</span>
</span></span><span style=display:flex><span>    3434:       e1a09003        mov     r9, r3
</span></span><span style=display:flex><span>    3438:       e1a00003        mov     r0, r3
</span></span><span style=display:flex><span>    343c:       e7b91181        ldr     r1, <span style=color:#f92672>[</span>r9, r1, lsl <span style=color:#75715e>#3]!</span>
</span></span><span style=display:flex><span>    3440:       e7b02182        ldr     r2, <span style=color:#f92672>[</span>r0, r2, lsl <span style=color:#75715e>#3]!</span>
</span></span><span style=display:flex><span>    3444:       e5993004        ldr     r3, <span style=color:#f92672>[</span>r9, <span style=color:#75715e>#4]</span>
</span></span><span style=display:flex><span>    3448:       e5904004        ldr     r4, <span style=color:#f92672>[</span>r0, <span style=color:#75715e>#4]</span>
</span></span><span style=display:flex><span>    344c:       e0521001        subs    r1, r2, r1
</span></span><span style=display:flex><span>    3450:       e0d41003        sbcs    r1, r4, r3
</span></span></code></pre></div><h3 id=run-baby-run>Run baby run<a hidden class=anchor aria-hidden=true href=#run-baby-run>#</a></h3><p>So, let&rsquo;s transfer our binary to the device and run it</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#f92672>[</span>x86<span style=color:#f92672>]</span>$ scp target/armv7-unknown-linux-gnueabihf/debug/tryarm user@cubietruck:/home/user
</span></span><span style=display:flex><span>user@cubietruck<span style=color:#960050;background-color:#1e0010>&#39;</span>s password: 
</span></span><span style=display:flex><span>tryarm                                                      100% 3443KB   5.3MB/s   00:00 
</span></span></code></pre></div><p>Switching to the device shell:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#f92672>[</span>user@arm ~<span style=color:#f92672>]</span>$ ./tryarm 
</span></span><span style=display:flex><span>Hello, world!
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>user@arm ~<span style=color:#f92672>]</span>$ ldd tryarm 
</span></span><span style=display:flex><span>	linux-vdso.so.1 <span style=color:#f92672>(</span>0xbefbd000<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>	libgcc_s.so.1 <span style=color:#f92672>=</span>&gt; /usr/lib/libgcc_s.so.1 <span style=color:#f92672>(</span>0xb6e40000<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>	librt.so.1 <span style=color:#f92672>=</span>&gt; /usr/lib/librt.so.1 <span style=color:#f92672>(</span>0xb6e20000<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>	libpthread.so.0 <span style=color:#f92672>=</span>&gt; /usr/lib/libpthread.so.0 <span style=color:#f92672>(</span>0xb6e00000<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>	libdl.so.2 <span style=color:#f92672>=</span>&gt; /usr/lib/libdl.so.2 <span style=color:#f92672>(</span>0xb6de0000<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>	libc.so.6 <span style=color:#f92672>=</span>&gt; /usr/lib/libc.so.6 <span style=color:#f92672>(</span>0xb6c40000<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>	/lib/ld-linux-armhf.so.3 <span style=color:#f92672>=</span>&gt; /usr/lib/ld-linux-armhf.so.3 <span style=color:#f92672>(</span>0xb6eda000<span style=color:#f92672>)</span>
</span></span></code></pre></div><p>It&rsquo;s working &#x1f604;</p><h3 id=future-awaits>Future awaits<a hidden class=anchor aria-hidden=true href=#future-awaits>#</a></h3><p>We are able to compile and run Rust code on our little device, so this Proof of Concept is over. In the future we will use it to develop and test software on a foreign architecture.</p><p>Some resources for further reference:</p><ul><li><a href=https://www.modio.se/cross-compiling-rust-binaries-to-armv7.html>https://www.modio.se/cross-compiling-rust-binaries-to-armv7.html</a></li></ul></div><footer class=post-footer><ul class=post-tags><li><a href=https://ilmanzo.github.io/tags/rust/>Rust</a></li><li><a href=https://ilmanzo.github.io/tags/device/>Device</a></li><li><a href=https://ilmanzo.github.io/tags/programming/>Programming</a></li><li><a href=https://ilmanzo.github.io/tags/arm/>Arm</a></li></ul><nav class=paginav><a class=next href=https://ilmanzo.github.io/post/first_steps_of_ltp_linux_test_project/><span class=title>Next Â»</span><br><span>First steps with Linux Test Project</span></a></nav></footer></article></main><footer class=footer><span>Â© 2012-2024 Andrea Manzini</span>
<span>Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
        <a href=https://github.com/adityatelange/hugo-PaperMod/ rel=noopener target=_blank>PaperMod</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg>
</a><script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))})</script><script>document.querySelectorAll("pre > code").forEach(e=>{const n=e.parentNode.parentNode,t=document.createElement("button");t.classList.add("copy-code"),t.innerHTML="copy";function s(){t.innerHTML="copied!",setTimeout(()=>{t.innerHTML="copy"},2e3)}t.addEventListener("click",t=>{if("clipboard"in navigator){navigator.clipboard.writeText(e.textContent),s();return}const n=document.createRange();n.selectNodeContents(e);const o=window.getSelection();o.removeAllRanges(),o.addRange(n);try{document.execCommand("copy"),s()}catch{}o.removeRange(n)}),n.classList.contains("highlight")?n.appendChild(t):n.parentNode.firstChild==n||(e.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName=="TABLE"?e.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(t):e.parentNode.appendChild(t))})</script></body></html>