<!doctype html><html lang=en dir=auto><head><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>Linux Test Project part 2 | ilManzo's blog</title><meta name=keywords content="linux,sysadmin,opensuse,test,kernel,syscalls"><meta name=description content="Follow-up on LTP: the test options"><meta name=author content="Andrea Manzini"><link rel=canonical href=https://ilmanzo.github.io/post/followup_linux_test_project_options/><link crossorigin=anonymous href=/assets/css/stylesheet.8fe10233a706bc87f2e08b3cf97b8bd4c0a80f10675a143675d59212121037c0.css integrity="sha256-j+ECM6cGvIfy4Is8+XuL1MCoDxBnWhQ2ddWSEhIQN8A=" rel="preload stylesheet" as=style><link rel=icon href=https://ilmanzo.github.io/favicon.ico><link rel=icon type=image/png sizes=16x16 href=https://ilmanzo.github.io/favicon-16x16.png><link rel=icon type=image/png sizes=32x32 href=https://ilmanzo.github.io/favicon-32x32.png><link rel=apple-touch-icon href=https://ilmanzo.github.io/apple-touch-icon.png><link rel=mask-icon href=https://ilmanzo.github.io/safari-pinned-tab.svg><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><link rel=alternate hreflang=en href=https://ilmanzo.github.io/post/followup_linux_test_project_options/><noscript><style>#theme-toggle,.top-link{display:none}</style></noscript><script async src="https://www.googletagmanager.com/gtag/js?id=G-6PN4FTRLNL"></script><script>var dnt,doNotTrack=!1;if(!1&&(dnt=navigator.doNotTrack||window.doNotTrack||navigator.msDoNotTrack,doNotTrack=dnt=="1"||dnt=="yes"),!doNotTrack){window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-6PN4FTRLNL")}</script><meta property="og:url" content="https://ilmanzo.github.io/post/followup_linux_test_project_options/"><meta property="og:site_name" content="ilManzo's blog"><meta property="og:title" content="Linux Test Project part 2"><meta property="og:description" content="Follow-up on LTP: the test options"><meta property="og:locale" content="en-us"><meta property="og:type" content="article"><meta property="article:section" content="post"><meta property="article:published_time" content="2024-10-27T00:00:00+00:00"><meta property="article:modified_time" content="2024-10-27T00:00:00+00:00"><meta property="article:tag" content="Linux"><meta property="article:tag" content="Sysadmin"><meta property="article:tag" content="Opensuse"><meta property="article:tag" content="Test"><meta property="article:tag" content="Kernel"><meta property="article:tag" content="Syscalls"><meta name=twitter:card content="summary"><meta name=twitter:title content="Linux Test Project part 2"><meta name=twitter:description content="Follow-up on LTP: the test options"><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Posts","item":"https://ilmanzo.github.io/post/"},{"@type":"ListItem","position":2,"name":"Linux Test Project part 2","item":"https://ilmanzo.github.io/post/followup_linux_test_project_options/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"Linux Test Project part 2","name":"Linux Test Project part 2","description":"Follow-up on LTP: the test options","keywords":["linux","sysadmin","opensuse","test","kernel","syscalls"],"articleBody":"üëª Intro While our previous post focused on the core components of LTP tests, today in this part boo two we‚Äôre taking a spooky deep dive into the options available in struct tst_test ü¶á.\nThe Linux Test Project (LTP) began as a collaborative effort between SGI, OSDL, and Bull. Today, it lives with the joint contributions of industry leaders including IBM, Cisco, Fujitsu, SUSE, Red Hat, Oracle, and others. Its mission remains clear: providing the open source community with comprehensive tests that verify Linux‚Äôs reliability, robustness, and stability. üï∏Ô∏è\nüç≠ Talk is cheap, show me the code The struct itself is pretty well commented, so we are going to highlight the most important stuff. For the rest, please consult the documentation\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 struct tst_test { unsigned int tcnt; struct tst_option *options; const char *min_kver; const char *const *supported_archs; const char *tconf_msg; unsigned int needs_tmpdir:1; unsigned int needs_root:1; unsigned int forks_child:1; unsigned int needs_device:1; unsigned int needs_checkpoints:1; unsigned int needs_overlay:1; unsigned int format_device:1; unsigned int mount_device:1; unsigned int needs_rofs:1; unsigned int child_needs_reinit:1; unsigned int runs_script:1; unsigned int needs_devfs:1; unsigned int restore_wallclock:1; unsigned int all_filesystems:1; unsigned int skip_in_lockdown:1; unsigned int skip_in_secureboot:1; unsigned int skip_in_compat:1; int needs_abi_bits; unsigned int needs_hugetlbfs:1; const char *const *skip_filesystems; unsigned long min_cpus; unsigned long min_mem_avail; unsigned long min_swap_avail; struct tst_hugepage hugepages; unsigned int taint_check; unsigned int test_variants; unsigned int dev_min_size; struct tst_fs *filesystems; const char *mntpoint; int max_runtime; void (*setup)(void); void (*cleanup)(void); void (*test)(unsigned int test_nr); void (*test_all)(void); const char *scall; int (*sample)(int clk_id, long long usec); const char *const *resource_files; const char * const *needs_drivers; const struct tst_path_val *save_restore; const struct tst_ulimit_val *ulimit; const char *const *needs_kconfigs; struct tst_buffers *bufs; struct tst_cap *caps; const struct tst_tag *tags; const char *const *needs_cmds; const enum tst_cg_ver needs_cgroup_ver; const char *const *needs_cgroup_ctrls; int needs_cgroup_nsdelegate:1; }; line 2: this is the number of the tests that the program contains. If you are using a data-driven approach with many test cases in an array, you want to have this number equal to the array size.\nline 3: a pointer to a null-terminated list of options (TODO)\nline 4: a string describing the minimum kernel version needed for this test. When run on an older one, LTP will automatically exclude this test with an appropriate message\nline 5: A NULL terminated array of architectures the test runs on e.g. {‚Äúx86_64‚Äù, ‚Äúx86‚Äù, NULL}.\nline 6: If set the test exits with TCONF right after entering the test library. This is used by the TST_TEST_TCONF() macro to disable tests at compile time.\nlines 7-23: set of boolean flags that enables specific LTP behaviour. For example if needs_tmpdir is true, LTP will automatically create a temporary directory for our program data.\nlines 24-36: set of options that controls when the test runs or not. For example, if min_cpus=2, the test won‚Äôt run on single-core systems.\nline 37-38: pointers to the setup and clean functions that will be called only once, before and after the test run\nline 39-40: mutually exclusive pointers to the actual test code. The first accepts an integer number, useful when you have many test cases for the same function. If the test contains just a single case, you can use the the second one.\nline 41-42: reserved for internal usage.\nline 43: A NULL terminated array of filenames that will be copied to the test temporary directory from the LTP datafiles directory.\nline 48: A description of guarded buffers to be allocated for the test. Guarded buffers are buffers with poisoned page allocated right before the start of the buffer and canary right after the end of the buffer. See struct tst_buffers and tst_buffer_alloc() for detail.\nüç¨ Enough tricks, gimme a treat To see a real usage of these options, let‚Äôs analyze one of the tests. Taking a simple one like the swapoff syscall; rather than the test itself, we are more interested on the struct tst_test usage, but the source it‚Äôs quite short and reading code is always educational. It‚Äôs one of the Free Sofware‚Äôs four essential freedoms, isn‚Äôt it ?\n# cat ltp/testcases/kernel/syscalls/swapoff/swapoff01.c 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 // SPDX-License-Identifier: GPL-2.0-or-later /* * Copyright (c) Wipro Technologies Ltd, 2002. All Rights Reserved. */ /*\\ * [Description] * * Check that swapoff() succeeds. */ #include #include #include #include \"tst_test.h\" #include \"lapi/syscalls.h\" #include \"libswap.h\" #define MNTPOINT\t\"mntpoint\" #define TEST_FILE\tMNTPOINT\"/testswap\" #define SWAP_FILE\tMNTPOINT\"/swapfile\" static void verify_swapoff(void) { if (tst_syscall(__NR_swapon, SWAP_FILE, 0) != 0) { tst_res(TFAIL | TERRNO, \"Failed to turn on the swap file\" \", skipping test iteration\"); return; } TEST(tst_syscall(__NR_swapoff, SWAP_FILE)); if (TST_RET == -1) { tst_res(TFAIL | TTERRNO, \"Failed to turn off swapfile,\" \" system reboot after execution of LTP \" \"test suite is recommended.\"); } else { tst_res(TPASS, \"Succeeded to turn off swapfile\"); } } static void setup(void) { is_swap_supported(TEST_FILE); SAFE_MAKE_SWAPFILE_BLKS(SWAP_FILE, 65536); } static struct tst_test test = { .mntpoint = MNTPOINT, .mount_device = 1, .dev_min_size = 350, .all_filesystems = 1, .needs_root = 1, .test_all = verify_swapoff, .max_runtime = 60, .setup = setup }; lines 1-18: standard license and inclusion of LTP header files. lines 20-22: definition of some constant values that will be used in the test lines 24-41: the real test function. This function basically calls swapon() to create a swapfile (aborting when it fails), then tries to stop swapping on that file checking the result. lines 43-47: the setup() function, executed just once before the start of the test: check if system supports swapping, then create a small swap file using helper functions. lines 49: the definition of the tst_test parameters for this test: line 50: the test requires a new mountpoint: LTP will take care to create it and destroy at the end line 51: LTP will formats the device and mounts at the mountpoint specified above line 52: device should be at least 350MB in size line 52: detect all the filesystem supported by the kernel and automatically repeats the same test for ALL of them line 53: this test needs to be run as root. When run as normal user, the exit code will be TCONF line 54: pointer to the actual test function line 55: give 60 seconds to run this test. When exceeded, LTP will automatically mark this test with an error line 56: pointer to the setup function ü¶∏ Run run run Let‚Äôs run this test on a openSUSE virtual machine:\n# cd ltp/testcases/kernel/syscalls/swapoff # make swapoff01 # ./swapoff01 tst_tmpdir.c:316: TINFO: Using /tmp/LTP_swaGg5kZE as tmpdir (tmpfs filesystem) tst_device.c:96: TINFO: Found free device 0 '/dev/loop0' tst_test.c:1888: TINFO: LTP version: 20240930-44-g34e6dd2d2 tst_test.c:1892: TINFO: Tested kernel: 6.4.0-slfo.1.7-default #1 SMP PREEMPT_DYNAMIC Tue Oct 1 10:57:21 UTC 2024 (0e26fa9) x86_64 tst_test.c:1723: TINFO: Timeout per run is 0h 01m 30s tst_supported_fs_types.c:97: TINFO: Kernel supports ext2 tst_supported_fs_types.c:62: TINFO: mkfs.ext2 does exist tst_supported_fs_types.c:97: TINFO: Kernel supports ext3 tst_supported_fs_types.c:62: TINFO: mkfs.ext3 does exist tst_supported_fs_types.c:97: TINFO: Kernel supports ext4 tst_supported_fs_types.c:62: TINFO: mkfs.ext4 does exist tst_supported_fs_types.c:97: TINFO: Kernel supports xfs tst_supported_fs_types.c:58: TINFO: mkfs.xfs does not exist tst_supported_fs_types.c:97: TINFO: Kernel supports btrfs tst_supported_fs_types.c:62: TINFO: mkfs.btrfs does exist tst_supported_fs_types.c:105: TINFO: Skipping bcachefs because of FUSE blacklist tst_supported_fs_types.c:97: TINFO: Kernel supports vfat tst_supported_fs_types.c:62: TINFO: mkfs.vfat does exist tst_supported_fs_types.c:97: TINFO: Kernel supports exfat tst_supported_fs_types.c:58: TINFO: mkfs.exfat does not exist tst_supported_fs_types.c:132: TINFO: FUSE does support ntfs tst_supported_fs_types.c:62: TINFO: mkfs.ntfs does exist tst_supported_fs_types.c:97: TINFO: Kernel supports tmpfs tst_supported_fs_types.c:49: TINFO: mkfs is not needed for tmpfs tst_test.c:1821: TINFO: === Testing on ext2 === tst_test.c:1171: TINFO: Formatting /dev/loop0 with ext2 opts='' extra opts='' mke2fs 1.47.0 (5-Feb-2023) tst_test.c:1183: TINFO: Mounting /dev/loop0 to /tmp/LTP_swaGg5kZE/mntpoint fstyp=ext2 flags=0 libswap.c:198: TINFO: create a swapfile size of 1 megabytes (MB) tst_ioctl.c:26: TINFO: FIBMAP ioctl is supported swapoff01.c:46: TINFO: create a swapfile with 65536 block numbers swapoff01.c:39: TPASS: Succeeded to turn off swapfile tst_test.c:1821: TINFO: === Testing on ext3 === tst_test.c:1171: TINFO: Formatting /dev/loop0 with ext3 opts='' extra opts='' mke2fs 1.47.0 (5-Feb-2023) tst_test.c:1183: TINFO: Mounting /dev/loop0 to /tmp/LTP_swaGg5kZE/mntpoint fstyp=ext3 flags=0 libswap.c:198: TINFO: create a swapfile size of 1 megabytes (MB) tst_ioctl.c:26: TINFO: FIBMAP ioctl is supported swapoff01.c:46: TINFO: create a swapfile with 65536 block numbers swapoff01.c:39: TPASS: Succeeded to turn off swapfile tst_test.c:1821: TINFO: === Testing on ext4 === tst_test.c:1171: TINFO: Formatting /dev/loop0 with ext4 opts='' extra opts='' mke2fs 1.47.0 (5-Feb-2023) tst_test.c:1183: TINFO: Mounting /dev/loop0 to /tmp/LTP_swaGg5kZE/mntpoint fstyp=ext4 flags=0 libswap.c:198: TINFO: create a swapfile size of 1 megabytes (MB) tst_ioctl.c:26: TINFO: FIBMAP ioctl is supported swapoff01.c:46: TINFO: create a swapfile with 65536 block numbers swapoff01.c:39: TPASS: Succeeded to turn off swapfile tst_test.c:1821: TINFO: === Testing on btrfs === tst_test.c:1171: TINFO: Formatting /dev/loop0 with btrfs opts='' extra opts='' tst_test.c:1183: TINFO: Mounting /dev/loop0 to /tmp/LTP_swaGg5kZE/mntpoint fstyp=btrfs flags=0 libswap.c:198: TINFO: create a swapfile size of 1 megabytes (MB) libswap.c:43: TINFO: FS_NOCOW_FL attribute set on mntpoint/testswap tst_ioctl.c:21: TINFO: FIBMAP ioctl is NOT supported: EINVAL (22) libswap.c:128: TINFO: File 'mntpoint/testswap' is not contiguous swapoff01.c:46: TINFO: create a swapfile with 65536 block numbers libswap.c:43: TINFO: FS_NOCOW_FL attribute set on mntpoint/swapfile swapoff01.c:39: TPASS: Succeeded to turn off swapfile tst_test.c:1821: TINFO: === Testing on vfat === tst_test.c:1171: TINFO: Formatting /dev/loop0 with vfat opts='' extra opts='' tst_test.c:1183: TINFO: Mounting /dev/loop0 to /tmp/LTP_swaGg5kZE/mntpoint fstyp=vfat flags=0 libswap.c:198: TINFO: create a swapfile size of 1 megabytes (MB) tst_ioctl.c:26: TINFO: FIBMAP ioctl is supported swapoff01.c:46: TINFO: create a swapfile with 65536 block numbers swapoff01.c:39: TPASS: Succeeded to turn off swapfile tst_test.c:1821: TINFO: === Testing on ntfs === tst_test.c:1171: TINFO: Formatting /dev/loop0 with ntfs opts='' extra opts='' The partition start sector was not specified for /dev/loop0 and it could not be obtained automatically. It has been set to 0. The number of sectors per track was not specified for /dev/loop0 and it could not be obtained automatically. It has been set to 0. The number of heads was not specified for /dev/loop0 and it could not be obtained automatically. It has been set to 0. To boot from a device, Windows needs the 'partition start sector', the 'sectors per track' and the 'number of heads' to be set. Windows will not be able to boot from this device. tst_test.c:1183: TINFO: Mounting /dev/loop0 to /tmp/LTP_swaGg5kZE/mntpoint fstyp=ntfs flags=0 tst_test.c:1183: TINFO: Trying FUSE... libswap.c:198: TINFO: create a swapfile size of 1 megabytes (MB) tst_ioctl.c:26: TINFO: FIBMAP ioctl is supported swapoff01.c:46: TINFO: create a swapfile with 65536 block numbers swapoff01.c:39: TPASS: Succeeded to turn off swapfile tst_test.c:1821: TINFO: === Testing on tmpfs === tst_test.c:1171: TINFO: Skipping mkfs for TMPFS filesystem tst_test.c:1147: TINFO: Limiting tmpfs size to 350MB tst_test.c:1183: TINFO: Mounting ltp-tmpfs to /tmp/LTP_swaGg5kZE/mntpoint fstyp=tmpfs flags=0 libswap.c:198: TINFO: create a swapfile size of 1 megabytes (MB) tst_ioctl.c:21: TINFO: FIBMAP ioctl is NOT supported: EINVAL (22) libswap.c:228: TCONF: Swapfile on tmpfs not implemented Summary: passed 6 failed 0 broken 0 skipped 1 warnings 0 As you can see, the test developer needs only to worry about testing the specific feature or functionality, while all the surrounding boilerplate is taken care by LTP framework and utility functions. Very handy!\nüéÉ Conclusion (?) If you are interested in the LTP project, check out the project‚Äôs repository for other documentation and Writing Guidelines; you can also subscribe to the LTP Mailing List.\nIf you like this kind of drill-down posts and want more, or for any other feedback feel free to drop me a message by email or at fosstodon. Enjoy!\n","wordCount":"1952","inLanguage":"en","datePublished":"2024-10-27T00:00:00Z","dateModified":"2024-10-27T00:00:00Z","author":{"@type":"Person","name":"Andrea Manzini"},"mainEntityOfPage":{"@type":"WebPage","@id":"https://ilmanzo.github.io/post/followup_linux_test_project_options/"},"publisher":{"@type":"Organization","name":"ilManzo's blog","logo":{"@type":"ImageObject","url":"https://ilmanzo.github.io/favicon.ico"}}}</script></head><body class=dark id=top><script>localStorage.getItem("pref-theme")==="light"&&document.body.classList.remove("dark")</script><header class=header><nav class=nav><div class=logo><a href=https://ilmanzo.github.io/ accesskey=h title="ilManzo's blog (Alt + H)">ilManzo's blog</a><div class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)" aria-label="Toggle theme">
<svg id="moon" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg>
<svg id="sun" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></div></div><ul id=menu><li><a href=https://ilmanzo.github.io/curriculum title=Curriculum><span>Curriculum</span></a></li><li><a href=https://ilmanzo.github.io/tags title=Tags><span>Tags</span></a></li><li><a href=https://ilmanzo.github.io/categories title=Categories><span>Categories</span></a></li><li><a href=https://ilmanzo.github.io/search title="Search (Alt + /)" accesskey=/><span>Search</span></a></li><li><a href=https://ilmanzo.github.io/post/ title=Posts><span>Posts</span></a></li></ul></nav></header><main class=main><article class=post-single><header class=post-header><div class=breadcrumbs><a href=https://ilmanzo.github.io/>Home</a>&nbsp;¬ª&nbsp;<a href=https://ilmanzo.github.io/post/>Posts</a></div><h1 class="post-title entry-hint-parent">Linux Test Project part 2</h1><div class=post-description>Follow-up on LTP: the test options</div><div class=post-meta><span title='2024-10-27 00:00:00 +0000 UTC'>October 27, 2024</span>&nbsp;¬∑&nbsp;Andrea Manzini</div></header><div class=post-content><h2 id=-intro>üëª Intro<a hidden class=anchor aria-hidden=true href=#-intro>#</a></h2><p>While our <a href=https://ilmanzo.github.io/post/first_steps_of_ltp_linux_test_project/>previous post</a> focused on the core components of LTP tests, today in this part <del>boo</del> two we&rsquo;re taking a spooky deep dive into the options available in <code>struct tst_test</code> ü¶á.</p><p>The <a href=https://github.com/linux-test-project/ltp>Linux Test Project (LTP)</a> began as a collaborative effort between SGI, OSDL, and Bull. Today, it lives with the joint contributions of industry leaders including IBM, Cisco, Fujitsu, SUSE, Red Hat, Oracle, and others. Its mission remains clear: providing the open source community with comprehensive tests that verify Linux&rsquo;s reliability, robustness, and stability. üï∏Ô∏è</p><h2 id=-talk-is-cheap-show-me-the-code>üç≠ Talk is cheap, show me the code<a hidden class=anchor aria-hidden=true href=#-talk-is-cheap-show-me-the-code>#</a></h2><p>The struct itself is pretty well commented, so we are going to highlight the most important stuff. For the rest, please consult the <a href=https://linux-test-project.readthedocs.io/en/latest/developers/api_c_tests.html#struct-tst-test>documentation</a></p><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">18
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">19
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">20
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">21
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">22
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">23
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">24
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">25
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">26
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">27
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">28
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">29
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">30
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">31
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">32
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">33
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">34
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">35
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">36
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">37
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">38
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">39
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">40
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">41
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">42
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">43
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">44
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">45
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">46
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">47
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">48
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">49
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">50
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">51
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">52
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">53
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">54
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">55
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-C data-lang=C><span style=display:flex><span><span style=color:#66d9ef>struct</span> tst_test {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>unsigned</span> <span style=color:#66d9ef>int</span> tcnt;
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>struct</span> tst_option <span style=color:#f92672>*</span>options;
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>const</span> <span style=color:#66d9ef>char</span> <span style=color:#f92672>*</span>min_kver;
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>const</span> <span style=color:#66d9ef>char</span> <span style=color:#f92672>*</span><span style=color:#66d9ef>const</span> <span style=color:#f92672>*</span>supported_archs;
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>const</span> <span style=color:#66d9ef>char</span> <span style=color:#f92672>*</span>tconf_msg;
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>unsigned</span> <span style=color:#66d9ef>int</span> needs_tmpdir:<span style=color:#ae81ff>1</span>;
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>unsigned</span> <span style=color:#66d9ef>int</span> needs_root:<span style=color:#ae81ff>1</span>;
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>unsigned</span> <span style=color:#66d9ef>int</span> forks_child:<span style=color:#ae81ff>1</span>;
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>unsigned</span> <span style=color:#66d9ef>int</span> needs_device:<span style=color:#ae81ff>1</span>;
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>unsigned</span> <span style=color:#66d9ef>int</span> needs_checkpoints:<span style=color:#ae81ff>1</span>;
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>unsigned</span> <span style=color:#66d9ef>int</span> needs_overlay:<span style=color:#ae81ff>1</span>;
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>unsigned</span> <span style=color:#66d9ef>int</span> format_device:<span style=color:#ae81ff>1</span>;
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>unsigned</span> <span style=color:#66d9ef>int</span> mount_device:<span style=color:#ae81ff>1</span>;
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>unsigned</span> <span style=color:#66d9ef>int</span> needs_rofs:<span style=color:#ae81ff>1</span>;
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>unsigned</span> <span style=color:#66d9ef>int</span> child_needs_reinit:<span style=color:#ae81ff>1</span>;
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>unsigned</span> <span style=color:#66d9ef>int</span> runs_script:<span style=color:#ae81ff>1</span>;
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>unsigned</span> <span style=color:#66d9ef>int</span> needs_devfs:<span style=color:#ae81ff>1</span>;
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>unsigned</span> <span style=color:#66d9ef>int</span> restore_wallclock:<span style=color:#ae81ff>1</span>;
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>unsigned</span> <span style=color:#66d9ef>int</span> all_filesystems:<span style=color:#ae81ff>1</span>;
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>unsigned</span> <span style=color:#66d9ef>int</span> skip_in_lockdown:<span style=color:#ae81ff>1</span>;
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>unsigned</span> <span style=color:#66d9ef>int</span> skip_in_secureboot:<span style=color:#ae81ff>1</span>;
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>unsigned</span> <span style=color:#66d9ef>int</span> skip_in_compat:<span style=color:#ae81ff>1</span>;
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>int</span> needs_abi_bits;
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>unsigned</span> <span style=color:#66d9ef>int</span> needs_hugetlbfs:<span style=color:#ae81ff>1</span>;
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>const</span> <span style=color:#66d9ef>char</span> <span style=color:#f92672>*</span><span style=color:#66d9ef>const</span> <span style=color:#f92672>*</span>skip_filesystems;
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>unsigned</span> <span style=color:#66d9ef>long</span> min_cpus;
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>unsigned</span> <span style=color:#66d9ef>long</span> min_mem_avail;
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>unsigned</span> <span style=color:#66d9ef>long</span> min_swap_avail;
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>struct</span> tst_hugepage hugepages;
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>unsigned</span> <span style=color:#66d9ef>int</span> taint_check;
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>unsigned</span> <span style=color:#66d9ef>int</span> test_variants;
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>unsigned</span> <span style=color:#66d9ef>int</span> dev_min_size;
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>struct</span> tst_fs <span style=color:#f92672>*</span>filesystems;
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>const</span> <span style=color:#66d9ef>char</span> <span style=color:#f92672>*</span>mntpoint;
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>int</span> max_runtime;
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>void</span> (<span style=color:#f92672>*</span>setup)(<span style=color:#66d9ef>void</span>);
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>void</span> (<span style=color:#f92672>*</span>cleanup)(<span style=color:#66d9ef>void</span>);
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>void</span> (<span style=color:#f92672>*</span>test)(<span style=color:#66d9ef>unsigned</span> <span style=color:#66d9ef>int</span> test_nr);
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>void</span> (<span style=color:#f92672>*</span>test_all)(<span style=color:#66d9ef>void</span>);
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>const</span> <span style=color:#66d9ef>char</span> <span style=color:#f92672>*</span>scall;
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>int</span> (<span style=color:#f92672>*</span>sample)(<span style=color:#66d9ef>int</span> clk_id, <span style=color:#66d9ef>long</span> <span style=color:#66d9ef>long</span> usec);
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>const</span> <span style=color:#66d9ef>char</span> <span style=color:#f92672>*</span><span style=color:#66d9ef>const</span> <span style=color:#f92672>*</span>resource_files;
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>const</span> <span style=color:#66d9ef>char</span> <span style=color:#f92672>*</span> <span style=color:#66d9ef>const</span> <span style=color:#f92672>*</span>needs_drivers;
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>const</span> <span style=color:#66d9ef>struct</span> tst_path_val <span style=color:#f92672>*</span>save_restore;
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>const</span> <span style=color:#66d9ef>struct</span> tst_ulimit_val <span style=color:#f92672>*</span>ulimit;
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>const</span> <span style=color:#66d9ef>char</span> <span style=color:#f92672>*</span><span style=color:#66d9ef>const</span> <span style=color:#f92672>*</span>needs_kconfigs;
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>struct</span> tst_buffers <span style=color:#f92672>*</span>bufs;
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>struct</span> tst_cap <span style=color:#f92672>*</span>caps;
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>const</span> <span style=color:#66d9ef>struct</span> tst_tag <span style=color:#f92672>*</span>tags;
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>const</span> <span style=color:#66d9ef>char</span> <span style=color:#f92672>*</span><span style=color:#66d9ef>const</span> <span style=color:#f92672>*</span>needs_cmds;
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>const</span> <span style=color:#66d9ef>enum</span> tst_cg_ver needs_cgroup_ver;
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>const</span> <span style=color:#66d9ef>char</span> <span style=color:#f92672>*</span><span style=color:#66d9ef>const</span> <span style=color:#f92672>*</span>needs_cgroup_ctrls;
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>int</span> needs_cgroup_nsdelegate:<span style=color:#ae81ff>1</span>;
</span></span><span style=display:flex><span>};</span></span></code></pre></td></tr></table></div></div><h2></h2><ul><li><p>line 2: this is the number of the tests that the program contains. If you are using a data-driven approach with many test cases in an array, you want to have this number equal to the array size.</p></li><li><p>line 3: a pointer to a null-terminated list of options (TODO)</p></li><li><p>line 4: a string describing the minimum kernel version needed for this test. When run on an older one, LTP will automatically exclude this test with an appropriate message</p></li><li><p>line 5: A NULL terminated array of architectures the test runs on e.g. {&ldquo;x86_64&rdquo;, &ldquo;x86&rdquo;, NULL}.</p></li><li><p>line 6: If set the test exits with TCONF right after entering the test library. This is used by the TST_TEST_TCONF() macro to disable tests at compile time.</p></li><li><p>lines 7-23: set of boolean flags that enables specific LTP behaviour. For example if <code>needs_tmpdir</code> is <code>true</code>, LTP will automatically create a temporary directory for our program data.</p></li><li><p>lines 24-36: set of options that controls when the test runs or not. For example, if <code>min_cpus=2</code>, the test won&rsquo;t run on single-core systems.</p></li><li><p>line 37-38: pointers to the <code>setup</code> and <code>clean</code> functions that will be called only once, before and after the test run</p></li><li><p>line 39-40: mutually exclusive pointers to the actual test code. The first accepts an integer number, useful when you have many test cases for the same function. If the test contains just a single case, you can use the the second one.</p></li><li><p>line 41-42: reserved for internal usage.</p></li><li><p>line 43: A NULL terminated array of filenames that will be copied to the test temporary directory from the LTP datafiles directory.</p></li><li><p>line 48: A description of guarded buffers to be allocated for the test. Guarded buffers are buffers with poisoned page allocated right before the start of the buffer and canary right after the end of the buffer. See struct tst_buffers and tst_buffer_alloc() for detail.</p></li></ul><h2 id=-enough-tricks-gimme-a-treat>üç¨ Enough tricks, gimme a treat<a hidden class=anchor aria-hidden=true href=#-enough-tricks-gimme-a-treat>#</a></h2><p>To see a real usage of these options, let&rsquo;s analyze one of the tests. Taking a simple one like the <a href=https://man7.org/linux/man-pages/man2/swapon.2.html>swapoff</a> syscall; rather than the test itself, we are more interested on the <code>struct tst_test</code> usage, but the source it&rsquo;s quite short and reading code is always educational. It&rsquo;s <a href=https://www.gnu.org/philosophy/free-sw.html#four-freedoms>one of the Free Sofware&rsquo;s four essential freedoms</a>, isn&rsquo;t it ?</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#75715e># cat ltp/testcases/kernel/syscalls/swapoff/swapoff01.c</span>
</span></span></code></pre></div><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">18
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">19
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">20
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">21
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">22
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">23
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">24
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">25
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">26
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">27
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">28
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">29
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">30
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">31
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">32
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">33
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">34
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">35
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">36
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">37
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">38
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">39
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">40
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">41
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">42
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">43
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">44
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">45
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">46
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">47
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">48
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">49
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">50
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">51
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">52
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">53
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">54
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">55
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">56
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">57
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">58
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-C data-lang=C><span style=display:flex><span><span style=color:#75715e>// SPDX-License-Identifier: GPL-2.0-or-later
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#75715e>/*
</span></span></span><span style=display:flex><span><span style=color:#75715e> * Copyright (c) Wipro Technologies Ltd, 2002.  All Rights Reserved.
</span></span></span><span style=display:flex><span><span style=color:#75715e> */</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>/*\
</span></span></span><span style=display:flex><span><span style=color:#75715e> * [Description]
</span></span></span><span style=display:flex><span><span style=color:#75715e> *
</span></span></span><span style=display:flex><span><span style=color:#75715e> * Check that swapoff() succeeds.
</span></span></span><span style=display:flex><span><span style=color:#75715e> */</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>#include</span> <span style=color:#75715e>&lt;unistd.h&gt;</span><span style=color:#75715e>
</span></span></span><span style=display:flex><span><span style=color:#75715e>#include</span> <span style=color:#75715e>&lt;errno.h&gt;</span><span style=color:#75715e>
</span></span></span><span style=display:flex><span><span style=color:#75715e>#include</span> <span style=color:#75715e>&lt;stdlib.h&gt;</span><span style=color:#75715e>
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>
</span></span><span style=display:flex><span><span style=color:#75715e>#include</span> <span style=color:#75715e>&#34;tst_test.h&#34;</span><span style=color:#75715e>
</span></span></span><span style=display:flex><span><span style=color:#75715e>#include</span> <span style=color:#75715e>&#34;lapi/syscalls.h&#34;</span><span style=color:#75715e>
</span></span></span><span style=display:flex><span><span style=color:#75715e>#include</span> <span style=color:#75715e>&#34;libswap.h&#34;</span><span style=color:#75715e>
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>
</span></span><span style=display:flex><span><span style=color:#75715e>#define MNTPOINT	&#34;mntpoint&#34;
</span></span></span><span style=display:flex><span><span style=color:#75715e>#define TEST_FILE	MNTPOINT&#34;/testswap&#34;
</span></span></span><span style=display:flex><span><span style=color:#75715e>#define SWAP_FILE	MNTPOINT&#34;/swapfile&#34;
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>static</span> <span style=color:#66d9ef>void</span> <span style=color:#a6e22e>verify_swapoff</span>(<span style=color:#66d9ef>void</span>)
</span></span><span style=display:flex><span>{
</span></span><span style=display:flex><span>	<span style=color:#66d9ef>if</span> (<span style=color:#a6e22e>tst_syscall</span>(__NR_swapon, SWAP_FILE, <span style=color:#ae81ff>0</span>) <span style=color:#f92672>!=</span> <span style=color:#ae81ff>0</span>) {
</span></span><span style=display:flex><span>		<span style=color:#a6e22e>tst_res</span>(TFAIL <span style=color:#f92672>|</span> TERRNO, <span style=color:#e6db74>&#34;Failed to turn on the swap file&#34;</span>
</span></span><span style=display:flex><span>			 <span style=color:#e6db74>&#34;, skipping test iteration&#34;</span>);
</span></span><span style=display:flex><span>		<span style=color:#66d9ef>return</span>;
</span></span><span style=display:flex><span>	}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>TEST</span>(<span style=color:#a6e22e>tst_syscall</span>(__NR_swapoff, SWAP_FILE));
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>	<span style=color:#66d9ef>if</span> (TST_RET <span style=color:#f92672>==</span> <span style=color:#f92672>-</span><span style=color:#ae81ff>1</span>) {
</span></span><span style=display:flex><span>		<span style=color:#a6e22e>tst_res</span>(TFAIL <span style=color:#f92672>|</span> TTERRNO, <span style=color:#e6db74>&#34;Failed to turn off swapfile,&#34;</span>
</span></span><span style=display:flex><span>			<span style=color:#e6db74>&#34; system reboot after execution of LTP &#34;</span>
</span></span><span style=display:flex><span>			<span style=color:#e6db74>&#34;test suite is recommended.&#34;</span>);
</span></span><span style=display:flex><span>	} <span style=color:#66d9ef>else</span> {
</span></span><span style=display:flex><span>		<span style=color:#a6e22e>tst_res</span>(TPASS, <span style=color:#e6db74>&#34;Succeeded to turn off swapfile&#34;</span>);
</span></span><span style=display:flex><span>	}
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>static</span> <span style=color:#66d9ef>void</span> <span style=color:#a6e22e>setup</span>(<span style=color:#66d9ef>void</span>)
</span></span><span style=display:flex><span>{
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>is_swap_supported</span>(TEST_FILE);
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>SAFE_MAKE_SWAPFILE_BLKS</span>(SWAP_FILE, <span style=color:#ae81ff>65536</span>);
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>static</span> <span style=color:#66d9ef>struct</span> tst_test test <span style=color:#f92672>=</span> {
</span></span><span style=display:flex><span>	.mntpoint <span style=color:#f92672>=</span> MNTPOINT,
</span></span><span style=display:flex><span>	.mount_device <span style=color:#f92672>=</span> <span style=color:#ae81ff>1</span>,
</span></span><span style=display:flex><span>	.dev_min_size <span style=color:#f92672>=</span> <span style=color:#ae81ff>350</span>,
</span></span><span style=display:flex><span>	.all_filesystems <span style=color:#f92672>=</span> <span style=color:#ae81ff>1</span>,
</span></span><span style=display:flex><span>	.needs_root <span style=color:#f92672>=</span> <span style=color:#ae81ff>1</span>,
</span></span><span style=display:flex><span>	.test_all <span style=color:#f92672>=</span> verify_swapoff,
</span></span><span style=display:flex><span>	.max_runtime <span style=color:#f92672>=</span> <span style=color:#ae81ff>60</span>,
</span></span><span style=display:flex><span>	.setup <span style=color:#f92672>=</span> setup
</span></span><span style=display:flex><span>};</span></span></code></pre></td></tr></table></div></div><ul><li>lines 1-18: standard license and inclusion of LTP header files.</li><li>lines 20-22: definition of some constant values that will be used in the test</li><li>lines 24-41: the real test function. This function basically calls <code>swapon()</code> to create a swapfile (aborting when it fails), then tries to stop swapping on that file checking the result.</li><li>lines 43-47: the <code>setup()</code> function, executed just once before the start of the test: check if system supports swapping, then create a small swap file using helper functions.</li><li>lines 49: the definition of the <code>tst_test</code> parameters for this test:</li><li>line 50: the test requires a new mountpoint: LTP will take care to create it and destroy at the end</li><li>line 51: LTP will formats the device and mounts at the mountpoint specified above</li><li>line 52: device should be at least 350MB in size</li><li>line 52: detect all the filesystem supported by the kernel and automatically repeats the same test for ALL of them</li><li>line 53: this test needs to be run as root. When run as normal user, the exit code will be TCONF</li><li>line 54: pointer to the actual test function</li><li>line 55: give 60 seconds to run this test. When exceeded, LTP will automatically mark this test with an error</li><li>line 56: pointer to the setup function</li></ul><h2 id=-run-run-run>ü¶∏ Run run run<a hidden class=anchor aria-hidden=true href=#-run-run-run>#</a></h2><p>Let&rsquo;s run this test on a <a href=https://www.opensuse.org/>openSUSE</a> virtual machine:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#75715e># cd ltp/testcases/kernel/syscalls/swapoff</span>
</span></span><span style=display:flex><span><span style=color:#75715e># make swapoff01</span>
</span></span><span style=display:flex><span><span style=color:#75715e># ./swapoff01 </span>
</span></span><span style=display:flex><span>tst_tmpdir.c:316: TINFO: Using /tmp/LTP_swaGg5kZE as tmpdir <span style=color:#f92672>(</span>tmpfs filesystem<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>tst_device.c:96: TINFO: Found free device <span style=color:#ae81ff>0</span> <span style=color:#e6db74>&#39;/dev/loop0&#39;</span>
</span></span><span style=display:flex><span>tst_test.c:1888: TINFO: LTP version: 20240930-44-g34e6dd2d2
</span></span><span style=display:flex><span>tst_test.c:1892: TINFO: Tested kernel: 6.4.0-slfo.1.7-default <span style=color:#75715e>#1 SMP PREEMPT_DYNAMIC Tue Oct  1 10:57:21 UTC 2024 (0e26fa9) x86_64</span>
</span></span><span style=display:flex><span>tst_test.c:1723: TINFO: Timeout per run is 0h 01m 30s
</span></span><span style=display:flex><span>tst_supported_fs_types.c:97: TINFO: Kernel supports ext2
</span></span><span style=display:flex><span>tst_supported_fs_types.c:62: TINFO: mkfs.ext2 does exist
</span></span><span style=display:flex><span>tst_supported_fs_types.c:97: TINFO: Kernel supports ext3
</span></span><span style=display:flex><span>tst_supported_fs_types.c:62: TINFO: mkfs.ext3 does exist
</span></span><span style=display:flex><span>tst_supported_fs_types.c:97: TINFO: Kernel supports ext4
</span></span><span style=display:flex><span>tst_supported_fs_types.c:62: TINFO: mkfs.ext4 does exist
</span></span><span style=display:flex><span>tst_supported_fs_types.c:97: TINFO: Kernel supports xfs
</span></span><span style=display:flex><span>tst_supported_fs_types.c:58: TINFO: mkfs.xfs does not exist
</span></span><span style=display:flex><span>tst_supported_fs_types.c:97: TINFO: Kernel supports btrfs
</span></span><span style=display:flex><span>tst_supported_fs_types.c:62: TINFO: mkfs.btrfs does exist
</span></span><span style=display:flex><span>tst_supported_fs_types.c:105: TINFO: Skipping bcachefs because of FUSE blacklist
</span></span><span style=display:flex><span>tst_supported_fs_types.c:97: TINFO: Kernel supports vfat
</span></span><span style=display:flex><span>tst_supported_fs_types.c:62: TINFO: mkfs.vfat does exist
</span></span><span style=display:flex><span>tst_supported_fs_types.c:97: TINFO: Kernel supports exfat
</span></span><span style=display:flex><span>tst_supported_fs_types.c:58: TINFO: mkfs.exfat does not exist
</span></span><span style=display:flex><span>tst_supported_fs_types.c:132: TINFO: FUSE does support ntfs
</span></span><span style=display:flex><span>tst_supported_fs_types.c:62: TINFO: mkfs.ntfs does exist
</span></span><span style=display:flex><span>tst_supported_fs_types.c:97: TINFO: Kernel supports tmpfs
</span></span><span style=display:flex><span>tst_supported_fs_types.c:49: TINFO: mkfs is not needed <span style=color:#66d9ef>for</span> tmpfs
</span></span><span style=display:flex><span>tst_test.c:1821: TINFO: <span style=color:#f92672>===</span> Testing on ext2 <span style=color:#f92672>===</span>
</span></span><span style=display:flex><span>tst_test.c:1171: TINFO: Formatting /dev/loop0 with ext2 opts<span style=color:#f92672>=</span><span style=color:#e6db74>&#39;&#39;</span> extra opts<span style=color:#f92672>=</span><span style=color:#e6db74>&#39;&#39;</span>
</span></span><span style=display:flex><span>mke2fs 1.47.0 <span style=color:#f92672>(</span>5-Feb-2023<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>tst_test.c:1183: TINFO: Mounting /dev/loop0 to /tmp/LTP_swaGg5kZE/mntpoint fstyp<span style=color:#f92672>=</span>ext2 flags<span style=color:#f92672>=</span><span style=color:#ae81ff>0</span>
</span></span><span style=display:flex><span>libswap.c:198: TINFO: create a swapfile size of <span style=color:#ae81ff>1</span> megabytes <span style=color:#f92672>(</span>MB<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>tst_ioctl.c:26: TINFO: FIBMAP ioctl is supported
</span></span><span style=display:flex><span>swapoff01.c:46: TINFO: create a swapfile with <span style=color:#ae81ff>65536</span> block numbers
</span></span><span style=display:flex><span>swapoff01.c:39: TPASS: Succeeded to turn off swapfile
</span></span><span style=display:flex><span>tst_test.c:1821: TINFO: <span style=color:#f92672>===</span> Testing on ext3 <span style=color:#f92672>===</span>
</span></span><span style=display:flex><span>tst_test.c:1171: TINFO: Formatting /dev/loop0 with ext3 opts<span style=color:#f92672>=</span><span style=color:#e6db74>&#39;&#39;</span> extra opts<span style=color:#f92672>=</span><span style=color:#e6db74>&#39;&#39;</span>
</span></span><span style=display:flex><span>mke2fs 1.47.0 <span style=color:#f92672>(</span>5-Feb-2023<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>tst_test.c:1183: TINFO: Mounting /dev/loop0 to /tmp/LTP_swaGg5kZE/mntpoint fstyp<span style=color:#f92672>=</span>ext3 flags<span style=color:#f92672>=</span><span style=color:#ae81ff>0</span>
</span></span><span style=display:flex><span>libswap.c:198: TINFO: create a swapfile size of <span style=color:#ae81ff>1</span> megabytes <span style=color:#f92672>(</span>MB<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>tst_ioctl.c:26: TINFO: FIBMAP ioctl is supported
</span></span><span style=display:flex><span>swapoff01.c:46: TINFO: create a swapfile with <span style=color:#ae81ff>65536</span> block numbers
</span></span><span style=display:flex><span>swapoff01.c:39: TPASS: Succeeded to turn off swapfile
</span></span><span style=display:flex><span>tst_test.c:1821: TINFO: <span style=color:#f92672>===</span> Testing on ext4 <span style=color:#f92672>===</span>
</span></span><span style=display:flex><span>tst_test.c:1171: TINFO: Formatting /dev/loop0 with ext4 opts<span style=color:#f92672>=</span><span style=color:#e6db74>&#39;&#39;</span> extra opts<span style=color:#f92672>=</span><span style=color:#e6db74>&#39;&#39;</span>
</span></span><span style=display:flex><span>mke2fs 1.47.0 <span style=color:#f92672>(</span>5-Feb-2023<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>tst_test.c:1183: TINFO: Mounting /dev/loop0 to /tmp/LTP_swaGg5kZE/mntpoint fstyp<span style=color:#f92672>=</span>ext4 flags<span style=color:#f92672>=</span><span style=color:#ae81ff>0</span>
</span></span><span style=display:flex><span>libswap.c:198: TINFO: create a swapfile size of <span style=color:#ae81ff>1</span> megabytes <span style=color:#f92672>(</span>MB<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>tst_ioctl.c:26: TINFO: FIBMAP ioctl is supported
</span></span><span style=display:flex><span>swapoff01.c:46: TINFO: create a swapfile with <span style=color:#ae81ff>65536</span> block numbers
</span></span><span style=display:flex><span>swapoff01.c:39: TPASS: Succeeded to turn off swapfile
</span></span><span style=display:flex><span>tst_test.c:1821: TINFO: <span style=color:#f92672>===</span> Testing on btrfs <span style=color:#f92672>===</span>
</span></span><span style=display:flex><span>tst_test.c:1171: TINFO: Formatting /dev/loop0 with btrfs opts<span style=color:#f92672>=</span><span style=color:#e6db74>&#39;&#39;</span> extra opts<span style=color:#f92672>=</span><span style=color:#e6db74>&#39;&#39;</span>
</span></span><span style=display:flex><span>tst_test.c:1183: TINFO: Mounting /dev/loop0 to /tmp/LTP_swaGg5kZE/mntpoint fstyp<span style=color:#f92672>=</span>btrfs flags<span style=color:#f92672>=</span><span style=color:#ae81ff>0</span>
</span></span><span style=display:flex><span>libswap.c:198: TINFO: create a swapfile size of <span style=color:#ae81ff>1</span> megabytes <span style=color:#f92672>(</span>MB<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>libswap.c:43: TINFO: FS_NOCOW_FL attribute set on mntpoint/testswap
</span></span><span style=display:flex><span>tst_ioctl.c:21: TINFO: FIBMAP ioctl is NOT supported: EINVAL <span style=color:#f92672>(</span>22<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>libswap.c:128: TINFO: File <span style=color:#e6db74>&#39;mntpoint/testswap&#39;</span> is not contiguous
</span></span><span style=display:flex><span>swapoff01.c:46: TINFO: create a swapfile with <span style=color:#ae81ff>65536</span> block numbers
</span></span><span style=display:flex><span>libswap.c:43: TINFO: FS_NOCOW_FL attribute set on mntpoint/swapfile
</span></span><span style=display:flex><span>swapoff01.c:39: TPASS: Succeeded to turn off swapfile
</span></span><span style=display:flex><span>tst_test.c:1821: TINFO: <span style=color:#f92672>===</span> Testing on vfat <span style=color:#f92672>===</span>
</span></span><span style=display:flex><span>tst_test.c:1171: TINFO: Formatting /dev/loop0 with vfat opts<span style=color:#f92672>=</span><span style=color:#e6db74>&#39;&#39;</span> extra opts<span style=color:#f92672>=</span><span style=color:#e6db74>&#39;&#39;</span>
</span></span><span style=display:flex><span>tst_test.c:1183: TINFO: Mounting /dev/loop0 to /tmp/LTP_swaGg5kZE/mntpoint fstyp<span style=color:#f92672>=</span>vfat flags<span style=color:#f92672>=</span><span style=color:#ae81ff>0</span>
</span></span><span style=display:flex><span>libswap.c:198: TINFO: create a swapfile size of <span style=color:#ae81ff>1</span> megabytes <span style=color:#f92672>(</span>MB<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>tst_ioctl.c:26: TINFO: FIBMAP ioctl is supported
</span></span><span style=display:flex><span>swapoff01.c:46: TINFO: create a swapfile with <span style=color:#ae81ff>65536</span> block numbers
</span></span><span style=display:flex><span>swapoff01.c:39: TPASS: Succeeded to turn off swapfile
</span></span><span style=display:flex><span>tst_test.c:1821: TINFO: <span style=color:#f92672>===</span> Testing on ntfs <span style=color:#f92672>===</span>
</span></span><span style=display:flex><span>tst_test.c:1171: TINFO: Formatting /dev/loop0 with ntfs opts<span style=color:#f92672>=</span><span style=color:#e6db74>&#39;&#39;</span> extra opts<span style=color:#f92672>=</span><span style=color:#e6db74>&#39;&#39;</span>
</span></span><span style=display:flex><span>The partition start sector was not specified <span style=color:#66d9ef>for</span> /dev/loop0 and it could not be obtained automatically.  It has been set to 0.
</span></span><span style=display:flex><span>The number of sectors per track was not specified <span style=color:#66d9ef>for</span> /dev/loop0 and it could not be obtained automatically.  It has been set to 0.
</span></span><span style=display:flex><span>The number of heads was not specified <span style=color:#66d9ef>for</span> /dev/loop0 and it could not be obtained automatically.  It has been set to 0.
</span></span><span style=display:flex><span>To boot from a device, Windows needs the <span style=color:#e6db74>&#39;partition start sector&#39;</span>, the <span style=color:#e6db74>&#39;sectors per track&#39;</span> and the <span style=color:#e6db74>&#39;number of heads&#39;</span> to be set.
</span></span><span style=display:flex><span>Windows will not be able to boot from this device.
</span></span><span style=display:flex><span>tst_test.c:1183: TINFO: Mounting /dev/loop0 to /tmp/LTP_swaGg5kZE/mntpoint fstyp<span style=color:#f92672>=</span>ntfs flags<span style=color:#f92672>=</span><span style=color:#ae81ff>0</span>
</span></span><span style=display:flex><span>tst_test.c:1183: TINFO: Trying FUSE...
</span></span><span style=display:flex><span>libswap.c:198: TINFO: create a swapfile size of <span style=color:#ae81ff>1</span> megabytes <span style=color:#f92672>(</span>MB<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>tst_ioctl.c:26: TINFO: FIBMAP ioctl is supported
</span></span><span style=display:flex><span>swapoff01.c:46: TINFO: create a swapfile with <span style=color:#ae81ff>65536</span> block numbers
</span></span><span style=display:flex><span>swapoff01.c:39: TPASS: Succeeded to turn off swapfile
</span></span><span style=display:flex><span>tst_test.c:1821: TINFO: <span style=color:#f92672>===</span> Testing on tmpfs <span style=color:#f92672>===</span>
</span></span><span style=display:flex><span>tst_test.c:1171: TINFO: Skipping mkfs <span style=color:#66d9ef>for</span> TMPFS filesystem
</span></span><span style=display:flex><span>tst_test.c:1147: TINFO: Limiting tmpfs size to 350MB
</span></span><span style=display:flex><span>tst_test.c:1183: TINFO: Mounting ltp-tmpfs to /tmp/LTP_swaGg5kZE/mntpoint fstyp<span style=color:#f92672>=</span>tmpfs flags<span style=color:#f92672>=</span><span style=color:#ae81ff>0</span>
</span></span><span style=display:flex><span>libswap.c:198: TINFO: create a swapfile size of <span style=color:#ae81ff>1</span> megabytes <span style=color:#f92672>(</span>MB<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>tst_ioctl.c:21: TINFO: FIBMAP ioctl is NOT supported: EINVAL <span style=color:#f92672>(</span>22<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>libswap.c:228: TCONF: Swapfile on tmpfs not implemented
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>Summary:
</span></span><span style=display:flex><span>passed   <span style=color:#ae81ff>6</span>
</span></span><span style=display:flex><span>failed   <span style=color:#ae81ff>0</span>
</span></span><span style=display:flex><span>broken   <span style=color:#ae81ff>0</span>
</span></span><span style=display:flex><span>skipped  <span style=color:#ae81ff>1</span>
</span></span><span style=display:flex><span>warnings <span style=color:#ae81ff>0</span>
</span></span></code></pre></div><p>As you can see, the test developer needs only to worry about testing the specific feature or functionality, while all the surrounding boilerplate is taken care by LTP framework and utility functions. Very handy!</p><h2 id=-conclusion->üéÉ Conclusion (?)<a hidden class=anchor aria-hidden=true href=#-conclusion->#</a></h2><p>If you are interested in the LTP project, check out <a href=https://github.com/linux-test-project/ltp>the project&rsquo;s repository</a> for other documentation and Writing Guidelines; you can also subscribe to <a href=https://lists.linux.it/listinfo/ltp>the LTP Mailing List</a>.</p><p>If you like this kind of drill-down posts and want more, or for any other feedback feel free to drop me a message by email or at <a href=https://fosstodon.org/@ilmanzo>fosstodon</a>. Enjoy!</p></div><footer class=post-footer><ul class=post-tags><li><a href=https://ilmanzo.github.io/tags/linux/>Linux</a></li><li><a href=https://ilmanzo.github.io/tags/sysadmin/>Sysadmin</a></li><li><a href=https://ilmanzo.github.io/tags/opensuse/>Opensuse</a></li><li><a href=https://ilmanzo.github.io/tags/test/>Test</a></li><li><a href=https://ilmanzo.github.io/tags/kernel/>Kernel</a></li><li><a href=https://ilmanzo.github.io/tags/syscalls/>Syscalls</a></li></ul><nav class=paginav><a class=prev href=https://ilmanzo.github.io/post/golab2024/><span class=title>¬´ Prev</span><br><span>Wrapping up GoLab 2024</span>
</a><a class=next href=https://ilmanzo.github.io/post/containerday2024/><span class=title>Next ¬ª</span><br><span>Wrapping up ContainerDay 2024</span></a></nav></footer></article></main><footer class=footer><span>¬© 2012-2025 Andrea Manzini</span> ¬∑
<span>Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
<a href=https://github.com/adityatelange/hugo-PaperMod/ rel=noopener target=_blank>PaperMod</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg viewBox="0 0 12 6" fill="currentColor"><path d="M12 6H0l6-6z"/></svg>
</a><script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))})</script><script>document.querySelectorAll("pre > code").forEach(e=>{const n=e.parentNode.parentNode,t=document.createElement("button");t.classList.add("copy-code"),t.innerHTML="copy";function s(){t.innerHTML="copied!",setTimeout(()=>{t.innerHTML="copy"},2e3)}t.addEventListener("click",t=>{if("clipboard"in navigator){navigator.clipboard.writeText(e.textContent),s();return}const n=document.createRange();n.selectNodeContents(e);const o=window.getSelection();o.removeAllRanges(),o.addRange(n);try{document.execCommand("copy"),s()}catch{}o.removeRange(n)}),n.classList.contains("highlight")?n.appendChild(t):n.parentNode.firstChild==n||(e.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName=="TABLE"?e.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(t):e.parentNode.appendChild(t))})</script></body></html>