<!doctype html><html lang=en><head><title>il linguaggio Lua: prima parte &ndash; ilManzo's blog</title><meta name=description content="A minimalist, pragmatic website and personal blog"><meta name=viewport content="width=device-width,initial-scale=1"><meta charset=utf-8><link rel=stylesheet href=https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.2/css/all.min.css integrity="sha512-HK5fgLBL+xu6dm/Ii3z4xhlSUyZgTT9tuc/hSrtw6uzJOvgRr2a9jyxxT1ely+B+xFAmJKVSTbpM/CuL7qxO8w==" crossorigin=anonymous><link rel=stylesheet href=https://cdnjs.cloudflare.com/ajax/libs/academicons/1.9.1/css/academicons.min.css integrity="sha512-b1ASx0WHgVFL5ZQhTgiPWX+68KjS38Jk87jg7pe+qC7q9YkEtFq0z7xCglv7qGIs/68d3mAp+StfC8WKC5SSAg==" crossorigin=anonymous><link rel=stylesheet href=https://ilmanzo.github.io/css/colour/gruvbox-dark.css><link rel=stylesheet href=https://ilmanzo.github.io/css/colour/dark-mode.css><link rel=stylesheet href=https://ilmanzo.github.io/css/risotto.css><link rel=stylesheet href=https://ilmanzo.github.io/css/custom.css></head><body><div class=page><header class=page__header><h1 class=page__logo><a href=https://ilmanzo.github.io/ class=page__logo-inner>ilManzo's blog</a></h1><nav class="page__nav main-nav"><ul><li class=main-nav__item><a class=nav-main-item href=/curriculum title>Curriculum</a></li><li class=main-nav__item><a class=nav-main-item href=/categories title>Categories</a></li><li class=main-nav__item><a class=nav-main-item href=/tags title>Tags</a></li><li class=main-nav__item><a class="nav-main-item active" href=/post/ title=Posts>Posts</a></li></ul></nav></header><section class=page__body><header class=content__header><h1>il linguaggio Lua: prima parte</h1></header><div class=content__body><h1 id=introduzione>introduzione</h1><p>Ho sempre avuto un debole per il software leggero e snello: sara&rsquo; un retaggio di quando la memoria si misurava in Kb e lo storage era basato su&mldr; audiocassette! <a href=https://www.lua.org/>Lua</a> e&rsquo; un linguaggio che incarna questa filosofia: occupa circa un centinaio di kbyte (meno di molte pagine web), ha una stupefacente rapidita&rsquo; di esecuzione, una sintassi chiara e, come bonus, gira su qualsiasi CPU per cui sia disponibile un compilatore C.</p><h1 id=dalla-terra-alla-luna-ovvero-breve-storia-di-lua>&lsquo;Dalla terra alla luna&rsquo;, ovvero breve storia di Lua</h1><p>Per capire da dove viene questo gioiellino, facciamo qualche passo indietro nel tempo&mldr;</p><p>Nel 1992, all&rsquo;universita&rsquo; cattolica pontificia di Rio de Janeiro, un gruppo specializzato in computer graphics chiamato Tecgraf sta sviluppando interfacce interattive nel settore dell&rsquo;elaborazione dati per l&rsquo;industria petrolifera.</p><p>Tra il 1977 ed il 1992 il Brasile attraversa un difficile periodo di embargo politico e difficolta&rsquo; economiche, percio&rsquo; spesso per istituti ed enti non è possibile comprare all&rsquo;estero
pacchetti software aggiornati o personalizzati, l&rsquo;unica soluzione e&rsquo; fabbricarsi gli strumenti &ldquo;in casa&rdquo;.</p><p>Allo scopo di aggiungere un minimo di flessibilita&rsquo; ad alcune procedure, nacquero quindi SOL (Simple Object Language) e DEL (Data Entry Language). Ebbero un discreto successo nel settore, ma dato che non avevano strutture di controllo e l&rsquo;azienda committente richiedeva maggiore capacita&rsquo; di intervento, nacque l&rsquo;esigenza di utilizzare un linguaggio unificato e completo, ma abbastanza semplice da essere alla portata anche di tecnici senza grandi conoscenze di programmazione.</p><p>Al tempo l&rsquo;unico candidato era <a href=https://www.tcl.tk/>Tcl</a> (Python era ancora immaturo), ma aveva una sintassi poco familiare e soprattutto girava solo sulle costose workstation UNIX. <a href=http://www.lua.org/authors.html>Roberto Lerusalimschy, Luiz Henrique de Figueiredo e Waldemar Celes</a> avevano bisogno di un linguaggio portabile, semplice e facile da integrare: nel 1993 nasce <strong>Lua</strong> che, attraverso varie revisioni e aggiustamenti anche sostanziali, arriva ai giorni nostri.</p><p>Il progetto ormai e&rsquo; piuttosto stabile: Lua 4.0 fu rilasciato nel 2000 e presentava praticamente le stesse caratteristiche della versione che conosciamo ed installiamo oggi.</p><p>Essendo nato come linguaggio ausiliario (o, meglio, satellite), Lua e&rsquo; ideale per aggiungere capacita&rsquo; di scripting in grossi progetti. Benche&rsquo; sia nato in un&rsquo;universita&rsquo;, è tutto fuorche&rsquo; un linguaggio accademico, pieno di feature o utilizzato solo da chi scrive trattati teorici: Lua punta alla sostanza e lo si vede già dalla <a href=http://www.lua.org/license.html>licenza (MIT) con cui e&rsquo; distribuito</a>, la stessa di software diffusi come X Window System, Ruby on Rails e Mono.</p><h1 id=lo-stolto-guarda-il-dito>&rsquo;lo stolto guarda il dito&rsquo;</h1><p>Ovviamente la prima domanda che vi frullera&rsquo; in testa sara&rsquo;: perché dovrei usare Lua e non Perl o Ruby o Tcl o Python o Javascript o PHP? Ecco 7 motivi:</p><ul><li><p>Lua e&rsquo; molto piccolo: basta linkare al progetto una libreria di 150kb. Altri linguaggi hanno esigenze ben diverse;</p></li><li><p>e&rsquo; secure by default: l&rsquo;interprete gira in una sandbox e gli unici punti di contatto con l&rsquo;applicazione principale sono quelli che decidiamo noi. Persino le istruzioni di I/O (inclusa la <em>print</em>) sono opzionali;</p></li><li><p>è velocissimo: nei benchmark batte qualsiasi linguaggio interpretato e la versione Just-In-Time e&rsquo; paragonabile a quelli compilati;</p></li><li><p>e&rsquo; semplice: la sintassi conta una ventina di operatori ed altrettante parole chiave, puo&rsquo; impararlo facilmente anche chi non sviluppa per professione;</p></li><li><p>e&rsquo; flessibile: ha tipizzazione dinamica, e&rsquo; facile da integrare con librerie esterne e, disponendo di un ampio parco di utilizzatori, troviamo disponibili sulla rete moduli per praticamente qualsiasi esigenza (per avere un&rsquo;idea visitiamo <a href=http://luaforge.net>http://luaforge.net</a>;</p></li><li><p>e&rsquo; open source e, grazie alla permissiva licenza MIT, non c&rsquo;e&rsquo; nessun problema ad includerne versioni modificate nei vostri progetti senza dover per forza rilasciare i sorgenti;</p></li><li><p>e&rsquo; maturo e stabile (ha quasi vent&rsquo;anni di storia), ma e&rsquo; anche moderno, tecnicamente parlando: Lua ha un garbage collector mark-and-sweep, che funziona in modo incrementale. Ha caratteristiche dei linguaggi funzionali come closure lessicali e ottimizza le tail calls. Come vedremo, le funzioni sono tipi di prima classe.</p></li></ul><p>Vi ho convinti? E allora andiamo avanti al passo successivo.</p><h1 id=fly-me-to-the-moon-ovvero-installazione>&lsquo;Fly me to the moon&rsquo; ovvero: installazione</h1><p>Data la sua diffusione, ci sono grandi probabilita&rsquo; che nel nostro PC Lua sia gia&rsquo; installato, ma per levarci lo sfizio, sulla classica Debian/Ubuntu basta un:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>$ sudo apt-get install lua5.2 luajit</span></span></code></pre></div><p>luajit e&rsquo; la versione <em>turbo</em>, che esegue gli stessi programmi, ma con una tecnica diversa: trasla le istruzioni in codice macchina nativo con risultati eccellenti.
Per chi preferisse usare i sorgenti, e&rsquo; sufficiente scaricare e scompattare un tarball:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>$ curl http://www.lua.org/ftp/lua-5.3.2.tar.gz | tar xz</span></span></code></pre></div><p>per poi compilare per piattaforma Linux ed installare come superuser i binari ottenuti:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>$ cd lua-5.3.2 ; make linux <span style=color:#f92672>&amp;&amp;</span> sudo make install</span></span></code></pre></div><p>Una volta installato il software, proviamo a scrivere il nostro primo programma Lua! Eseguiamo l&rsquo;interprete interattivo a linea di comando, una specie di <em>lua shell</em>:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>$ lua</span></span></code></pre></div><p>subito dopo vedremo una riga con le informazioni di rito; al prompt che appare scriviamo:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-lua data-lang=lua><span style=display:flex><span><span style=color:#f92672>&gt;</span> print <span style=color:#e6db74>&#34;Hello, World!&#34;</span></span></span></code></pre></div><p>il risultato e&rsquo; quello che ci aspettiamo. Non e&rsquo; un granche&rsquo; come programma&mldr; Ma tutti i grandi hanno iniziato in questo modo! Per uscire, basta un CTRL-C o CTRL-D.
Facciamo un passo avanti e scriviamo uno script vero e proprio. Apriamo un editor di testo e digitiamo queste righe:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-lua data-lang=lua><span style=display:flex><span><span style=color:#66d9ef>for</span> i<span style=color:#f92672>=</span><span style=color:#ae81ff>1</span>,<span style=color:#ae81ff>10</span> <span style=color:#66d9ef>do</span>
</span></span><span style=display:flex><span>  print(<span style=color:#e6db74>&#34;ciclo numero&#34;</span>,i)
</span></span><span style=display:flex><span><span style=color:#66d9ef>end</span></span></span></code></pre></div><p>salviamo come script1.lua e possiamo eseguirlo da shell:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>$ lua script1.lua</span></span></code></pre></div><p>Da questo esempio impariamo la sintassi del ciclo for &rsquo;numerico&rsquo; ed osserviamo che nelle chiamate a funzione (print e&rsquo; una funzione della libreria di sistema) se ci sono piu&rsquo; parametri dobbiamo usare le parentesi tonde per delimitare gli argomenti. A tal proposito possiamo consultare la <a href=http://www.luafaq.org/gotchas.html#T7>FAQ</a>.</p><p>Lua permette anche la precompilazione: se vogliamo evitare di distribuire i sorgenti, possiamo conservare sul disco solo la versione bytecode del nostro programma; invocando Lua Compiler:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>$ luac -o script1.luac script1.lua</span></span></code></pre></div><p>troveremo nella directory un nuovo file binario; lo possiamo eseguire allo stesso modo del precedente:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>$ lua script1.luac</span></span></code></pre></div><p>e ovviamente otteniamo gli stessi risultati. Potremmo anche usare l&rsquo;opzione -s per rimuovere i simboli di debug dal compilato.</p><p>Ora che il linguaggio e&rsquo; installato e funzionante, cominceremo ad approfondirne i dettagli; questo non potra&rsquo; essere un &ldquo;corso di programmazione Lua&rdquo; completo, ma cercheremo di evidenziare gli aspetti principali, rimandando alla documentazione ufficiale per gli indispensabili approfondimenti.</p></div><footer class=content__footer></footer></section><section class=page__aside><div class=aside__about><div class=aside__about><img class=about__logo src=https://ilmanzo.github.io/images/rice.svg alt=Logo><h1 class=about__title>Andrea Manzini</h1><p class=about__description>A minimalist, pragmatic website and personal blog</p></div><ul class=aside__social-links><li><a href=https://github.com/ilmanzo rel=me aria-label=GitHub title=GitHub><i class="fab fa-github" aria-hidden=true></i></a>&nbsp;</li><li><a href=mailto:ilmanzo@gmail.com rel=me aria-label=Email title=Email><i class="fas fa-envelope" aria-hidden=true></i></a>&nbsp;</li><li><a href=https://www.linkedin.com/in/andreamanzini rel=me aria-label=Linkedin title=Linkedin><i class="fab fa-linkedin" aria-hidden=true></i></a>&nbsp;</li><li><a href=https://twitter.com/ilmanzo rel=me aria-label=Twitter title=Twitter><i class="fab fa-twitter" aria-hidden=true></i></a>&nbsp;</li></ul></div><hr><div class=aside__content><p>introduzione al linguaggio Lua</p><p>By Andrea Manzini,
2016-04-13</p></div></section><footer class=page__footer><p class=copyright>© 2022 Andrea Manzini</p><p class=advertisement>Powered by <a href=https://gohugo.io/>hugo</a> and <a href=https://github.com/joeroe/risotto>risotto</a>.</p><script async src="https://www.googletagmanager.com/gtag/js?id=G-YWMGBSCHM5"></script>
<script>var doNotTrack=!1;if(!doNotTrack){window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-YWMGBSCHM5",{anonymize_ip:!1})}</script></footer></div></body></html>