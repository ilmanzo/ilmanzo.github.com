<!doctype html><html lang=en dir=auto><head><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>il linguaggio Lua: quinta parte | ilManzo's blog</title><meta name=keywords content="lua,programming,tutorial,linux,italian"><meta name=description content="introduzione al linguaggio Lua"><meta name=author content="Andrea Manzini"><link rel=canonical href=https://ilmanzo.github.io/post/il-linguaggio-lua-05/><link crossorigin=anonymous href=/assets/css/stylesheet.8fe10233a706bc87f2e08b3cf97b8bd4c0a80f10675a143675d59212121037c0.css integrity="sha256-j+ECM6cGvIfy4Is8+XuL1MCoDxBnWhQ2ddWSEhIQN8A=" rel="preload stylesheet" as=style><link rel=icon href=https://ilmanzo.github.io/favicon.ico><link rel=icon type=image/png sizes=16x16 href=https://ilmanzo.github.io/favicon-16x16.png><link rel=icon type=image/png sizes=32x32 href=https://ilmanzo.github.io/favicon-32x32.png><link rel=apple-touch-icon href=https://ilmanzo.github.io/apple-touch-icon.png><link rel=mask-icon href=https://ilmanzo.github.io/safari-pinned-tab.svg><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><link rel=alternate hreflang=en href=https://ilmanzo.github.io/post/il-linguaggio-lua-05/><noscript><style>#theme-toggle,.top-link{display:none}</style></noscript><script async src="https://www.googletagmanager.com/gtag/js?id=G-6PN4FTRLNL"></script><script>var dnt,doNotTrack=!1;if(!1&&(dnt=navigator.doNotTrack||window.doNotTrack||navigator.msDoNotTrack,doNotTrack=dnt=="1"||dnt=="yes"),!doNotTrack){window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-6PN4FTRLNL")}</script><meta property="og:url" content="https://ilmanzo.github.io/post/il-linguaggio-lua-05/"><meta property="og:site_name" content="ilManzo's blog"><meta property="og:title" content="il linguaggio Lua: quinta parte"><meta property="og:description" content="introduzione al linguaggio Lua"><meta property="og:locale" content="en-us"><meta property="og:type" content="article"><meta property="article:section" content="post"><meta property="article:published_time" content="2017-10-16T00:00:00+00:00"><meta property="article:modified_time" content="2017-10-16T00:00:00+00:00"><meta property="article:tag" content="Lua"><meta property="article:tag" content="Programming"><meta property="article:tag" content="Tutorial"><meta property="article:tag" content="Linux"><meta property="article:tag" content="Italian"><meta name=twitter:card content="summary"><meta name=twitter:title content="il linguaggio Lua: quinta parte"><meta name=twitter:description content="introduzione al linguaggio Lua"><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Posts","item":"https://ilmanzo.github.io/post/"},{"@type":"ListItem","position":2,"name":"il linguaggio Lua: quinta parte","item":"https://ilmanzo.github.io/post/il-linguaggio-lua-05/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"il linguaggio Lua: quinta parte","name":"il linguaggio Lua: quinta parte","description":"introduzione al linguaggio Lua","keywords":["lua","programming","tutorial","linux","italian"],"articleBody":"segue dalla quarta parte\n“Sonata al chiaro di luna” : un plugin per vlc Come dicevamo all’inizio, Lua è usato da numerose applicazioni come linguaggio di estensione; per scopi didattici ho scelto di scrivere un semplice plugin per un programma diffuso, il media player universale VLC. Con questo plugin risolveremo per sempre l’annoso problema di decidere cosa sarebbe meglio sgranocchiare durante la visione! L’integrazione con lo scripting Lua è documentata in una serie di file README.TXT sparsi nella directory $SRC/share/lua/ (dove $SRC è la directory dove abbiamo decompresso l’archivio del sorgente di vlc). Grazie ad essi apprendiamo che VLC supporta diversi tipi di “agganci” (hooks) con Lua: per la generazione di playlist (ad esempio trasformare una playlist Youtube in una VLC), per le interfacce di controllo (a titolo di esempio, si può comandare VLC via telnet), per il recupero di meta-informazioni sullo stream (tipicamente scaricare e visualizzare la copertina dell’album o la locandina del film in riproduzione) e, finalmente, quella che useremo noi, cioè una generica funzionalità aggiuntiva attivabile e disattivabile da menù. Il file README specifica che questo tipo di estensione deve contenere due funzioni Lua di nome activate() e deactivate() che verranno chiamte in concomitanza con questi due eventi. Lo script deve avere anche una funzione descriptor() che VLC chiamerà allo startup ed avrà il compito di esporre una tabella con delle informazioni sul plugin come titolo, autore, versione. Ultimo vincolo, lo script deve risiedere in uno specifico path, ovvero $LIB/vlc/lua, dove $LIB è il percorso di libvlc (il “motore” del programma) a livello di sistema oppure $HOME/.local/share/vlc/lua, soluzione che permette ad ogni utente di usare i propri plugin; io ho pertanto copiato lo script seguente [vlc_cibo.lua] in ~/.local/share/vlc/lua/extensions/cibo.lua\n-- da salvare in $HOME/.local/share/vlc/lua/extensions -- ritorna una tabella con una serie di dati sul plugin -- ad esempio il titolo da mostrare nel menu function descriptor() return { version = \"0.1\"; capabilities = {}; title=\"cibarie giuste\"; } end -- funzione chiamata quando l'utente seleziona il plugin dal menu function activate() local durata=vlc.input.item():duration() durata=math.floor(durata/60) local msg=\"per soli \"..tostring(durata)..\" minuti ci accontentiamo del popcorn\" if durata\u003e60 then msg=\"il film sembra lungo, meglio ordinare una pizza\" end dlg=vlc.dialog(\"cibarie giuste\") dlg:add_label(msg) dlg:add_button(\"Chiudi\",clicked) -- associa al click del pulsante la funzione clicked vlc.playlist.pause() -- ferma la riproduzione end -- chiamata quando l'utente clicca sul pulsante Chiudi della message box function clicked() vlc.deactivate() end -- chiamata da VLC quando l'utente disattiva il plugin function deactivate() vlc.playlist.play() -- fa ripartire il filmato end function close() vlc.deactivate() end Analizziamo rapidamente il sorgente; dopo i commenti iniziali troviamo la funzione descriptor, che nel nostro caso inizializza e ritorna al chiamante una tabella con un solo campo, cioè il titolo del plugin; è l’unico indispensabile e come si vede in figura è ciò che troveremo come voce di menu in VLC.\nLa seconda funzione è cruciale: viene chiamata quando l’utente seleziona il plugin. Come prima cosa si fa dare la durata in secondi dell’attuale media in riproduzione. VLC infatti espone verso Lua un “oggetto” vlc (vedremo nel prossimo articolo come implementare questa tecnica) tramite il quale ciascun plugin può interagire col media player. Grazie alla documentazione apprendiamo che la funzione input.item() dell’oggetto vlc ritorna un riferimento al film che stiamo guardando. A sua volta questo oggetto ha una serie di metodi, tra i quali duration() che fornisce la lunghezza in secondi. In questo esempio la durata viene convertita in minuti (divisione per 60) ed utilizzata come parametro per stabilire quale messaggio visualizzare. Usando ancora l’oggetto vlc, chiediamo al programma di creare per noi una dialog box nella quale inseriamo la nostra scritta ed un pulsante, il cui evento click viene associato ad una nostra funzione. Come ultima operazione, decidiamo di attirare l’attenzione chiedendo al media player di mettere in pausa la riproduzione, così l’utente potrà leggere l’avviso e prepararsi le giuste cibarie!\nLa terza funzione dello script è quella che viene chiamata da VLC quando l’utente ha cliccato sul pulsante della dialog box; in questo esempio abbiamo scelto di disattivare il plugin (provocando quindi l’esecuzione della prossima funzione), ma nessuno ci vieta di scrivere del codice per ordinare effettivamente la pizza tramite un web service… Ci resta solo la deactivate(): qui andrebbero eseguite tutte le operazioni di pulizia del plugin, nel nostro caso ci limitiamo a far ripartire il filmato.\nA parte la dubbia utilità di questo plugin didattico, possiamo notare alcune cose interessanti: anzitutto la robustezza, nel senso che qualunque errore o problema in uno script Lua non metterà minimamente in crisi il programma principale; apprezziamo inoltre la chiarezza e la semplicità di avere interfacce ben definite, nel senso che il team VLC ha deciso per noi cosa esporre del programma e come farlo, nascondendoci la complessità dell’implementazione, ma allo stesso tempo consentendoci di aggiungere nostre funzionalità. Infine non trascuriamo la portabilità, ovvero che questo plugin funzionerà allo stesso modo e senza modifiche anche in ambiente Windows o Mac.\n","wordCount":"812","inLanguage":"en","datePublished":"2017-10-16T00:00:00Z","dateModified":"2017-10-16T00:00:00Z","author":{"@type":"Person","name":"Andrea Manzini"},"mainEntityOfPage":{"@type":"WebPage","@id":"https://ilmanzo.github.io/post/il-linguaggio-lua-05/"},"publisher":{"@type":"Organization","name":"ilManzo's blog","logo":{"@type":"ImageObject","url":"https://ilmanzo.github.io/favicon.ico"}}}</script></head><body class=dark id=top><script>localStorage.getItem("pref-theme")==="light"&&document.body.classList.remove("dark")</script><header class=header><nav class=nav><div class=logo><a href=https://ilmanzo.github.io/ accesskey=h title="ilManzo's blog (Alt + H)">ilManzo's blog</a><div class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)" aria-label="Toggle theme">
<svg id="moon" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg>
<svg id="sun" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></div></div><ul id=menu><li><a href=https://ilmanzo.github.io/curriculum title=Curriculum><span>Curriculum</span></a></li><li><a href=https://ilmanzo.github.io/tags title=Tags><span>Tags</span></a></li><li><a href=https://ilmanzo.github.io/categories title=Categories><span>Categories</span></a></li><li><a href=https://ilmanzo.github.io/search title="Search (Alt + /)" accesskey=/><span>Search</span></a></li><li><a href=https://ilmanzo.github.io/post/ title=Posts><span>Posts</span></a></li></ul></nav></header><main class=main><article class=post-single><header class=post-header><div class=breadcrumbs><a href=https://ilmanzo.github.io/>Home</a>&nbsp;»&nbsp;<a href=https://ilmanzo.github.io/post/>Posts</a></div><h1 class="post-title entry-hint-parent">il linguaggio Lua: quinta parte</h1><div class=post-description>introduzione al linguaggio Lua</div><div class=post-meta><span title='2017-10-16 00:00:00 +0000 UTC'>October 16, 2017</span>&nbsp;·&nbsp;Andrea Manzini</div></header><div class=post-content><p>segue dalla <a href=https://ilmanzo.github.io/post/il-linguaggio-lua-04/>quarta parte</a></p><h1 id=sonata-al-chiaro-di-luna--un-plugin-per-vlc>“Sonata al chiaro di luna” : un plugin per vlc<a hidden class=anchor aria-hidden=true href=#sonata-al-chiaro-di-luna--un-plugin-per-vlc>#</a></h1><p>Come dicevamo all&rsquo;inizio, Lua è usato da numerose applicazioni come linguaggio di estensione; per scopi didattici ho scelto di scrivere un semplice plugin per un programma diffuso, il media player universale VLC. Con questo plugin risolveremo per sempre l&rsquo;annoso problema di decidere cosa sarebbe meglio sgranocchiare durante la visione!
L&rsquo;integrazione con lo scripting Lua è <a href=https://www.videolan.org/developers/vlc/share/lua/README.txt>documentata</a> in una serie di file <code>README.TXT</code> sparsi nella directory <code>$SRC/share/lua/</code> (dove <code>$SRC</code> è la directory dove abbiamo decompresso l&rsquo;archivio del sorgente di vlc). Grazie ad essi apprendiamo che VLC supporta diversi tipi di &ldquo;agganci&rdquo; (hooks) con Lua: per la generazione di playlist (ad esempio trasformare una playlist Youtube in una VLC), per le interfacce di controllo (a titolo di esempio, si può comandare VLC via telnet), per il recupero di meta-informazioni sullo stream (tipicamente scaricare e visualizzare la copertina dell&rsquo;album o la locandina del film in riproduzione) e, finalmente, quella che useremo noi, cioè una generica funzionalità aggiuntiva attivabile e disattivabile da menù.
Il file README specifica che questo tipo di estensione deve contenere due funzioni Lua di nome activate() e deactivate() che verranno chiamte in concomitanza con questi due eventi. Lo script deve avere anche una funzione descriptor() che VLC chiamerà allo startup ed avrà il compito di esporre una tabella con delle informazioni sul plugin come titolo, autore, versione. Ultimo vincolo, lo script deve risiedere in uno specifico path, ovvero $LIB/vlc/lua, dove $LIB è il percorso di libvlc (il “motore” del programma) a livello di sistema oppure $HOME/.local/share/vlc/lua, soluzione che permette ad ogni utente di usare i propri plugin; io ho pertanto copiato lo script seguente <code>[vlc_cibo.lua]</code> in <code>~/.local/share/vlc/lua/extensions/cibo.lua</code></p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-lua data-lang=lua><span style=display:flex><span><span style=color:#75715e>-- da salvare in $HOME/.local/share/vlc/lua/extensions</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>-- ritorna una tabella con una serie di dati sul plugin</span>
</span></span><span style=display:flex><span><span style=color:#75715e>-- ad esempio il titolo da mostrare nel menu</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>function</span> <span style=color:#a6e22e>descriptor</span>()
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> { 
</span></span><span style=display:flex><span>      version <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;0.1&#34;</span>;
</span></span><span style=display:flex><span>      capabilities <span style=color:#f92672>=</span> {};
</span></span><span style=display:flex><span>      title<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;cibarie giuste&#34;</span>; 
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span><span style=color:#66d9ef>end</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>-- funzione chiamata quando l&#39;utente seleziona il plugin dal menu</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>function</span> <span style=color:#a6e22e>activate</span>()
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>local</span> durata<span style=color:#f92672>=</span>vlc.input.item():duration()
</span></span><span style=display:flex><span>    durata<span style=color:#f92672>=</span>math.floor(durata<span style=color:#f92672>/</span><span style=color:#ae81ff>60</span>)
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>local</span> msg<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;per soli &#34;</span><span style=color:#f92672>..</span>tostring(durata)<span style=color:#f92672>..</span><span style=color:#e6db74>&#34; minuti ci accontentiamo del popcorn&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> durata<span style=color:#f92672>&gt;</span><span style=color:#ae81ff>60</span> <span style=color:#66d9ef>then</span>
</span></span><span style=display:flex><span>      msg<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;il film sembra lungo, meglio ordinare una &lt;b&gt;pizza&lt;/b&gt;&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>end</span>
</span></span><span style=display:flex><span>    dlg<span style=color:#f92672>=</span>vlc.dialog(<span style=color:#e6db74>&#34;cibarie giuste&#34;</span>)
</span></span><span style=display:flex><span>    dlg:add_label(msg)
</span></span><span style=display:flex><span>    dlg:add_button(<span style=color:#e6db74>&#34;Chiudi&#34;</span>,clicked) <span style=color:#75715e>-- associa al click del pulsante la funzione clicked</span>
</span></span><span style=display:flex><span>    vlc.playlist.pause() <span style=color:#75715e>-- ferma la riproduzione</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>end</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>-- chiamata quando l&#39;utente clicca sul pulsante Chiudi della message box</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>function</span> <span style=color:#a6e22e>clicked</span>()
</span></span><span style=display:flex><span>    vlc.deactivate()
</span></span><span style=display:flex><span><span style=color:#66d9ef>end</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>-- chiamata da VLC quando l&#39;utente disattiva il plugin</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>function</span> <span style=color:#a6e22e>deactivate</span>()
</span></span><span style=display:flex><span>    vlc.playlist.play() <span style=color:#75715e>-- fa ripartire il filmato</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>end</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>function</span> <span style=color:#a6e22e>close</span>()
</span></span><span style=display:flex><span>    vlc.deactivate()
</span></span><span style=display:flex><span><span style=color:#66d9ef>end</span></span></span></code></pre></div><p>Analizziamo rapidamente il sorgente; dopo i commenti iniziali troviamo la funzione descriptor, che nel nostro caso inizializza e ritorna al chiamante una tabella con un solo campo, cioè il titolo del plugin; è l&rsquo;unico indispensabile e come si vede in figura è ciò che troveremo come voce di menu in VLC.</p><p><img alt=figura7_lua_vlc loading=lazy src=/img/lua_fig007_vlc_luaplugin_menu.png title="vlc menu with added plugin"></p><p>La seconda funzione è cruciale: viene chiamata quando l&rsquo;utente seleziona il plugin. Come prima cosa si fa dare la durata in secondi dell&rsquo;attuale media in riproduzione. VLC infatti espone verso Lua un “oggetto” vlc (vedremo nel prossimo articolo come implementare questa tecnica) tramite il quale ciascun plugin può interagire col media player. Grazie alla documentazione apprendiamo che la funzione input.item() dell&rsquo;oggetto vlc ritorna un riferimento al film che stiamo guardando. A sua volta questo oggetto ha una serie di metodi, tra i quali duration() che fornisce la lunghezza in secondi. In questo esempio la durata viene convertita in minuti (divisione per 60) ed utilizzata come parametro per stabilire quale messaggio visualizzare.
Usando ancora l&rsquo;oggetto vlc, chiediamo al programma di creare per noi una dialog box nella quale inseriamo la nostra scritta ed un pulsante, il cui evento click viene associato ad una nostra funzione. Come ultima operazione, decidiamo di attirare l&rsquo;attenzione chiedendo al media player di mettere in pausa la riproduzione, così l&rsquo;utente potrà leggere l&rsquo;avviso e prepararsi le giuste cibarie!</p><p><img alt=figura8_lua_vlc loading=lazy src=/img/lua_fig008_vlc_luaplugin_attivo.png title="vlc with plugin active"></p><p>La terza funzione dello script è quella che viene chiamata da VLC quando l&rsquo;utente ha cliccato sul pulsante della dialog box; in questo esempio abbiamo scelto di disattivare il plugin (provocando quindi l&rsquo;esecuzione della prossima funzione), ma nessuno ci vieta di scrivere del codice per ordinare effettivamente la pizza tramite un web service&mldr;
Ci resta solo la deactivate(): qui andrebbero eseguite tutte le operazioni di pulizia del plugin, nel nostro caso ci limitiamo a far ripartire il filmato.</p><p>A parte la dubbia utilità di questo plugin didattico, possiamo notare alcune cose interessanti: anzitutto la robustezza, nel senso che qualunque errore o problema in uno script Lua non metterà minimamente in crisi il programma principale; apprezziamo inoltre la chiarezza e la semplicità di avere interfacce ben definite, nel senso che il team VLC ha deciso per noi cosa esporre del programma e come farlo, nascondendoci la complessità dell&rsquo;implementazione, ma allo stesso tempo consentendoci di aggiungere nostre funzionalità. Infine non trascuriamo la portabilità, ovvero che questo plugin funzionerà allo stesso modo e senza modifiche anche in ambiente Windows o Mac.</p></div><footer class=post-footer><ul class=post-tags><li><a href=https://ilmanzo.github.io/tags/lua/>Lua</a></li><li><a href=https://ilmanzo.github.io/tags/programming/>Programming</a></li><li><a href=https://ilmanzo.github.io/tags/tutorial/>Tutorial</a></li><li><a href=https://ilmanzo.github.io/tags/linux/>Linux</a></li><li><a href=https://ilmanzo.github.io/tags/italian/>Italian</a></li></ul><nav class=paginav><a class=prev href=https://ilmanzo.github.io/post/access-dhcp-options-from-client/><span class=title>« Prev</span><br><span>linux: how to access DHCP options from client</span>
</a><a class=next href=https://ilmanzo.github.io/post/il-linguaggio-lua-04/><span class=title>Next »</span><br><span>il linguaggio Lua: parte 4</span></a></nav></footer></article></main><footer class=footer><span>© 2012-2024 Andrea Manzini</span> ·
<span>Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
<a href=https://github.com/adityatelange/hugo-PaperMod/ rel=noopener target=_blank>PaperMod</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg viewBox="0 0 12 6" fill="currentColor"><path d="M12 6H0l6-6z"/></svg>
</a><script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))})</script><script>document.querySelectorAll("pre > code").forEach(e=>{const n=e.parentNode.parentNode,t=document.createElement("button");t.classList.add("copy-code"),t.innerHTML="copy";function s(){t.innerHTML="copied!",setTimeout(()=>{t.innerHTML="copy"},2e3)}t.addEventListener("click",t=>{if("clipboard"in navigator){navigator.clipboard.writeText(e.textContent),s();return}const n=document.createRange();n.selectNodeContents(e);const o=window.getSelection();o.removeAllRanges(),o.addRange(n);try{document.execCommand("copy"),s()}catch{}o.removeRange(n)}),n.classList.contains("highlight")?n.appendChild(t):n.parentNode.firstChild==n||(e.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName=="TABLE"?e.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(t):e.parentNode.appendChild(t))})</script></body></html>