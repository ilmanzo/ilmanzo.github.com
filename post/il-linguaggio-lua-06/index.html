<!doctype html><html lang=en><head><title>il linguaggio Lua: sesta parte &ndash; ilManzo's blog</title><meta name=description content="A minimalist, pragmatic website and personal blog"><meta name=viewport content="width=device-width,initial-scale=1"><meta charset=utf-8><link rel=stylesheet href=https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.2/css/all.min.css integrity="sha512-HK5fgLBL+xu6dm/Ii3z4xhlSUyZgTT9tuc/hSrtw6uzJOvgRr2a9jyxxT1ely+B+xFAmJKVSTbpM/CuL7qxO8w==" crossorigin=anonymous><link rel=stylesheet href=https://cdnjs.cloudflare.com/ajax/libs/academicons/1.9.1/css/academicons.min.css integrity="sha512-b1ASx0WHgVFL5ZQhTgiPWX+68KjS38Jk87jg7pe+qC7q9YkEtFq0z7xCglv7qGIs/68d3mAp+StfC8WKC5SSAg==" crossorigin=anonymous><link rel=stylesheet href=https://ilmanzo.github.io/css/colour/gruvbox-dark.css><link rel=stylesheet href=https://ilmanzo.github.io/css/colour/dark-mode.css><link rel=stylesheet href=https://ilmanzo.github.io/css/risotto.css><link rel=stylesheet href=https://ilmanzo.github.io/css/custom.css></head><body><div class=page><header class=page__header><h1 class=page__logo><a href=https://ilmanzo.github.io/ class=page__logo-inner>ilManzo's blog</a></h1><nav class="page__nav main-nav"><ul><li class=main-nav__item><a class=nav-main-item href=/curriculum title>Curriculum</a></li><li class=main-nav__item><a class=nav-main-item href=/categories title>Categories</a></li><li class=main-nav__item><a class=nav-main-item href=/tags title>Tags</a></li><li class=main-nav__item><a class="nav-main-item active" href=/post/ title=Posts>Posts</a></li></ul></nav></header><section class=page__body><header class=content__header><h1>il linguaggio Lua: sesta parte</h1></header><div class=content__body><p>segue dalla <a href=https://ilmanzo.github.io/post/il-linguaggio-lua-05/>quinta parte</a></p><h1 id=quando-il-saggio-indica-la-luna-lo-sciocco-guarda-il-dito>Quando il saggio indica la luna, lo sciocco guarda il dito</h1><p>Nello scorse puntate abbiamo appreso le basi di un linguaggio minimalista, il cui motto è “doing more with less”, che occupa meno byte della vostra foto su Facebook e che i benchmark dichiarano il più veloce tra i linguaggi di scripting. Nato da menti brasiliane, l&rsquo;hanno chiamato Lua, che vuol dire Luna in portoghese. Lua viene usato come linguaggio di scripting in Angry Birds, World of Warcraft e decine di altri videogame e software: nello scorso post abbiamo visto come creare un semplice plugin per VLC. In questo invece approfondiremo le peculiarità del linguaggio e cominceremo a guardare oltre, presentando l’ecosistema di librerie; infine nel prossimo sperimenteremo l’integrazione tra Lua e C.</p><h1 id=luna-di-miele-zucchero-sintattico>Luna di miele: zucchero sintattico</h1><p>Abbiamo già studiato due elementi chiave del linguaggio Lua: le funzioni e le tabelle. L&rsquo;uso di questi costrutti è talmente comune che gli autori ci mettono a disposizione alcune scorciatoie. Ad esempio scrivere</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-lua data-lang=lua><span style=display:flex><span>libro.pagine<span style=color:#f92672>=</span><span style=color:#ae81ff>268</span></span></span></code></pre></div><p>equivale a</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-lua data-lang=lua><span style=display:flex><span>libro[<span style=color:#960050;background-color:#1e0010>“</span>pagine<span style=color:#960050;background-color:#1e0010>”</span>]<span style=color:#f92672>=</span><span style=color:#ae81ff>268</span></span></span></code></pre></div><p>attenzione: non è invece la stessa cosa scrivere <strong>libro[pagine]</strong>, perché quest&rsquo;ultima espressione usa l&rsquo;eventuale variabile &ldquo;pagine&rdquo; come chiave nell&rsquo;array associativo. Se pagine non è una variabile definita, in questo caso sarebbe come scrivere libro[nil]=268 il che causerebbe un errore.
Capita spesso di chiamare una funzione passando un solo argomento: se tale argomento è una costante di tipo stringa o tabella, possiamo omettere le parentesi tonde; quindi func(“ciao”) diventa func “ciao” e, analogamente, potremo tradurre</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-lua data-lang=lua><span style=display:flex><span>func(<span style=color:#e6db74>[[ci vediamo presto]]</span>)</span></span></code></pre></div><p>con</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-lua data-lang=lua><span style=display:flex><span>func<span style=color:#e6db74>[[ci vediamo presto]]</span></span></span></code></pre></div><p>inoltre funz({x=3,y=4}) si può scrivere con un più succinto funz{x=3,y=4}. In questo ultimo caso di fatto otteniamo quello che in altri linguaggi si chiama &rsquo;named parameters&rsquo;, ovvero il passaggio di argomenti per nome (e non per posizione) e con lo stesso meccanismo possiamo predisporre dei valori di default ai parametri. Vediamo un gustoso esempio:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-lua data-lang=lua><span style=display:flex><span><span style=color:#66d9ef>function</span> <span style=color:#a6e22e>cena</span>(dettagli)
</span></span><span style=display:flex><span>  <span style=color:#75715e>--valorizza parametri con valori di default</span>
</span></span><span style=display:flex><span>  primo<span style=color:#f92672>=</span>dettagli.primo <span style=color:#f92672>or</span> <span style=color:#e6db74>&#34;pasta&#34;</span>
</span></span><span style=display:flex><span>  secondo<span style=color:#f92672>=</span>dettagli.secondo <span style=color:#f92672>or</span> <span style=color:#e6db74>&#34;pesce&#34;</span>
</span></span><span style=display:flex><span>  quando<span style=color:#f92672>=</span>dettagli.quando <span style=color:#f92672>or</span> <span style=color:#e6db74>&#34;stasera&#34;</span>
</span></span><span style=display:flex><span>  print(quando<span style=color:#f92672>..</span><span style=color:#e6db74>&#34; preparo &#34;</span><span style=color:#f92672>..</span>primo<span style=color:#f92672>..</span><span style=color:#e6db74>&#34; e &#34;</span><span style=color:#f92672>..</span>secondo)
</span></span><span style=display:flex><span><span style=color:#66d9ef>end</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>cena{secondo<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;carne&#34;</span>}
</span></span><span style=display:flex><span>cena{primo<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;risotto&#34;</span>,quando<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;domani&#34;</span>}</span></span></code></pre></div><p>l’output sarà:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-lua data-lang=lua><span style=display:flex><span>stasera mangio pasta e carne
</span></span><span style=display:flex><span>domani mangio risotto e pesce</span></span></code></pre></div><p>in pratica passiamo alla funzione una sola hashtable che contiene tutti i parametri necessari; se uno di questi non viene valorizzato, vale NIL e perciò possiamo inizializzarlo con un valore di default.</p><p>Una funzione che accetti un numero variabile di argomenti si dichiara con la sintassi a “punti di sospensione”</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-lua data-lang=lua><span style=display:flex><span><span style=color:#66d9ef>function</span> <span style=color:#a6e22e>chain</span>(...)
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>local</span> result<span style=color:#f92672>=</span><span style=color:#960050;background-color:#1e0010>””</span>
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>for</span> i,v <span style=color:#66d9ef>in</span> ipairs(arg) <span style=color:#66d9ef>do</span>
</span></span><span style=display:flex><span>    result<span style=color:#f92672>=</span>result<span style=color:#f92672>..</span>tostring(v)
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>end</span>
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>return</span> result
</span></span><span style=display:flex><span><span style=color:#66d9ef>end</span></span></span></code></pre></div><p>questa funzione restituisce una stringa accodando tutti i parametri. Come possiamo vedere, gli argomenti vengono passati tramite l&rsquo;array convenzionale arg. Notiamo anche l&rsquo;uso dell&rsquo;iteratore ipairs(), aspetto che approfondiremo in seguito.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-lua data-lang=lua><span style=display:flex><span>print(chain(<span style=color:#ae81ff>3</span>,<span style=color:#960050;background-color:#1e0010>”\</span><span style=color:#ae81ff>064</span><span style=color:#960050;background-color:#1e0010>”</span>,<span style=color:#f92672>-</span><span style=color:#ae81ff>5</span>))
</span></span><span style=display:flex><span><span style=color:#ae81ff>3</span><span style=color:#960050;background-color:#1e0010>@</span><span style=color:#f92672>-</span><span style=color:#ae81ff>5</span></span></span></code></pre></div><p>per i più esperti, facciamo presente che le stringhe Lua sono immutabili, perciò per concatenare stringhe piuttosto grandi, il metodo usato in chain() è inefficiente, in quanto provoca continue allocazioni/deallocazioni. Più avanti ne scriveremo una versione ottimizzata.</p></div><footer class=content__footer></footer></section><section class=page__aside><div class=aside__about><div class=aside__about><img class=about__logo src=https://ilmanzo.github.io/images/rice.svg alt=Logo><h1 class=about__title>Andrea Manzini</h1><p class=about__description>A minimalist, pragmatic website and personal blog</p></div><ul class=aside__social-links><li><a href=https://github.com/ilmanzo rel=me aria-label=GitHub title=GitHub><i class="fab fa-github" aria-hidden=true></i></a>&nbsp;</li><li><a href=mailto:ilmanzo@gmail.com rel=me aria-label=Email title=Email><i class="fas fa-envelope" aria-hidden=true></i></a>&nbsp;</li><li><a href=https://www.linkedin.com/in/andreamanzini rel=me aria-label=Linkedin title=Linkedin><i class="fab fa-linkedin" aria-hidden=true></i></a>&nbsp;</li><li><a href=https://twitter.com/ilmanzo rel=me aria-label=Twitter title=Twitter><i class="fab fa-twitter" aria-hidden=true></i></a>&nbsp;</li><li><a href=https://ilmanzo.github.io/index.xml rel=me aria-label="RSS Feed" title="RSS Feed"><i class="fas fa-rss-square" aria-hidden=true></i></a>&nbsp;</li></ul></div><hr><div class=aside__content><p>introduzione al linguaggio Lua</p><p>By Andrea Manzini,
2017-12-22</p></div></section><footer class=page__footer><p class=copyright>© 2022 Andrea Manzini</p><p class=advertisement>Powered by <a href=https://gohugo.io/>hugo</a> and <a href=https://github.com/joeroe/risotto>risotto</a>.</p><script async src="https://www.googletagmanager.com/gtag/js?id=G-6PN4FTRLNL"></script>
<script>var doNotTrack=!1;if(!doNotTrack){window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-6PN4FTRLNL",{anonymize_ip:!1})}</script></footer></div></body></html>