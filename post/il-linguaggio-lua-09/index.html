<!doctype html><html lang=en dir=auto><head><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>il linguaggio Lua: parte 9 | ilManzo's blog</title>
<meta name=keywords content="lua,programming,tutorial,linux,italian"><meta name=description content="introduzione al linguaggio Lua"><meta name=author content="Andrea Manzini"><link rel=canonical href=https://ilmanzo.github.io/post/il-linguaggio-lua-09/><link crossorigin=anonymous href=/assets/css/stylesheet.b609c58d5c11bb90b1a54e04005d74ad1ddf22165eb79f5533967e57df9c3b50.css integrity="sha256-tgnFjVwRu5CxpU4EAF10rR3fIhZet59VM5Z+V9+cO1A=" rel="preload stylesheet" as=style><link rel=icon href=https://ilmanzo.github.io/favicon.ico><link rel=icon type=image/png sizes=16x16 href=https://ilmanzo.github.io/favicon-16x16.png><link rel=icon type=image/png sizes=32x32 href=https://ilmanzo.github.io/favicon-32x32.png><link rel=apple-touch-icon href=https://ilmanzo.github.io/apple-touch-icon.png><link rel=mask-icon href=https://ilmanzo.github.io/safari-pinned-tab.svg><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><noscript><style>#theme-toggle,.top-link{display:none}</style></noscript><script async src="https://www.googletagmanager.com/gtag/js?id=G-6PN4FTRLNL"></script><script>var doNotTrack=!1;if(!doNotTrack){window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-6PN4FTRLNL",{anonymize_ip:!1})}</script><meta property="og:title" content="il linguaggio Lua: parte 9"><meta property="og:description" content="introduzione al linguaggio Lua"><meta property="og:type" content="article"><meta property="og:url" content="https://ilmanzo.github.io/post/il-linguaggio-lua-09/"><meta property="article:section" content="post"><meta property="article:published_time" content="2018-06-22T00:00:00+00:00"><meta property="article:modified_time" content="2018-06-22T00:00:00+00:00"><meta name=twitter:card content="summary"><meta name=twitter:title content="il linguaggio Lua: parte 9"><meta name=twitter:description content="introduzione al linguaggio Lua"><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Posts","item":"https://ilmanzo.github.io/post/"},{"@type":"ListItem","position":2,"name":"il linguaggio Lua: parte 9","item":"https://ilmanzo.github.io/post/il-linguaggio-lua-09/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"il linguaggio Lua: parte 9","name":"il linguaggio Lua: parte 9","description":"introduzione al linguaggio Lua","keywords":["lua","programming","tutorial","linux","italian"],"articleBody":"segue dalla parte 8\nil modulo lunare Per mantenere la sua natura minimalista, Lua ha ben poche funzionalità incluse nel linguaggio e delega molti aspetti a librerie e moduli esterni. Ad esempio le operazioni matematiche sono accessibili nel package, o se preferite, namespace col prefisso math:\n$ lua \u003eprint(math.sin(math.pi/2)) 1 sarebbe oltremodo noioso elencare tutte le funzioni presenti, basti dire che oltre alle funzioni trigonometriche abbiamo logaritmi, esponenziali, modulo, minimo, massimo, arrotondamenti e generazione di valori random. Per operare in modo agevole con tabelle e vettori abbiamo a disposizione il modulo table:\n\u003et={10,30,40} \u003etable.insert(t,2,\"venti\") \u003etable.insert(t,\"cinquanta\") \u003etable.foreach(t,print) 1 10 2 venti 3 30 4 40 5 cinquanta \u003ea={8,3,6,1,7} \u003etable.sort(a) \u003eprint(table.concat(a,\"-\")) 1-3-6-7-8 e, come promesso tempo fa, ecco versione ottimizzata della funzione chain():\nfunction chain2(...) local result={} for i,v in ipairs(arg) do result[i]=tostring(v) end return table.concat(result) end poiché evita la creazione di stringhe temporanee, questa funzione risulta di gran lunga più efficiente della precedente. Le funzioni di dialogo col sistema operativo sono invece raggruppate nel package os:\n\u003eprint(os.getenv('HOME')) /home/andrea \u003eos.execute('/bin/ls') mentre per gestire flussi di dati in ingresso e in uscita (input/output) servirà il modulo ‘io’:\nfdati=io.open('dati.txt','w') for i=1,10 do fdati:write(\"riga\",i,\"\\n\") end fdati:close() for riga in io.lines(\"dati.txt\") do print(\"lettura\",riga) end Per la manipolazione di stringhe useremo il prefisso string:\n$lua \u003ea=\"gnu/linux\" \u003eprint(string.upper(a)) GNU/LINUX \u003eb=string.rep(\"x\",2^20) -- stringa da 1 Megabyte \u003eprint(string.len(a..b)) 1048585 \u003eprint(string.sub(a,1,3)) -- primi tre caratteri gnu \u003eprint(string.sub(a,-5,-1) -- ultimi cinque caratteri linux lo stesso modulo contiene anche funzioni di formattazione, con una sintassi analoga alla printf(3) del C:\n\u003etag,titolo,numero=\"h1\",\"titolo\",2 \u003es=string.format(\"\u003c%s\u003e%s %d\u003c/%s\u003e\",tag,titolo,numero,tag) \u003eprint(s) \u003ch1\u003etitolo 2\u003c/h1\u003e string fornisce una implementazione ridotta, ma efficace, delle regular expression. Nell’interprete interattivo e nei nostri script le librerie built-in come math, io, os, string sono già disponibili senza dover specificare nient’altro; come vedremo più avanti, questo non vale più quando useremo Lua come libreria ’embedded’ nei programmi C, perché potremo scegliere di volta in volta le funzionalità da includere o meno, con il beneficio di snellire i nostri programmi togliendo le funzionalità che non usiamo.\n","wordCount":"328","inLanguage":"en","datePublished":"2018-06-22T00:00:00Z","dateModified":"2018-06-22T00:00:00Z","author":{"@type":"Person","name":"Andrea Manzini"},"mainEntityOfPage":{"@type":"WebPage","@id":"https://ilmanzo.github.io/post/il-linguaggio-lua-09/"},"publisher":{"@type":"Organization","name":"ilManzo's blog","logo":{"@type":"ImageObject","url":"https://ilmanzo.github.io/favicon.ico"}}}</script></head><body class=dark id=top><script>localStorage.getItem("pref-theme")==="light"&&document.body.classList.remove("dark")</script><header class=header><nav class=nav><div class=logo><a href=https://ilmanzo.github.io/ accesskey=h title="ilManzo's blog (Alt + H)">ilManzo's blog</a><div class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)"><svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></div></div><ul id=menu><li><a href=https://ilmanzo.github.io/curriculum title=Curriculum><span>Curriculum</span></a></li><li><a href=https://ilmanzo.github.io/tags title=Tags><span>Tags</span></a></li><li><a href=https://ilmanzo.github.io/categories title=Categories><span>Categories</span></a></li><li><a href=https://ilmanzo.github.io/search title="Search (Alt + /)" accesskey=/><span>Search</span></a></li><li><a href=https://ilmanzo.github.io/post/ title=Posts><span>Posts</span></a></li></ul></nav></header><main class=main><article class=post-single><header class=post-header><div class=breadcrumbs><a href=https://ilmanzo.github.io/>Home</a>&nbsp;»&nbsp;<a href=https://ilmanzo.github.io/post/>Posts</a></div><h1 class="post-title entry-hint-parent">il linguaggio Lua: parte 9</h1><div class=post-description>introduzione al linguaggio Lua</div><div class=post-meta><span title='2018-06-22 00:00:00 +0000 UTC'>June 22, 2018</span>&nbsp;·&nbsp;Andrea Manzini</div></header><div class=post-content><p>segue dalla <a href=https://ilmanzo.github.io/post/il-linguaggio-lua-08/>parte 8</a></p><h1 id=il-modulo-lunare>il modulo lunare<a hidden class=anchor aria-hidden=true href=#il-modulo-lunare>#</a></h1><p>Per mantenere la sua natura minimalista, Lua ha ben poche funzionalità incluse nel linguaggio e delega molti aspetti a librerie e moduli esterni. Ad esempio le operazioni matematiche sono accessibili nel package, o se preferite, <strong>namespace</strong> col prefisso <em>math</em>:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>$ lua
</span></span><span style=display:flex><span>&gt;print<span style=color:#f92672>(</span>math.sin<span style=color:#f92672>(</span>math.pi/2<span style=color:#f92672>))</span>
</span></span><span style=display:flex><span><span style=color:#ae81ff>1</span></span></span></code></pre></div><p>sarebbe oltremodo noioso elencare tutte le funzioni presenti, basti dire che oltre alle funzioni trigonometriche abbiamo logaritmi, esponenziali, modulo, minimo, massimo, arrotondamenti e generazione di valori random.
Per operare in modo agevole con tabelle e vettori abbiamo a disposizione il modulo <em>table</em>:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-lua data-lang=lua><span style=display:flex><span><span style=color:#f92672>&gt;</span>t<span style=color:#f92672>=</span>{<span style=color:#ae81ff>10</span>,<span style=color:#ae81ff>30</span>,<span style=color:#ae81ff>40</span>}
</span></span><span style=display:flex><span><span style=color:#f92672>&gt;</span>table.insert(t,<span style=color:#ae81ff>2</span>,<span style=color:#e6db74>&#34;venti&#34;</span>)
</span></span><span style=display:flex><span><span style=color:#f92672>&gt;</span>table.insert(t,<span style=color:#e6db74>&#34;cinquanta&#34;</span>)
</span></span><span style=display:flex><span><span style=color:#f92672>&gt;</span>table.foreach(t,print)
</span></span><span style=display:flex><span><span style=color:#ae81ff>1</span> <span style=color:#ae81ff>10</span>
</span></span><span style=display:flex><span><span style=color:#ae81ff>2</span> venti
</span></span><span style=display:flex><span><span style=color:#ae81ff>3</span> <span style=color:#ae81ff>30</span>
</span></span><span style=display:flex><span><span style=color:#ae81ff>4</span> <span style=color:#ae81ff>40</span>
</span></span><span style=display:flex><span><span style=color:#ae81ff>5</span> cinquanta
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>&gt;</span>a<span style=color:#f92672>=</span>{<span style=color:#ae81ff>8</span>,<span style=color:#ae81ff>3</span>,<span style=color:#ae81ff>6</span>,<span style=color:#ae81ff>1</span>,<span style=color:#ae81ff>7</span>}
</span></span><span style=display:flex><span><span style=color:#f92672>&gt;</span>table.sort(a)
</span></span><span style=display:flex><span><span style=color:#f92672>&gt;</span>print(table.concat(a,<span style=color:#e6db74>&#34;-&#34;</span>))
</span></span><span style=display:flex><span><span style=color:#ae81ff>1</span><span style=color:#f92672>-</span><span style=color:#ae81ff>3</span><span style=color:#f92672>-</span><span style=color:#ae81ff>6</span><span style=color:#f92672>-</span><span style=color:#ae81ff>7</span><span style=color:#f92672>-</span><span style=color:#ae81ff>8</span></span></span></code></pre></div><p>e, come promesso tempo fa, ecco versione ottimizzata della funzione chain():</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-lua data-lang=lua><span style=display:flex><span><span style=color:#66d9ef>function</span> <span style=color:#a6e22e>chain2</span>(...)
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>local</span> result<span style=color:#f92672>=</span>{}
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>for</span> i,v <span style=color:#66d9ef>in</span> ipairs(arg) <span style=color:#66d9ef>do</span>
</span></span><span style=display:flex><span>    result[i]<span style=color:#f92672>=</span>tostring(v)
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>end</span>
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>return</span> table.concat(result)
</span></span><span style=display:flex><span><span style=color:#66d9ef>end</span></span></span></code></pre></div><p>poiché evita la creazione di stringhe temporanee, questa funzione risulta di gran lunga più efficiente della precedente.
Le funzioni di dialogo col sistema operativo sono invece raggruppate nel package <em>os</em>:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-lua data-lang=lua><span style=display:flex><span><span style=color:#f92672>&gt;</span>print(os.getenv(<span style=color:#e6db74>&#39;HOME&#39;</span>))
</span></span><span style=display:flex><span><span style=color:#f92672>/</span>home<span style=color:#f92672>/</span>andrea
</span></span><span style=display:flex><span><span style=color:#f92672>&gt;</span>os.execute(<span style=color:#e6db74>&#39;/bin/ls&#39;</span>)</span></span></code></pre></div><p>mentre per gestire flussi di dati in ingresso e in uscita (input/output) servirà il modulo <em>&lsquo;io&rsquo;</em>:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-lua data-lang=lua><span style=display:flex><span>fdati<span style=color:#f92672>=</span>io.open(<span style=color:#e6db74>&#39;dati.txt&#39;</span>,<span style=color:#e6db74>&#39;w&#39;</span>)
</span></span><span style=display:flex><span><span style=color:#66d9ef>for</span> i<span style=color:#f92672>=</span><span style=color:#ae81ff>1</span>,<span style=color:#ae81ff>10</span> <span style=color:#66d9ef>do</span>
</span></span><span style=display:flex><span>  fdati:write(<span style=color:#e6db74>&#34;riga&#34;</span>,i,<span style=color:#e6db74>&#34;</span><span style=color:#ae81ff>\n</span><span style=color:#e6db74>&#34;</span>)
</span></span><span style=display:flex><span><span style=color:#66d9ef>end</span>
</span></span><span style=display:flex><span>fdati:close()
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>for</span> riga <span style=color:#66d9ef>in</span> io.lines(<span style=color:#e6db74>&#34;dati.txt&#34;</span>) <span style=color:#66d9ef>do</span>
</span></span><span style=display:flex><span>  print(<span style=color:#e6db74>&#34;lettura&#34;</span>,riga)
</span></span><span style=display:flex><span><span style=color:#66d9ef>end</span></span></span></code></pre></div><p>Per la manipolazione di stringhe useremo il prefisso <em>string</em>:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-lua data-lang=lua><span style=display:flex><span><span style=color:#960050;background-color:#1e0010>$</span>lua
</span></span><span style=display:flex><span><span style=color:#f92672>&gt;</span>a<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;gnu/linux&#34;</span>
</span></span><span style=display:flex><span><span style=color:#f92672>&gt;</span>print(string.upper(a))
</span></span><span style=display:flex><span>GNU<span style=color:#f92672>/</span>LINUX
</span></span><span style=display:flex><span><span style=color:#f92672>&gt;</span>b<span style=color:#f92672>=</span>string.rep(<span style=color:#e6db74>&#34;x&#34;</span>,<span style=color:#ae81ff>2</span><span style=color:#f92672>^</span><span style=color:#ae81ff>20</span>)  <span style=color:#75715e>-- stringa da 1 Megabyte</span>
</span></span><span style=display:flex><span><span style=color:#f92672>&gt;</span>print(string.len(a<span style=color:#f92672>..</span>b))
</span></span><span style=display:flex><span><span style=color:#ae81ff>1048585</span>
</span></span><span style=display:flex><span><span style=color:#f92672>&gt;</span>print(string.sub(a,<span style=color:#ae81ff>1</span>,<span style=color:#ae81ff>3</span>)) <span style=color:#75715e>-- primi tre caratteri</span>
</span></span><span style=display:flex><span>gnu
</span></span><span style=display:flex><span><span style=color:#f92672>&gt;</span>print(string.sub(a,<span style=color:#f92672>-</span><span style=color:#ae81ff>5</span>,<span style=color:#f92672>-</span><span style=color:#ae81ff>1</span>) <span style=color:#75715e>-- ultimi cinque caratteri</span>
</span></span><span style=display:flex><span>linux</span></span></code></pre></div><p>lo stesso modulo contiene anche funzioni di formattazione, con una sintassi analoga alla printf(3) del C:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-lua data-lang=lua><span style=display:flex><span><span style=color:#f92672>&gt;</span>tag,titolo,numero<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;h1&#34;</span>,<span style=color:#e6db74>&#34;titolo&#34;</span>,<span style=color:#ae81ff>2</span>
</span></span><span style=display:flex><span><span style=color:#f92672>&gt;</span>s<span style=color:#f92672>=</span>string.format(<span style=color:#e6db74>&#34;&lt;%s&gt;%s %d&lt;/%s&gt;&#34;</span>,tag,titolo,numero,tag)
</span></span><span style=display:flex><span><span style=color:#f92672>&gt;</span>print(s)
</span></span><span style=display:flex><span><span style=color:#f92672>&lt;</span>h1<span style=color:#f92672>&gt;</span>titolo <span style=color:#ae81ff>2</span><span style=color:#f92672>&lt;/</span>h1<span style=color:#f92672>&gt;</span></span></span></code></pre></div><p><em>string</em> fornisce una implementazione ridotta, ma efficace, <strong>delle regular expression</strong>.
Nell&rsquo;interprete interattivo e nei nostri script le librerie built-in come math, io, os, string sono già disponibili senza dover specificare nient&rsquo;altro; come vedremo più avanti, questo non vale più quando useremo Lua come libreria &rsquo;embedded&rsquo; nei programmi C, perché potremo scegliere di volta in volta le funzionalità da includere o meno, con il beneficio di snellire i nostri programmi togliendo le funzionalità che non usiamo.</p></div><footer class=post-footer><ul class=post-tags><li><a href=https://ilmanzo.github.io/tags/lua/>lua</a></li><li><a href=https://ilmanzo.github.io/tags/programming/>programming</a></li><li><a href=https://ilmanzo.github.io/tags/tutorial/>tutorial</a></li><li><a href=https://ilmanzo.github.io/tags/linux/>linux</a></li><li><a href=https://ilmanzo.github.io/tags/italian/>italian</a></li></ul><nav class=paginav><a class=prev href=https://ilmanzo.github.io/post/a-honeypot-ssh-server-in-go/><span class=title>« Prev</span><br><span>a honeypot ssh server in Go</span>
</a><a class=next href=https://ilmanzo.github.io/post/il-linguaggio-lua-08/><span class=title>Next »</span><br><span>il linguaggio Lua: ottava parte</span></a></nav></footer></article></main><footer class=footer><span>© 2012-2024 Andrea Manzini</span>
<span>Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
        <a href=https://github.com/adityatelange/hugo-PaperMod/ rel=noopener target=_blank>PaperMod</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg>
</a><script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))})</script><script>document.querySelectorAll("pre > code").forEach(e=>{const n=e.parentNode.parentNode,t=document.createElement("button");t.classList.add("copy-code"),t.innerHTML="copy";function s(){t.innerHTML="copied!",setTimeout(()=>{t.innerHTML="copy"},2e3)}t.addEventListener("click",t=>{if("clipboard"in navigator){navigator.clipboard.writeText(e.textContent),s();return}const n=document.createRange();n.selectNodeContents(e);const o=window.getSelection();o.removeAllRanges(),o.addRange(n);try{document.execCommand("copy"),s()}catch{}o.removeRange(n)}),n.classList.contains("highlight")?n.appendChild(t):n.parentNode.firstChild==n||(e.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName=="TABLE"?e.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(t):e.parentNode.appendChild(t))})</script></body></html>