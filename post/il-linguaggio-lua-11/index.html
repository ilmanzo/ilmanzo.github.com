<!doctype html><html lang=en><head><title>il linguaggio Lua: parte 11 &ndash; ilManzo's blog</title><meta name=description content="A minimalist, pragmatic website and personal blog"><meta name=viewport content="width=device-width,initial-scale=1"><meta charset=utf-8><link rel=stylesheet href=https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.1.2/css/all.min.css integrity="sha512-1sCRPdkRXhBV2PBLUdRb4tMg1w2YPf37qatUFeS7zlBy7jJI8Lf4VHwWfZZfpXtYSLy85pkm9GaYVYMfw5BC1A==" crossorigin=anonymous><link rel=stylesheet href=https://cdnjs.cloudflare.com/ajax/libs/academicons/1.9.1/css/academicons.min.css integrity="sha512-b1ASx0WHgVFL5ZQhTgiPWX+68KjS38Jk87jg7pe+qC7q9YkEtFq0z7xCglv7qGIs/68d3mAp+StfC8WKC5SSAg==" crossorigin=anonymous><link rel=stylesheet href=https://ilmanzo.github.io/css/palettes/base16-dark.css><link rel=stylesheet href=https://ilmanzo.github.io/css/risotto.css><link rel=stylesheet href=https://ilmanzo.github.io/css/custom.css></head><body><div class=page><header class=page__header><h1 class=page__logo><a href=https://ilmanzo.github.io/ class=page__logo-inner>ilManzo's blog</a></h1><nav class="page__nav main-nav"><ul><li class=main-nav__item><a class=nav-main-item href=https://ilmanzo.github.io/curriculum title>Curriculum</a></li><li class=main-nav__item><a class=nav-main-item href=https://ilmanzo.github.io/categories title>Categories</a></li><li class=main-nav__item><a class=nav-main-item href=https://ilmanzo.github.io/tags title>Tags</a></li><li class=main-nav__item><a class="nav-main-item active" href=https://ilmanzo.github.io/post/ title=Posts>Posts</a></li></ul></nav></header><section class=page__body><header class=content__header><h1>il linguaggio Lua: parte 11</h1></header><div class=content__body><p>segue dalla <a href=https://ilmanzo.github.io/post/il-linguaggio-lua-10/>parte 10</a></p><h1 id=rocce-di-luna>Rocce di Luna</h1><p>Poter organizzare il codice in più file è molto utile per modularizzare i programmi, creando package che verranno caricati tramite l&rsquo;istruzione require “nomefile”. Vediamo un esempio:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-lua data-lang=lua><span style=display:flex><span><span style=color:#75715e>-- geompkg.lua</span>
</span></span><span style=display:flex><span>module(<span style=color:#e6db74>&#34;geom&#34;</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>local</span> <span style=color:#66d9ef>function</span> <span style=color:#a6e22e>quadrato</span>(x)
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>return</span> x<span style=color:#f92672>*</span>x
</span></span><span style=display:flex><span><span style=color:#66d9ef>end</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>local</span> <span style=color:#66d9ef>function</span> <span style=color:#a6e22e>rettangolo</span>(b,h)
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>return</span> b<span style=color:#f92672>*</span>h
</span></span><span style=display:flex><span><span style=color:#66d9ef>end</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>function</span> <span style=color:#a6e22e>area</span>(param)
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>if</span> param.lato <span style=color:#66d9ef>then</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> quadrato(param.lato)
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>end</span>
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>local</span> area<span style=color:#f92672>=</span>rettangolo(param.base,param.altezza)
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>if</span> param.triangolo <span style=color:#f92672>or</span> param.trapezio <span style=color:#66d9ef>then</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> area<span style=color:#f92672>/</span><span style=color:#ae81ff>2</span>
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>end</span>
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>return</span> area
</span></span><span style=display:flex><span><span style=color:#66d9ef>end</span></span></span></code></pre></div><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-lua data-lang=lua><span style=display:flex><span><span style=color:#75715e>-- usepkg.lua</span>
</span></span><span style=display:flex><span>require(<span style=color:#e6db74>&#39;geompkg&#39;</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>print(geom.area{base<span style=color:#f92672>=</span><span style=color:#ae81ff>3</span>,altezza<span style=color:#f92672>=</span><span style=color:#ae81ff>5</span>})
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>print(geom.area{lato<span style=color:#f92672>=</span><span style=color:#ae81ff>3</span>})
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>--errore, quadrato è local nel modulo </span>
</span></span><span style=display:flex><span><span style=color:#75715e>--quindi non accessibile esternamente</span>
</span></span><span style=display:flex><span>print(geom.quadrato(<span style=color:#ae81ff>5</span>))</span></span></code></pre></div><p>nell&rsquo;esempio vogliamo separare le funzioni di calcolo geometrico dal programma principale, così le raggruppiamo in un file <em>geompkg.lua</em>; notiamo che nello stesso file abbiamo definito anche delle funzioni locali che non saranno visibili all&rsquo;esterno, come evidenziato dall&rsquo;ultima riga di <em>usepkg.lua</em>.
più avanti impareremo come un modulo possa anche essere binario, cioè compilato come codice nativo. Verificheremo perciò come sia agevole usare da Lua le sterminate librerie disponibili in C.</p><p>Attorno a questo primitivo meccanismo di modularizzazione la comunità opensource ha sviluppato una completa infrastruttura di versioning, deploy e gestione dei pacchetti che somiglia a quelli già disponibili in altri linguaggi come Python, Ruby, Perl, e che prende il nome di <strong>luarocks</strong> <a href=http://luarocks.org/>http://luarocks.org/</a>. Grazie a questo progetto è semplicissimo installare e utilizzare numerosi moduli aggiuntivi per le più disparate esigenze, vediamo ora come sfruttarlo.</p><p>Anzitutto occorre installare luarocks, seguendo le istruzioni per compilare i sorgenti presenti sul sito o scaricando il pacchetto della nostra distribuzione preferita oppure. Su Debian/Ubuntu basta un:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>$ sudo apt-get install luarocks</span></span></code></pre></div><p>terminata l&rsquo;installazione, controlliamo il percorso del repository:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>$ grep -3 servers /etc/luarocks/config.lua 
</span></span><span style=display:flex><span>rocks_servers <span style=color:#f92672>=</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>   <span style=color:#f92672>[[</span>http://luarocks.org/repositories/rocks<span style=color:#f92672>]]</span>
</span></span><span style=display:flex><span><span style=color:#f92672>}</span></span></span></code></pre></div><p>dopo esserci assicurati che l&rsquo; URL indicato sia raggiungibile, possiamo provare qualche ricerca:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>$ luarocks search twitter
</span></span><span style=display:flex><span>$ luarocks search sql</span></span></code></pre></div><p>la maggior parte di questi progetti sono ospitati su <a href=http://luaforge.net>http://luaforge.net</a>, l&rsquo;equivalente del più noto Sourceforge.
A titolo di esempio e tanto per rimanere nell&rsquo;ambito “lightweight”, installiamo e proviamo il modulo per interfacciarsi a sqlite:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>$ sudo luarocks install luasql-sqlite3</span></span></code></pre></div><p>se non avessimo già installato la libreria di sviluppo, eventualmente occorre un:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>$ sudo apt-get install libsqlite3-dev.</span></span></code></pre></div><p>Ci prepariamo un database e una tabella di prova:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>$ sqlite3 dati.db
</span></span><span style=display:flex><span>SQLite version 3.22.0 2018-01-22 18:45:57
</span></span><span style=display:flex><span>Enter <span style=color:#e6db74>&#34;.help&#34;</span> <span style=color:#66d9ef>for</span> usage hints.
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>sqlite&gt; create table rubrica<span style=color:#f92672>(</span>nome varchar<span style=color:#f92672>(</span>35<span style=color:#f92672>)</span>, telefono varchar<span style=color:#f92672>(</span>15<span style=color:#f92672>))</span>;
</span></span><span style=display:flex><span>sqlite&gt; insert into rubrica values<span style=color:#f92672>(</span><span style=color:#e6db74>&#39;Linus Torvalds&#39;</span>,<span style=color:#e6db74>&#39;0123456732&#39;</span><span style=color:#f92672>)</span>;
</span></span><span style=display:flex><span>sqlite&gt; insert into rubrica values<span style=color:#f92672>(</span><span style=color:#e6db74>&#39;Richard Stallman&#39;</span>,<span style=color:#e6db74>&#39;932874936&#39;</span><span style=color:#f92672>)</span>;
</span></span><span style=display:flex><span>sqlite&gt;.quit</span></span></code></pre></div><p>e lo interroghiamo da Lua:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>$ lua
</span></span><span style=display:flex><span>Lua 5.2.4  Copyright <span style=color:#f92672>(</span>C<span style=color:#f92672>)</span> 1994-2015 Lua.org, PUC-Rio
</span></span><span style=display:flex><span>&gt; require <span style=color:#e6db74>&#34;luasql.sqlite3&#34;</span>
</span></span><span style=display:flex><span>&gt; db<span style=color:#f92672>=</span>luasql.sqlite3<span style=color:#f92672>()</span>
</span></span><span style=display:flex><span>&gt; conn<span style=color:#f92672>=</span>db:connect<span style=color:#f92672>(</span><span style=color:#e6db74>&#34;dati.db&#34;</span><span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>&gt; print<span style=color:#f92672>(</span>conn<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>SQLite3 connection <span style=color:#f92672>(</span>0x99e05bc<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>&gt; curs<span style=color:#f92672>=</span>conn:execute<span style=color:#f92672>(</span><span style=color:#e6db74>&#34;SELECT * FROM rubrica&#34;</span><span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>&gt; print<span style=color:#f92672>(</span>curs:fetch<span style=color:#f92672>())</span>
</span></span><span style=display:flex><span>Linus Torvalds	<span style=color:#ae81ff>0123456732</span>
</span></span><span style=display:flex><span>&gt; print<span style=color:#f92672>(</span>curs:fetch<span style=color:#f92672>())</span>
</span></span><span style=display:flex><span>Richard Stallman	<span style=color:#ae81ff>932874936</span></span></span></code></pre></div></div><footer class=content__footer></footer></section><section class=page__aside><div class=aside__about><div class=aside__about><img class=about__logo src=https://ilmanzo.github.io/images/rice.svg alt=Logo><h1 class=about__title>Andrea Manzini</h1><p class=about__description>A minimalist, pragmatic website and personal blog</p></div><ul class=aside__social-links><li><a href=https://github.com/ilmanzo rel=me aria-label=GitHub title=GitHub><i class="fab fa-github" aria-hidden=true></i></a>&nbsp;</li><li><a href=mailto:ilmanzo@gmail.com rel=me aria-label=Email title=Email><i class="fas fa-envelope" aria-hidden=true></i></a>&nbsp;</li><li><a href=https://www.linkedin.com/in/andreamanzini rel=me aria-label=Linkedin title=Linkedin><i class="fab fa-linkedin" aria-hidden=true></i></a>&nbsp;</li><li><a href=https://twitter.com/ilmanzo rel=me aria-label=Twitter title=Twitter><i class="fab fa-twitter" aria-hidden=true></i></a>&nbsp;</li><li><a href=https://ilmanzo.github.io/index.xml rel=me aria-label="RSS Feed" title="RSS Feed"><i class="fas fa-rss-square" aria-hidden=true></i></a>&nbsp;</li></ul></div><hr><div class=aside__content><p>introduzione al linguaggio Lua</p><p>By Andrea Manzini,
2018-09-07</p></div></section><footer class=page__footer><p></p><br><br><p class=copyright>© 2022 Andrea Manzini</p><p class=advertisement>Powered by <a href=https://gohugo.io/>hugo</a> and <a href=https://github.com/joeroe/risotto>risotto</a>.</p></footer></div></body></html>