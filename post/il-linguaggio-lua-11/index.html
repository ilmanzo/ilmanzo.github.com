<!doctype html><html lang=en dir=auto><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>il linguaggio Lua: parte 11 | ilManzo's blog</title><meta name=keywords content="lua,programming,tutorial,linux,italian"><meta name=description content="introduzione al linguaggio Lua"><meta name=author content="Andrea Manzini"><link rel=canonical href=https://ilmanzo.github.io/post/il-linguaggio-lua-11/><link crossorigin=anonymous href=/assets/css/stylesheet.5cfc680b1eeaeef9efbced92d46c2a9e876b72ee14fba85846afc4cff9e6e6f8.css integrity="sha256-XPxoCx7q7vnvvO2S1Gwqnodrcu4U+6hYRq/Ez/nm5vg=" rel="preload stylesheet" as=style><script defer crossorigin=anonymous src=/assets/js/highlight.f413e19d0714851f6474e7ee9632408e58ac146fbdbe62747134bea2fa3415e0.js integrity="sha256-9BPhnQcUhR9kdOfuljJAjlisFG+9vmJ0cTS+ovo0FeA=" onload=hljs.initHighlightingOnLoad()></script>
<link rel=icon href=https://ilmanzo.github.io/favicon.ico><link rel=icon type=image/png sizes=16x16 href=https://ilmanzo.github.io/favicon-16x16.png><link rel=icon type=image/png sizes=32x32 href=https://ilmanzo.github.io/favicon-32x32.png><link rel=apple-touch-icon href=https://ilmanzo.github.io/apple-touch-icon.png><link rel=mask-icon href=https://ilmanzo.github.io/safari-pinned-tab.svg><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><noscript><style>#theme-toggle,.top-link{display:none}</style></noscript><script async src="https://www.googletagmanager.com/gtag/js?id=G-6PN4FTRLNL"></script>
<script>var doNotTrack=!1;if(!doNotTrack){window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-6PN4FTRLNL",{anonymize_ip:!1})}</script><meta property="og:title" content="il linguaggio Lua: parte 11"><meta property="og:description" content="introduzione al linguaggio Lua"><meta property="og:type" content="article"><meta property="og:url" content="https://ilmanzo.github.io/post/il-linguaggio-lua-11/"><meta property="article:section" content="post"><meta property="article:published_time" content="2018-09-07T00:00:00+00:00"><meta property="article:modified_time" content="2018-09-07T00:00:00+00:00"><meta name=twitter:card content="summary"><meta name=twitter:title content="il linguaggio Lua: parte 11"><meta name=twitter:description content="introduzione al linguaggio Lua"><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Posts","item":"https://ilmanzo.github.io/post/"},{"@type":"ListItem","position":2,"name":"il linguaggio Lua: parte 11","item":"https://ilmanzo.github.io/post/il-linguaggio-lua-11/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"il linguaggio Lua: parte 11","name":"il linguaggio Lua: parte 11","description":"introduzione al linguaggio Lua","keywords":["lua","programming","tutorial","linux","italian"],"articleBody":"segue dalla parte 10\nRocce di Luna Poter organizzare il codice in più file è molto utile per modularizzare i programmi, creando package che verranno caricati tramite l’istruzione require “nomefile”. Vediamo un esempio:\n-- geompkg.lua module(\"geom\") local function quadrato(x) return x*x end local function rettangolo(b,h) return b*h end function area(param) if param.lato then return quadrato(param.lato) end local area=rettangolo(param.base,param.altezza) if param.triangolo or param.trapezio then return area/2 end return area end -- usepkg.lua require('geompkg') print(geom.area{base=3,altezza=5}) print(geom.area{lato=3}) --errore, quadrato è local nel modulo --quindi non accessibile esternamente print(geom.quadrato(5)) nell’esempio vogliamo separare le funzioni di calcolo geometrico dal programma principale, così le raggruppiamo in un file geompkg.lua; notiamo che nello stesso file abbiamo definito anche delle funzioni locali che non saranno visibili all’esterno, come evidenziato dall’ultima riga di usepkg.lua. più avanti impareremo come un modulo possa anche essere binario, cioè compilato come codice nativo. Verificheremo perciò come sia agevole usare da Lua le sterminate librerie disponibili in C.\nAttorno a questo primitivo meccanismo di modularizzazione la comunità opensource ha sviluppato una completa infrastruttura di versioning, deploy e gestione dei pacchetti che somiglia a quelli già disponibili in altri linguaggi come Python, Ruby, Perl, e che prende il nome di luarocks http://luarocks.org/. Grazie a questo progetto è semplicissimo installare e utilizzare numerosi moduli aggiuntivi per le più disparate esigenze, vediamo ora come sfruttarlo.\nAnzitutto occorre installare luarocks, seguendo le istruzioni per compilare i sorgenti presenti sul sito o scaricando il pacchetto della nostra distribuzione preferita oppure. Su Debian/Ubuntu basta un:\n$ sudo apt-get install luarocks terminata l’installazione, controlliamo il percorso del repository:\n$ grep -3 servers /etc/luarocks/config.lua rocks_servers = { [[http://luarocks.org/repositories/rocks]] } dopo esserci assicurati che l’ URL indicato sia raggiungibile, possiamo provare qualche ricerca:\n$ luarocks search twitter $ luarocks search sql la maggior parte di questi progetti sono ospitati su http://luaforge.net, l’equivalente del più noto Sourceforge. A titolo di esempio e tanto per rimanere nell’ambito “lightweight”, installiamo e proviamo il modulo per interfacciarsi a sqlite:\n$ sudo luarocks install luasql-sqlite3 se non avessimo già installato la libreria di sviluppo, eventualmente occorre un:\n$ sudo apt-get install libsqlite3-dev. Ci prepariamo un database e una tabella di prova:\n$ sqlite3 dati.db SQLite version 3.22.0 2018-01-22 18:45:57 Enter \".help\" for usage hints. sqlite\u003e create table rubrica(nome varchar(35), telefono varchar(15)); sqlite\u003e insert into rubrica values('Linus Torvalds','0123456732'); sqlite\u003e insert into rubrica values('Richard Stallman','932874936'); sqlite\u003e.quit e lo interroghiamo da Lua:\n$ lua Lua 5.2.4 Copyright (C) 1994-2015 Lua.org, PUC-Rio \u003e require \"luasql.sqlite3\" \u003e db=luasql.sqlite3() \u003e conn=db:connect(\"dati.db\") \u003e print(conn) SQLite3 connection (0x99e05bc) \u003e curs=conn:execute(\"SELECT * FROM rubrica\") \u003e print(curs:fetch()) Linus Torvalds\t0123456732 \u003e print(curs:fetch()) Richard Stallman\t932874936 ","wordCount":"427","inLanguage":"en","datePublished":"2018-09-07T00:00:00Z","dateModified":"2018-09-07T00:00:00Z","author":{"@type":"Person","name":"Andrea Manzini"},"mainEntityOfPage":{"@type":"WebPage","@id":"https://ilmanzo.github.io/post/il-linguaggio-lua-11/"},"publisher":{"@type":"Organization","name":"ilManzo's blog","logo":{"@type":"ImageObject","url":"https://ilmanzo.github.io/favicon.ico"}}}</script></head><body class=dark id=top><script>localStorage.getItem("pref-theme")==="light"&&document.body.classList.remove("dark")</script><header class=header><nav class=nav><div class=logo><a href=https://ilmanzo.github.io/ accesskey=h title="ilManzo's blog (Alt + H)">ilManzo's blog</a><div class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)"><svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></div></div><ul id=menu><li><a href=https://ilmanzo.github.io/curriculum title=Curriculum><span>Curriculum</span></a></li><li><a href=https://ilmanzo.github.io/categories title=Categories><span>Categories</span></a></li><li><a href=https://ilmanzo.github.io/tags title=Tags><span>Tags</span></a></li><li><a href=https://ilmanzo.github.io/post/ title=Posts><span>Posts</span></a></li></ul></nav></header><main class=main><article class=post-single><header class=post-header><h1 class=post-title>il linguaggio Lua: parte 11</h1><div class=post-description>introduzione al linguaggio Lua</div><div class=post-meta><span title='2018-09-07 00:00:00 +0000 UTC'>September 7, 2018</span>&nbsp;·&nbsp;Andrea Manzini</div></header><div class=post-content><p>segue dalla <a href=https://ilmanzo.github.io/post/il-linguaggio-lua-10/>parte 10</a></p><h1 id=rocce-di-luna>Rocce di Luna<a hidden class=anchor aria-hidden=true href=#rocce-di-luna>#</a></h1><p>Poter organizzare il codice in più file è molto utile per modularizzare i programmi, creando package che verranno caricati tramite l&rsquo;istruzione require “nomefile”. Vediamo un esempio:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-lua data-lang=lua><span style=display:flex><span><span style=color:#75715e>-- geompkg.lua</span>
</span></span><span style=display:flex><span>module(<span style=color:#e6db74>&#34;geom&#34;</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>local</span> <span style=color:#66d9ef>function</span> <span style=color:#a6e22e>quadrato</span>(x)
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>return</span> x<span style=color:#f92672>*</span>x
</span></span><span style=display:flex><span><span style=color:#66d9ef>end</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>local</span> <span style=color:#66d9ef>function</span> <span style=color:#a6e22e>rettangolo</span>(b,h)
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>return</span> b<span style=color:#f92672>*</span>h
</span></span><span style=display:flex><span><span style=color:#66d9ef>end</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>function</span> <span style=color:#a6e22e>area</span>(param)
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>if</span> param.lato <span style=color:#66d9ef>then</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> quadrato(param.lato)
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>end</span>
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>local</span> area<span style=color:#f92672>=</span>rettangolo(param.base,param.altezza)
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>if</span> param.triangolo <span style=color:#f92672>or</span> param.trapezio <span style=color:#66d9ef>then</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> area<span style=color:#f92672>/</span><span style=color:#ae81ff>2</span>
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>end</span>
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>return</span> area
</span></span><span style=display:flex><span><span style=color:#66d9ef>end</span></span></span></code></pre></div><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-lua data-lang=lua><span style=display:flex><span><span style=color:#75715e>-- usepkg.lua</span>
</span></span><span style=display:flex><span>require(<span style=color:#e6db74>&#39;geompkg&#39;</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>print(geom.area{base<span style=color:#f92672>=</span><span style=color:#ae81ff>3</span>,altezza<span style=color:#f92672>=</span><span style=color:#ae81ff>5</span>})
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>print(geom.area{lato<span style=color:#f92672>=</span><span style=color:#ae81ff>3</span>})
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>--errore, quadrato è local nel modulo </span>
</span></span><span style=display:flex><span><span style=color:#75715e>--quindi non accessibile esternamente</span>
</span></span><span style=display:flex><span>print(geom.quadrato(<span style=color:#ae81ff>5</span>))</span></span></code></pre></div><p>nell&rsquo;esempio vogliamo separare le funzioni di calcolo geometrico dal programma principale, così le raggruppiamo in un file <em>geompkg.lua</em>; notiamo che nello stesso file abbiamo definito anche delle funzioni locali che non saranno visibili all&rsquo;esterno, come evidenziato dall&rsquo;ultima riga di <em>usepkg.lua</em>.
più avanti impareremo come un modulo possa anche essere binario, cioè compilato come codice nativo. Verificheremo perciò come sia agevole usare da Lua le sterminate librerie disponibili in C.</p><p>Attorno a questo primitivo meccanismo di modularizzazione la comunità opensource ha sviluppato una completa infrastruttura di versioning, deploy e gestione dei pacchetti che somiglia a quelli già disponibili in altri linguaggi come Python, Ruby, Perl, e che prende il nome di <strong>luarocks</strong> <a href=http://luarocks.org/>http://luarocks.org/</a>. Grazie a questo progetto è semplicissimo installare e utilizzare numerosi moduli aggiuntivi per le più disparate esigenze, vediamo ora come sfruttarlo.</p><p>Anzitutto occorre installare luarocks, seguendo le istruzioni per compilare i sorgenti presenti sul sito o scaricando il pacchetto della nostra distribuzione preferita oppure. Su Debian/Ubuntu basta un:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>$ sudo apt-get install luarocks</span></span></code></pre></div><p>terminata l&rsquo;installazione, controlliamo il percorso del repository:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>$ grep -3 servers /etc/luarocks/config.lua 
</span></span><span style=display:flex><span>rocks_servers <span style=color:#f92672>=</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>   <span style=color:#f92672>[[</span>http://luarocks.org/repositories/rocks<span style=color:#f92672>]]</span>
</span></span><span style=display:flex><span><span style=color:#f92672>}</span></span></span></code></pre></div><p>dopo esserci assicurati che l&rsquo; URL indicato sia raggiungibile, possiamo provare qualche ricerca:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>$ luarocks search twitter
</span></span><span style=display:flex><span>$ luarocks search sql</span></span></code></pre></div><p>la maggior parte di questi progetti sono ospitati su <a href=http://luaforge.net>http://luaforge.net</a>, l&rsquo;equivalente del più noto Sourceforge.
A titolo di esempio e tanto per rimanere nell&rsquo;ambito “lightweight”, installiamo e proviamo il modulo per interfacciarsi a sqlite:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>$ sudo luarocks install luasql-sqlite3</span></span></code></pre></div><p>se non avessimo già installato la libreria di sviluppo, eventualmente occorre un:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>$ sudo apt-get install libsqlite3-dev.</span></span></code></pre></div><p>Ci prepariamo un database e una tabella di prova:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>$ sqlite3 dati.db
</span></span><span style=display:flex><span>SQLite version 3.22.0 2018-01-22 18:45:57
</span></span><span style=display:flex><span>Enter <span style=color:#e6db74>&#34;.help&#34;</span> <span style=color:#66d9ef>for</span> usage hints.
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>sqlite&gt; create table rubrica<span style=color:#f92672>(</span>nome varchar<span style=color:#f92672>(</span>35<span style=color:#f92672>)</span>, telefono varchar<span style=color:#f92672>(</span>15<span style=color:#f92672>))</span>;
</span></span><span style=display:flex><span>sqlite&gt; insert into rubrica values<span style=color:#f92672>(</span><span style=color:#e6db74>&#39;Linus Torvalds&#39;</span>,<span style=color:#e6db74>&#39;0123456732&#39;</span><span style=color:#f92672>)</span>;
</span></span><span style=display:flex><span>sqlite&gt; insert into rubrica values<span style=color:#f92672>(</span><span style=color:#e6db74>&#39;Richard Stallman&#39;</span>,<span style=color:#e6db74>&#39;932874936&#39;</span><span style=color:#f92672>)</span>;
</span></span><span style=display:flex><span>sqlite&gt;.quit</span></span></code></pre></div><p>e lo interroghiamo da Lua:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>$ lua
</span></span><span style=display:flex><span>Lua 5.2.4  Copyright <span style=color:#f92672>(</span>C<span style=color:#f92672>)</span> 1994-2015 Lua.org, PUC-Rio
</span></span><span style=display:flex><span>&gt; require <span style=color:#e6db74>&#34;luasql.sqlite3&#34;</span>
</span></span><span style=display:flex><span>&gt; db<span style=color:#f92672>=</span>luasql.sqlite3<span style=color:#f92672>()</span>
</span></span><span style=display:flex><span>&gt; conn<span style=color:#f92672>=</span>db:connect<span style=color:#f92672>(</span><span style=color:#e6db74>&#34;dati.db&#34;</span><span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>&gt; print<span style=color:#f92672>(</span>conn<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>SQLite3 connection <span style=color:#f92672>(</span>0x99e05bc<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>&gt; curs<span style=color:#f92672>=</span>conn:execute<span style=color:#f92672>(</span><span style=color:#e6db74>&#34;SELECT * FROM rubrica&#34;</span><span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>&gt; print<span style=color:#f92672>(</span>curs:fetch<span style=color:#f92672>())</span>
</span></span><span style=display:flex><span>Linus Torvalds	<span style=color:#ae81ff>0123456732</span>
</span></span><span style=display:flex><span>&gt; print<span style=color:#f92672>(</span>curs:fetch<span style=color:#f92672>())</span>
</span></span><span style=display:flex><span>Richard Stallman	<span style=color:#ae81ff>932874936</span></span></span></code></pre></div></div><footer class=post-footer><ul class=post-tags><li><a href=https://ilmanzo.github.io/tags/lua/>lua</a></li><li><a href=https://ilmanzo.github.io/tags/programming/>programming</a></li><li><a href=https://ilmanzo.github.io/tags/tutorial/>tutorial</a></li><li><a href=https://ilmanzo.github.io/tags/linux/>linux</a></li><li><a href=https://ilmanzo.github.io/tags/italian/>italian</a></li></ul></footer></article></main><footer class=footer><span>© 2012-2023 Andrea Manzini</span>
<span>Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
        <a href=https://github.com/adityatelange/hugo-PaperMod/ rel=noopener target=_blank>PaperMod</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg></a><script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))})</script></body></html>