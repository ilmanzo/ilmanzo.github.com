<!doctype html><html lang=en><head><title>monitor apache performance statistics &ndash; ilManzo's blog</title><meta name=description content="A minimalist and pragmatic website and personal blog"><meta name=viewport content="width=device-width,initial-scale=1"><meta charset=utf-8><link rel=stylesheet href=https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.2/css/all.min.css integrity="sha512-HK5fgLBL+xu6dm/Ii3z4xhlSUyZgTT9tuc/hSrtw6uzJOvgRr2a9jyxxT1ely+B+xFAmJKVSTbpM/CuL7qxO8w==" crossorigin=anonymous><link rel=stylesheet href=https://cdnjs.cloudflare.com/ajax/libs/academicons/1.9.1/css/academicons.min.css integrity="sha512-b1ASx0WHgVFL5ZQhTgiPWX+68KjS38Jk87jg7pe+qC7q9YkEtFq0z7xCglv7qGIs/68d3mAp+StfC8WKC5SSAg==" crossorigin=anonymous><link rel=stylesheet href=https://ilmanzo.github.io/css/colour/gruvbox-dark.css><link rel=stylesheet href=https://ilmanzo.github.io/css/colour/dark-mode.css><link rel=stylesheet href=https://ilmanzo.github.io/css/risotto.css><link rel=stylesheet href=https://ilmanzo.github.io/css/custom.css></head><body><div class=page><header class=page__header><h1 class=page__logo><a href=https://ilmanzo.github.io/ class=page__logo-inner>ilManzo's blog</a></h1><nav class="page__nav main-nav"><ul><li class=main-nav__item><a class=nav-main-item href=/curriculum title>Curriculum</a></li><li class=main-nav__item><a class=nav-main-item href=/categories title>Categories</a></li><li class=main-nav__item><a class=nav-main-item href=/tags title>Tags</a></li><li class=main-nav__item><a class="nav-main-item active" href=/post/ title=Posts>Posts</a></li></ul></nav></header><section class=page__body><header class=content__header><h1>monitor apache performance statistics</h1></header><div class=content__body><p>the <a href=http://httpd.apache.org/docs/current/mod/mod_status.html>Apache module
mod_status</a> is very
useful for inspecting your running webserver, but it gives you only realtime
informations about workers, connections, and so on. I wanted a way to keep this
data and then be able to do comparison, charts and more useful reports.
The first step was configuring mod_status in order to be only accessible from
localhost:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>andrea@myserver:~$ cat /etc/apache2/mods-enabled/status.conf
</span></span><span style=display:flex><span>&lt;IfModule mod_status.c&gt;
</span></span><span style=display:flex><span><span style=color:#75715e>#</span>
</span></span><span style=display:flex><span><span style=color:#75715e># Allow server status reports generated by mod_status,</span>
</span></span><span style=display:flex><span><span style=color:#75715e># with the URL of http://servername/server-status</span>
</span></span><span style=display:flex><span><span style=color:#75715e># Uncomment and change the &#34;192.0.2.0/24&#34; to allow access from other hosts.</span>
</span></span><span style=display:flex><span><span style=color:#75715e>#</span>
</span></span><span style=display:flex><span>&lt;Location /server-status&gt;
</span></span><span style=display:flex><span>    SetHandler server-status
</span></span><span style=display:flex><span>    Order deny,allow
</span></span><span style=display:flex><span>    Deny from all
</span></span><span style=display:flex><span>    Allow from 127.0.0.1 ::1
</span></span><span style=display:flex><span><span style=color:#75715e>#    Allow from 192.0.2.0/24</span>
</span></span><span style=display:flex><span>&lt;/Location&gt;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># Keep track of extended status information for each request</span>
</span></span><span style=display:flex><span>ExtendedStatus On
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># Determine if mod_status displays the first 63 characters of a request or</span>
</span></span><span style=display:flex><span><span style=color:#75715e># the last 63, assuming the request itself is greater than 63 chars.</span>
</span></span><span style=display:flex><span><span style=color:#75715e># Default: Off</span>
</span></span><span style=display:flex><span><span style=color:#75715e>#SeeRequestTail On</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>&lt;IfModule mod_proxy.c&gt;
</span></span><span style=display:flex><span>    <span style=color:#75715e># Show Proxy LoadBalancer status in mod_status</span>
</span></span><span style=display:flex><span>    ProxyStatus On
</span></span><span style=display:flex><span>&lt;/IfModule&gt;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>&lt;/IfModule&gt;</span></span></code></pre></div><p>now a little shell script to grab the status page together with other useful
informations&mldr;</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>andrea@myserver:~ $ cat apache_status_logger.sh
</span></span><span style=display:flex><span><span style=color:#75715e>#!/bin/sh</span>
</span></span><span style=display:flex><span><span style=color:#f92672>(</span>date +%Y%m%d_%H%M%S <span style=color:#f92672>&amp;&amp;</span> links2 -dump http://127.0.0.1/server-status <span style=color:#f92672>&amp;&amp;</span> top -n1 -b<span style=color:#f92672>)</span> &gt;&gt; /home/andrea/apache_status_<span style=color:#66d9ef>$(</span>date +%Y%m%d<span style=color:#66d9ef>)</span>.log</span></span></code></pre></div><p>scheduled every 5 minutes with a cron entry like this:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#75715e># m h  dom mon dow   command</span>
</span></span><span style=display:flex><span>*/5 * * * * /home/andrea/apache_status_logger.sh</span></span></code></pre></div><p>you will get for each day a separate file with date, time, apache status, and a
list of running processes with their statistics.
Now you can parse the data with any tool you want; i.e. want to know which was
the busiest days?</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>andrea@myserver:~$ grep <span style=color:#e6db74>&#39;requests currently&#39;</span> apache_status_*.log | sort -k2 -nr | head -5
</span></span><span style=display:flex><span>apache_status_20141024.log:   <span style=color:#ae81ff>132</span> requests currently being processed, <span style=color:#ae81ff>0</span> idle workers
</span></span><span style=display:flex><span>apache_status_20141024.log:   <span style=color:#ae81ff>78</span> requests currently being processed, <span style=color:#ae81ff>0</span> idle workers
</span></span><span style=display:flex><span>apache_status_20141103.log:   <span style=color:#ae81ff>48</span> requests currently being processed, <span style=color:#ae81ff>3</span> idle workers
</span></span><span style=display:flex><span>apache_status_20141028.log:   <span style=color:#ae81ff>47</span> requests currently being processed, <span style=color:#ae81ff>2</span> idle workers
</span></span><span style=display:flex><span>apache_status_20141030.log:   <span style=color:#ae81ff>42</span> requests currently being processed, <span style=color:#ae81ff>0</span> idle workers</span></span></code></pre></div></div><footer class=content__footer></footer></section><section class=page__aside><div class=aside__about><div class=aside__about><img class=about__logo src=https://ilmanzo.github.io/images/rice.svg alt=Logo><h1 class=about__title>Andrea Manzini</h1><p class=about__description>A minimalist and pragmatic website and personal blog</p></div><ul class=aside__social-links><li><a href=https://github.com/ilmanzo rel=me aria-label=GitHub title=GitHub><i class="fab fa-github" aria-hidden=true></i></a>&nbsp;</li><li><a href=mailto:ilmanzo@gmail.com rel=me aria-label=Email title=Email><i class="fas fa-envelope" aria-hidden=true></i></a>&nbsp;</li><li><a href=https://www.linkedin.com/in/andreamanzini rel=me aria-label=Linkedin title=Linkedin><i class="fab fa-linkedin" aria-hidden=true></i></a>&nbsp;</li><li><a href=https://twitter.com/ilmanzo rel=me aria-label=Twitter title=Twitter><i class="fab fa-twitter" aria-hidden=true></i></a>&nbsp;</li></ul></div><hr><div class=aside__content><p>how to use apache mod_status to collect performance statistics</p><p>By Andrea Manzini,
2014-11-05</p></div></section><footer class=page__footer><p class=copyright>Â© 2022 Andrea Manzini</p><p class=advertisement>Powered by <a href=https://gohugo.io/>hugo</a> and <a href=https://github.com/joeroe/risotto>risotto</a>.</p></footer></div></body></html>