<!doctype html><html lang=en dir=auto><head><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>From QEMU Headache to Headless | ilManzo's blog</title><meta name=keywords content="testing,tutorial,linux,dlang,virtualization,emulation,scripting"><meta name=description content="Taming a Command-Line Monster with D"><meta name=author content="Andrea Manzini"><link rel=canonical href=https://ilmanzo.github.io/post/qemu-dlang-helper/><link crossorigin=anonymous href=/assets/css/stylesheet.2211ca3164be7830024f6aad2b3a2e520843a64f8f048445c3401c1249aa051d.css integrity="sha256-IhHKMWS+eDACT2qtKzouUghDpk+PBIRFw0AcEkmqBR0=" rel="preload stylesheet" as=style><link rel=icon href=https://ilmanzo.github.io/favicon.ico><link rel=icon type=image/png sizes=16x16 href=https://ilmanzo.github.io/favicon-16x16.png><link rel=icon type=image/png sizes=32x32 href=https://ilmanzo.github.io/favicon-32x32.png><link rel=apple-touch-icon href=https://ilmanzo.github.io/apple-touch-icon.png><link rel=mask-icon href=https://ilmanzo.github.io/safari-pinned-tab.svg><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><link rel=alternate hreflang=en href=https://ilmanzo.github.io/post/qemu-dlang-helper/><noscript><style>#theme-toggle,.top-link{display:none}</style></noscript><script async src="https://www.googletagmanager.com/gtag/js?id=G-6PN4FTRLNL"></script><script>var dnt,doNotTrack=!1;if(!1&&(dnt=navigator.doNotTrack||window.doNotTrack||navigator.msDoNotTrack,doNotTrack=dnt=="1"||dnt=="yes"),!doNotTrack){window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-6PN4FTRLNL")}</script><meta property="og:url" content="https://ilmanzo.github.io/post/qemu-dlang-helper/"><meta property="og:site_name" content="ilManzo's blog"><meta property="og:title" content="From QEMU Headache to Headless"><meta property="og:description" content="Taming a Command-Line Monster with D"><meta property="og:locale" content="en-us"><meta property="og:type" content="article"><meta property="article:section" content="post"><meta property="article:published_time" content="2025-09-11T00:00:00+00:00"><meta property="article:modified_time" content="2025-09-11T00:00:00+00:00"><meta property="article:tag" content="Testing"><meta property="article:tag" content="Tutorial"><meta property="article:tag" content="Linux"><meta property="article:tag" content="Dlang"><meta property="article:tag" content="Virtualization"><meta property="article:tag" content="Emulation"><meta name=twitter:card content="summary"><meta name=twitter:title content="From QEMU Headache to Headless"><meta name=twitter:description content="Taming a Command-Line Monster with D"><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Posts","item":"https://ilmanzo.github.io/post/"},{"@type":"ListItem","position":2,"name":"From QEMU Headache to Headless","item":"https://ilmanzo.github.io/post/qemu-dlang-helper/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"From QEMU Headache to Headless","name":"From QEMU Headache to Headless","description":"Taming a Command-Line Monster with D","keywords":["testing","tutorial","linux","dlang","virtualization","emulation","scripting"],"articleBody":"üò∏ TL;DR Being lazy, I made a tool to run qcow2 images for my convenience. Feel free to use it if you find useful!\nüìñ The back story If you‚Äôve ever typed qemu-system-x86_64 into your terminal, you know the feeling. A creeping dread. A cold sweat. The QEMU headache. It‚Äôs that special migraine reserved for developers who know they‚Äôre about to spend the next ten minutes deciphering their own shell history to remember that one magic flag for networking.\nThis was my daily reality. My job requires testing software on a whole zoo of Linux versions. I live and breathe qcow2 images, spinning them up and tearing them down. But every single launch was a fresh new adventure in forgetting flags. Did I add -cpu host for performance? Did I remember -device usb-tablet so my mouse doesn‚Äôt look like it‚Äôs breakdancing in the corner? ü§Ø\nAfter accidentally saving breaking changes to a pristine base image for the hundredth time because I forgot -snapshot, I had a moment of clarity. A glorious, table-flipping moment. ‚ïØ¬∞‚ñ°¬∞Ôºâ‚ïØÔ∏µ ‚îª‚îÅ‚îª\nMy problem wasn‚Äôt QEMU. It was remembering QEMU options. The solution was simple: build a tool so I could forget.\nü•æ A Cure for the Common Command-Line Cold I needed a wrapper script, a quick boot sidekick. The prescription was clear:\nA Single Pill: One self-contained binary. No side effects, no dependencies, no ‚Äúmake sure you have Python 3.9.x installed.‚Äù\nEasy to Modify: It had to be readable enough that ‚ÄúFuture Me‚Äù wouldn‚Äôt curse ‚ÄúPast Me.‚Äù\nThe Right Tool for the Job: Not too heavy, not too light.\nGo, Rust, Python‚Ä¶ all great languages. But Go‚Äôs error handling felt a bit bureaucratic for this task. Rust felt like bringing a tactical nuke to a knife fight. And Python, while lovely, violated my ‚Äúsingle pill‚Äù rule.\nAnd then, I remembered an old friend: The D Language. üêâ\nD might not be the most popular kid on the block, but for projects like this, it‚Äôs an absolute revelation. It hit every single one of my wishlist items with the elegance of a well-executed magic trick:\nSingle Executable? ‚úÖ D compiles to native code. My qboot helper is just one file, ready to rock on any compatible Linux system. Deployment? Solved.\nLinux Love? ‚úÖ D‚Äôs standard library is robust, and dub (its fantastic package manager) makes cross-distro building a breeze.\nReadability \u0026 Power? ‚úÖ‚úÖ This is where D truly shines. Its syntax is incredibly clean and familiar if you‚Äôve ever touched a C-like language (which, let‚Äôs be honest, most of us have!). But it also packs modern features like powerful metaprogramming, concise array manipulation, and a solid standard library. It‚Äôs like C++ got a spa day and came back refreshed, ready to work. Plus, its default garbage collector means I don‚Äôt have to fuss with manual memory management for this kind of task, keeping my brain cycles focused on QEMU, not pointers.\nüíÜ Headless by Default I started crafting the qboot tool, defining a VirtualMachine struct to hold all the options. This ‚Äúobject-oriented‚Äù approach meant my VM‚Äôs configuration was neatly separated from the complex logic of building QEMU commands. No more spaghetti code!\nMy qboot tool was designed around my two main workflows:\nü§ñ Headless Mode (The Default): This is for my daily testing grind. It runs with -nographic and, most importantly, uses a -snapshot so my base images are untouched. It‚Äôs fast, it‚Äôs clean, and it‚Äôs as disposable as a paper cup. This mode is the reason I can now sleep at night.\nüßë‚Äçüíª Interactive Mode (-i for ‚ÄúI need to see!‚Äù): This is for manual surgery. When I need to actually log in, create a user, or install something, this mode pops up a GUI, enables a non-possessed mouse, and disables snapshots so my changes are saved.\nTo make it even more brainless, qboot auto-creates a config.json file in ~/.config/qboot/ on its first run. I just set my default CPU and RAM in there once, and I‚Äôm done. Forever.\n‚ôªÔ∏è The Glorious Result My workflow has been transformed.\nBefore qboot (The Headache):\n$ qemu-system-x86_64 -m 8G -cpu host \\ -enable-kvm -drive file=... wait, what was the syntax for virtio again? *opens Google* After qboot (Headless Bliss):\n$ ./qboot -d my-disk.qcow2 That‚Äôs it. It just works. If I need to do some setup first:\n$ ./qboot -d my-disk.qcow2 -i My QEMU headache is gone, replaced by the quiet hum of a tool that does exactly what I want.\nSo if you‚Äôre tired of the command-line flag dance, maybe it‚Äôs time to build your own cure. And hey, give D a look while you‚Äôre at it. It might just be the pragmatic dragon you‚Äôve been searching for to tame your own command-line beasts! üê≤‚ú®\nüí≠ Final Thoughts Or: Why D Deserves a Second Look (Especially for CLI Tools!)\nWhile D isn‚Äôt going to replace Python or Go in popularity overnight, it absolutely hits a sweet spot for practical command-line utilities.\nFast Compilation: D‚Äôs reference compiler (DMD) is incredibly fast, making the ‚Äúedit-compile-run‚Äù loop delightful.\nModern Features: It offers powerful language features that make expressive and safe code easy to write, without forcing you into complex paradigms.\nMinimalist \u0026 Performant: You get the single-binary advantage of Go and Rust, with excellent runtime performance, but often with less code.\nSo, the next time you‚Äôre tired of wrestling with command-line options for your dev tools, or need a quick, performant, and easily deployable utility, give D a whirl. You might just find your own magical sidekick. ‚ú® It certainly saved my sanity from QEMU Tetris!\nProject repository can be found at https://github.com/ilmanzo/qboot . Contributions are welcome!\n","wordCount":"935","inLanguage":"en","datePublished":"2025-09-11T00:00:00Z","dateModified":"2025-09-11T00:00:00Z","author":{"@type":"Person","name":"Andrea Manzini"},"mainEntityOfPage":{"@type":"WebPage","@id":"https://ilmanzo.github.io/post/qemu-dlang-helper/"},"publisher":{"@type":"Organization","name":"ilManzo's blog","logo":{"@type":"ImageObject","url":"https://ilmanzo.github.io/favicon.ico"}}}</script></head><body class=dark id=top><script>localStorage.getItem("pref-theme")==="light"&&document.body.classList.remove("dark")</script><header class=header><nav class=nav><div class=logo><a href=https://ilmanzo.github.io/ accesskey=h title="ilManzo's blog (Alt + H)">ilManzo's blog</a><div class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)" aria-label="Toggle theme">
<svg id="moon" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg>
<svg id="sun" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></div></div><ul id=menu><li><a href=https://ilmanzo.github.io/curriculum title=Curriculum><span>Curriculum</span></a></li><li><a href=https://ilmanzo.github.io/tags title=Tags><span>Tags</span></a></li><li><a href=https://ilmanzo.github.io/categories title=Categories><span>Categories</span></a></li><li><a href=https://ilmanzo.github.io/search title="Search (Alt + /)" accesskey=/><span>Search</span></a></li><li><a href=https://ilmanzo.github.io/post/ title=Posts><span>Posts</span></a></li></ul></nav></header><main class=main><article class=post-single><header class=post-header><div class=breadcrumbs><a href=https://ilmanzo.github.io/>Home</a>&nbsp;¬ª&nbsp;<a href=https://ilmanzo.github.io/post/>Posts</a></div><h1 class="post-title entry-hint-parent">From QEMU Headache to Headless</h1><div class=post-description>Taming a Command-Line Monster with D</div><div class=post-meta><span title='2025-09-11 00:00:00 +0000 UTC'>September 11, 2025</span>&nbsp;¬∑&nbsp;Andrea Manzini</div></header><div class=post-content><h2 id=-tldr>üò∏ TL;DR<a hidden class=anchor aria-hidden=true href=#-tldr>#</a></h2><p>Being lazy, I made <a href=https://github.com/ilmanzo/qboot>a tool</a> to run <code>qcow2</code> images for my convenience. Feel free to use it if you find useful!</p><h2 id=-the-back-story>üìñ The back story<a hidden class=anchor aria-hidden=true href=#-the-back-story>#</a></h2><p>If you&rsquo;ve ever typed <code>qemu-system-x86_64</code> into your terminal, you know the feeling. A creeping dread. A cold sweat. The QEMU <em>headache</em>. It‚Äôs that special migraine reserved for developers who know they&rsquo;re about to spend the next ten minutes deciphering their own shell history to remember that one magic flag for networking.</p><p>This was my daily reality. My job requires testing software on a whole zoo of Linux versions. I live and breathe <code>qcow2</code> images, spinning them up and tearing them down. But every single launch was a fresh new adventure in forgetting flags. Did I add <code>-cpu host</code> for performance? Did I remember <code>-device usb-tablet</code> so my mouse doesn&rsquo;t look like it&rsquo;s breakdancing in the corner? ü§Ø</p><p>After accidentally saving breaking changes to a pristine base image for the hundredth time because I forgot -snapshot, I had a moment of clarity. A glorious, table-flipping moment. ‚ïØ¬∞‚ñ°¬∞Ôºâ‚ïØÔ∏µ ‚îª‚îÅ‚îª</p><p>My problem wasn&rsquo;t QEMU. It was <strong>remembering</strong> QEMU options. The solution was simple: build a tool so I could forget.</p><h2 id=-a-cure-for-the-common-command-line-cold>ü•æ A Cure for the Common Command-Line Cold<a hidden class=anchor aria-hidden=true href=#-a-cure-for-the-common-command-line-cold>#</a></h2><p>I needed a wrapper script, a quick boot sidekick. The prescription was clear:</p><ul><li><p>A Single Pill: One self-contained binary. No side effects, no dependencies, no &ldquo;make sure you have Python 3.9.x installed.&rdquo;</p></li><li><p>Easy to Modify: It had to be readable enough that &ldquo;Future Me&rdquo; wouldn&rsquo;t curse &ldquo;Past Me.&rdquo;</p></li><li><p>The Right Tool for the Job: Not too heavy, not too light.</p></li></ul><p>Go, Rust, Python&mldr; all great languages. But Go&rsquo;s error handling felt a bit bureaucratic for this task. Rust felt like bringing a tactical nuke to a knife fight. And Python, while lovely, violated my &ldquo;single pill&rdquo; rule.</p><p>And then, I remembered an old friend: The D Language. üêâ</p><p>D might not be the most popular kid on the block, but for projects like this, it&rsquo;s an absolute revelation. It hit every single one of my wishlist items with the elegance of a well-executed magic trick:</p><ul><li><p>Single Executable? ‚úÖ D compiles to native code. My qboot helper is just one file, ready to rock on any compatible Linux system. Deployment? Solved.</p></li><li><p>Linux Love? ‚úÖ D&rsquo;s standard library is robust, and dub (its fantastic package manager) makes cross-distro building a breeze.</p></li><li><p>Readability & Power? ‚úÖ‚úÖ This is where D truly shines. Its syntax is incredibly clean and familiar if you&rsquo;ve ever touched a C-like language (which, let&rsquo;s be honest, most of us have!). But it also packs modern features like powerful metaprogramming, concise array manipulation, and a solid standard library. It&rsquo;s like C++ got a spa day and came back refreshed, ready to work. Plus, its default garbage collector means I don&rsquo;t have to fuss with manual memory management for this kind of task, keeping my brain cycles focused on QEMU, not pointers.</p></li></ul><h2 id=-headless-by-default>üíÜ Headless by Default<a hidden class=anchor aria-hidden=true href=#-headless-by-default>#</a></h2><p>I started crafting the <a href=https://github.com/ilmanzo/qboot>qboot</a> tool, defining a <code>VirtualMachine</code> struct to hold all the options. This &ldquo;object-oriented&rdquo; approach meant my VM&rsquo;s configuration was neatly separated from the complex logic of building QEMU commands. No more spaghetti code!</p><p>My <code>qboot</code> tool was designed around my two main workflows:</p><p>ü§ñ Headless Mode (The Default): This is for my daily testing grind. It runs with <code>-nographic</code> and, most importantly, uses a <code>-snapshot</code> so my base images are untouched. It&rsquo;s fast, it&rsquo;s clean, and it&rsquo;s as disposable as a paper cup. This mode is the reason I can now sleep at night.</p><p>üßë‚Äçüíª Interactive Mode (<code>-i</code> for &ldquo;I need to see!&rdquo;): This is for manual surgery. When I need to actually log in, create a user, or install something, this mode pops up a GUI, enables a non-possessed mouse, and disables snapshots so my changes are saved.</p><p>To make it even more brainless, <code>qboot</code> auto-creates a <code>config.json</code> file in <code>~/.config/qboot/</code> on its first run. I just set my default CPU and RAM in there once, and I&rsquo;m done. Forever.</p><h2 id=-the-glorious-result>‚ôªÔ∏è The Glorious Result<a hidden class=anchor aria-hidden=true href=#-the-glorious-result>#</a></h2><p>My workflow has been transformed.</p><p>Before <code>qboot</code> (The Headache):</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>$ qemu-system-x86_64 -m 8G -cpu host <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>   -enable-kvm -drive file<span style=color:#f92672>=</span>... wait, what was the syntax <span style=color:#66d9ef>for</span> virtio again? *opens Google*
</span></span></code></pre></div><p>After qboot (Headless Bliss):</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>$ ./qboot -d my-disk.qcow2
</span></span></code></pre></div><p>That&rsquo;s it. It just works. If I need to do some setup first:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>$ ./qboot -d my-disk.qcow2 -i
</span></span></code></pre></div><p>My QEMU headache is gone, replaced by the quiet hum of a tool that does exactly what I want.</p><p>So if you&rsquo;re tired of the command-line flag dance, maybe it&rsquo;s time to build your own cure. And hey, give D a look while you&rsquo;re at it. It might just be the pragmatic dragon you&rsquo;ve been searching for to tame your own command-line beasts! üê≤‚ú®</p><h2 id=-final-thoughts>üí≠ Final Thoughts<a hidden class=anchor aria-hidden=true href=#-final-thoughts>#</a></h2><p>Or: Why D Deserves a Second Look (Especially for CLI Tools!)</p><p>While D isn&rsquo;t going to replace Python or Go in popularity overnight, it absolutely hits a sweet spot for practical command-line utilities.</p><ul><li><p>Fast Compilation: D&rsquo;s reference compiler (DMD) is incredibly fast, making the &ldquo;edit-compile-run&rdquo; loop delightful.</p></li><li><p>Modern Features: It offers powerful language features that make expressive and safe code easy to write, without forcing you into complex paradigms.</p></li><li><p>Minimalist & Performant: You get the single-binary advantage of Go and Rust, with excellent runtime performance, but often with less code.</p></li></ul><p>So, the next time you&rsquo;re tired of wrestling with command-line options for your dev tools, or need a quick, performant, and easily deployable utility, give D a whirl. You might just find your own magical sidekick. ‚ú® It certainly saved my sanity from QEMU Tetris!</p><p>Project repository can be found at <a href=https://github.com/ilmanzo/qboot>https://github.com/ilmanzo/qboot</a> . Contributions are welcome!</p></div><footer class=post-footer><ul class=post-tags><li><a href=https://ilmanzo.github.io/tags/testing/>Testing</a></li><li><a href=https://ilmanzo.github.io/tags/tutorial/>Tutorial</a></li><li><a href=https://ilmanzo.github.io/tags/linux/>Linux</a></li><li><a href=https://ilmanzo.github.io/tags/dlang/>Dlang</a></li><li><a href=https://ilmanzo.github.io/tags/virtualization/>Virtualization</a></li><li><a href=https://ilmanzo.github.io/tags/emulation/>Emulation</a></li><li><a href=https://ilmanzo.github.io/tags/scripting/>Scripting</a></li></ul><nav class=paginav><a class=next href=https://ilmanzo.github.io/post/june_2025_conferences/><span class=title>Next ¬ª</span><br><span>June 2025 conferences recap</span></a></nav></footer></article></main><footer class=footer><span>¬© 2012-2025 Andrea Manzini</span> ¬∑
<span>Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
<a href=https://github.com/adityatelange/hugo-PaperMod/ rel=noopener target=_blank>PaperMod</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg viewBox="0 0 12 6" fill="currentColor"><path d="M12 6H0l6-6z"/></svg>
</a><script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))})</script><script>document.querySelectorAll("pre > code").forEach(e=>{const n=e.parentNode.parentNode,t=document.createElement("button");t.classList.add("copy-code"),t.innerHTML="copy";function s(){t.innerHTML="copied!",setTimeout(()=>{t.innerHTML="copy"},2e3)}t.addEventListener("click",t=>{if("clipboard"in navigator){navigator.clipboard.writeText(e.textContent),s();return}const n=document.createRange();n.selectNodeContents(e);const o=window.getSelection();o.removeAllRanges(),o.addRange(n);try{document.execCommand("copy"),s()}catch{}o.removeRange(n)}),n.classList.contains("highlight")?n.appendChild(t):n.parentNode.firstChild==n||(e.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName=="TABLE"?e.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(t):e.parentNode.appendChild(t))})</script></body></html>