<!doctype html><html lang=en dir=auto><head><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>simple and easy linux job queue | ilManzo's blog</title>
<meta name=keywords content="linux,script,job,queue,batch"><meta name=description content="exploiting linux printing queue facility to manage heterogeneous jobs"><meta name=author content="Andrea Manzini"><link rel=canonical href=https://ilmanzo.github.io/post/simple-easy-job-queue-linux/><link crossorigin=anonymous href=/assets/css/stylesheet.b609c58d5c11bb90b1a54e04005d74ad1ddf22165eb79f5533967e57df9c3b50.css integrity="sha256-tgnFjVwRu5CxpU4EAF10rR3fIhZet59VM5Z+V9+cO1A=" rel="preload stylesheet" as=style><link rel=icon href=https://ilmanzo.github.io/favicon.ico><link rel=icon type=image/png sizes=16x16 href=https://ilmanzo.github.io/favicon-16x16.png><link rel=icon type=image/png sizes=32x32 href=https://ilmanzo.github.io/favicon-32x32.png><link rel=apple-touch-icon href=https://ilmanzo.github.io/apple-touch-icon.png><link rel=mask-icon href=https://ilmanzo.github.io/safari-pinned-tab.svg><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><link rel=alternate hreflang=en href=https://ilmanzo.github.io/post/simple-easy-job-queue-linux/><noscript><style>#theme-toggle,.top-link{display:none}</style></noscript><script async src="https://www.googletagmanager.com/gtag/js?id=G-6PN4FTRLNL"></script><script>var dnt,doNotTrack=!1;if(!1&&(dnt=navigator.doNotTrack||window.doNotTrack||navigator.msDoNotTrack,doNotTrack=dnt=="1"||dnt=="yes"),!doNotTrack){window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-6PN4FTRLNL")}</script><meta property="og:title" content="simple and easy linux job queue"><meta property="og:description" content="exploiting linux printing queue facility to manage heterogeneous jobs"><meta property="og:type" content="article"><meta property="og:url" content="https://ilmanzo.github.io/post/simple-easy-job-queue-linux/"><meta property="article:section" content="post"><meta property="article:published_time" content="2015-12-21T00:00:00+00:00"><meta property="article:modified_time" content="2015-12-21T00:00:00+00:00"><meta name=twitter:card content="summary"><meta name=twitter:title content="simple and easy linux job queue"><meta name=twitter:description content="exploiting linux printing queue facility to manage heterogeneous jobs"><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Posts","item":"https://ilmanzo.github.io/post/"},{"@type":"ListItem","position":2,"name":"simple and easy linux job queue","item":"https://ilmanzo.github.io/post/simple-easy-job-queue-linux/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"simple and easy linux job queue","name":"simple and easy linux job queue","description":"exploiting linux printing queue facility to manage heterogeneous jobs","keywords":["linux","script","job","queue","batch"],"articleBody":"Recently I have been in a situation where I needed a simple ‘batch’ job scheduler, where I could submit some long-running tasks to a server and have a ‘system’ that serialize access the execution with some basic job control facilities (remove a job from the queue, stop the processing, and so on).\nLinux printing subsystem is already designed to do this, and we can exploit the CUPS printing subsystem to run our “batch” jobs.\nIn practice we need to create a “fake” printer who outputs to /dev/null, but when invoked its real job is executed in an “interface script” that is the real data manager. An example could be a script like this:\n#!/bin/sh # save this as file script.txt # this script replaces every occurrence of \"apple\" with \"banana\" inside a text file job=\"$1\" user=\"$2\" title=\"$3\" numcopies=\"$4\" options=\"$5\" filename=\"$6\" /usr/bin/logger \"starting script, got parameters: $1^$2^$3^$4^$5^$6\" /bin/sed s/apple/banana/g $filename \u003e /var/spool/lpd/fixed_$title /usr/bin/logger \"ending script\" to install this , we need to feed it to a new dummy definition:\nlpadmin -p converter -E -iscript.txt -vfile:/dev/null if we make some mistakes in the script, don’t forget to remove the printer before redefining it:\nlpadmin -x converter to test it, we prepare a simple text file:\n$ cat minion.txt I like apples I like apples very much More apples!! then we can “print” it with our new printer, making the script run doing it business…\n$ lp -d converter minion.txt request id is converter-28 (1 file(s)) …and inspect the output:\n$ cat /var/spool/lpd/fixed_minion.txt I like bananas I like bananas very much More bananas!! to inspect the queue, we can use the standard commands:\nlpstat -o # to check current running jobs lpstat -W completed # to check past jobs already finished to remove a job from the queue,\ncancel [id] converter cancel -a converter with this technique, you can easily prepare fake printers that manages AVI conversion, mp3 playing, ftp file upload… And any kind of long running task you can think about…\nEnjoy!\n","wordCount":"331","inLanguage":"en","datePublished":"2015-12-21T00:00:00Z","dateModified":"2015-12-21T00:00:00Z","author":{"@type":"Person","name":"Andrea Manzini"},"mainEntityOfPage":{"@type":"WebPage","@id":"https://ilmanzo.github.io/post/simple-easy-job-queue-linux/"},"publisher":{"@type":"Organization","name":"ilManzo's blog","logo":{"@type":"ImageObject","url":"https://ilmanzo.github.io/favicon.ico"}}}</script></head><body class=dark id=top><script>localStorage.getItem("pref-theme")==="light"&&document.body.classList.remove("dark")</script><header class=header><nav class=nav><div class=logo><a href=https://ilmanzo.github.io/ accesskey=h title="ilManzo's blog (Alt + H)">ilManzo's blog</a><div class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)"><svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></div></div><ul id=menu><li><a href=https://ilmanzo.github.io/curriculum title=Curriculum><span>Curriculum</span></a></li><li><a href=https://ilmanzo.github.io/tags title=Tags><span>Tags</span></a></li><li><a href=https://ilmanzo.github.io/categories title=Categories><span>Categories</span></a></li><li><a href=https://ilmanzo.github.io/search title="Search (Alt + /)" accesskey=/><span>Search</span></a></li><li><a href=https://ilmanzo.github.io/post/ title=Posts><span>Posts</span></a></li></ul></nav></header><main class=main><article class=post-single><header class=post-header><div class=breadcrumbs><a href=https://ilmanzo.github.io/>Home</a>&nbsp;»&nbsp;<a href=https://ilmanzo.github.io/post/>Posts</a></div><h1 class="post-title entry-hint-parent">simple and easy linux job queue</h1><div class=post-description>exploiting linux printing queue facility to manage heterogeneous jobs</div><div class=post-meta><span title='2015-12-21 00:00:00 +0000 UTC'>December 21, 2015</span>&nbsp;·&nbsp;Andrea Manzini</div></header><div class=post-content><p>Recently I have been in a situation where I needed a simple &lsquo;batch&rsquo; job scheduler, where I could submit some long-running tasks to a server and have a &lsquo;system&rsquo; that serialize access the execution with some basic job control facilities (remove a job from the queue, stop the processing, and so on).</p><p>Linux printing subsystem is already designed to do this, and we can exploit the CUPS printing subsystem to run our &ldquo;batch&rdquo; jobs.</p><p>In practice we need to create a &ldquo;fake&rdquo; printer who outputs to /dev/null, but when invoked its real job is executed in an &ldquo;interface script&rdquo; that is the real data manager. An example could be a script like this:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>  <span style=color:#75715e>#!/bin/sh</span>
</span></span><span style=display:flex><span>  <span style=color:#75715e># save this as file script.txt</span>
</span></span><span style=display:flex><span>  <span style=color:#75715e># this script replaces every occurrence of &#34;apple&#34; with &#34;banana&#34; inside a text file</span>
</span></span><span style=display:flex><span>  job<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;</span>$1<span style=color:#e6db74>&#34;</span>
</span></span><span style=display:flex><span>  user<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;</span>$2<span style=color:#e6db74>&#34;</span>
</span></span><span style=display:flex><span>  title<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;</span>$3<span style=color:#e6db74>&#34;</span>
</span></span><span style=display:flex><span>  numcopies<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;</span>$4<span style=color:#e6db74>&#34;</span>
</span></span><span style=display:flex><span>  options<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;</span>$5<span style=color:#e6db74>&#34;</span>
</span></span><span style=display:flex><span>  filename<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;</span>$6<span style=color:#e6db74>&#34;</span>
</span></span><span style=display:flex><span>  /usr/bin/logger <span style=color:#e6db74>&#34;starting script, got parameters: </span>$1<span style=color:#e6db74>^</span>$2<span style=color:#e6db74>^</span>$3<span style=color:#e6db74>^</span>$4<span style=color:#e6db74>^</span>$5<span style=color:#e6db74>^</span>$6<span style=color:#e6db74>&#34;</span>
</span></span><span style=display:flex><span>  /bin/sed s/apple/banana/g $filename &gt; /var/spool/lpd/fixed_$title
</span></span><span style=display:flex><span>  /usr/bin/logger <span style=color:#e6db74>&#34;ending script&#34;</span></span></span></code></pre></div><p>to install this , we need to feed it to a new dummy definition:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>  lpadmin -p converter -E -iscript.txt -vfile:/dev/null</span></span></code></pre></div><p>if we make some mistakes in the script, don&rsquo;t forget to remove the printer before redefining it:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>  lpadmin -x converter</span></span></code></pre></div><p>to test it, we prepare a simple text file:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>  $ cat minion.txt
</span></span><span style=display:flex><span>  I like apples
</span></span><span style=display:flex><span>  I like apples very much
</span></span><span style=display:flex><span>  More apples!!</span></span></code></pre></div><p>then we can &ldquo;print&rdquo; it with our new printer, making the script run doing it business&mldr;</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>  $ lp -d converter minion.txt
</span></span><span style=display:flex><span>  request id is converter-28 <span style=color:#f92672>(</span><span style=color:#ae81ff>1</span> file<span style=color:#f92672>(</span>s<span style=color:#f92672>))</span></span></span></code></pre></div><p>&mldr;and inspect the output:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>  $ cat /var/spool/lpd/fixed_minion.txt
</span></span><span style=display:flex><span>  I like bananas
</span></span><span style=display:flex><span>  I like bananas very much
</span></span><span style=display:flex><span>  More bananas!!</span></span></code></pre></div><p>to inspect the queue, we can use the standard commands:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>lpstat -o  <span style=color:#75715e># to check current running jobs</span>
</span></span><span style=display:flex><span>lpstat -W completed <span style=color:#75715e># to check past jobs already finished</span></span></span></code></pre></div><p>to remove a job from the queue,</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>cancel <span style=color:#f92672>[</span>id<span style=color:#f92672>]</span> converter
</span></span><span style=display:flex><span>cancel -a converter</span></span></code></pre></div><p>with this technique, you can easily prepare fake printers that manages AVI conversion, mp3 playing, ftp file upload&mldr; And any kind of long running task you can think about&mldr;</p><p>Enjoy!</p></div><footer class=post-footer><ul class=post-tags><li><a href=https://ilmanzo.github.io/tags/linux/>Linux</a></li><li><a href=https://ilmanzo.github.io/tags/script/>Script</a></li><li><a href=https://ilmanzo.github.io/tags/job/>Job</a></li><li><a href=https://ilmanzo.github.io/tags/queue/>Queue</a></li><li><a href=https://ilmanzo.github.io/tags/batch/>Batch</a></li></ul><nav class=paginav><a class=prev href=https://ilmanzo.github.io/post/golang-quota-monit-helper/><span class=title>« Prev</span><br><span>monit helper for quota monitoring in go</span>
</a><a class=next href=https://ilmanzo.github.io/post/serata-fablab/><span class=title>Next »</span><br><span>serata introduttiva al FabLab sulla programmazione Python</span></a></nav></footer></article></main><footer class=footer><span>© 2012-2024 Andrea Manzini</span> ·
<span>Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
        <a href=https://github.com/adityatelange/hugo-PaperMod/ rel=noopener target=_blank>PaperMod</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg>
</a><script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))})</script><script>document.querySelectorAll("pre > code").forEach(e=>{const n=e.parentNode.parentNode,t=document.createElement("button");t.classList.add("copy-code"),t.innerHTML="copy";function s(){t.innerHTML="copied!",setTimeout(()=>{t.innerHTML="copy"},2e3)}t.addEventListener("click",t=>{if("clipboard"in navigator){navigator.clipboard.writeText(e.textContent),s();return}const n=document.createRange();n.selectNodeContents(e);const o=window.getSelection();o.removeAllRanges(),o.addRange(n);try{document.execCommand("copy"),s()}catch{}o.removeRange(n)}),n.classList.contains("highlight")?n.appendChild(t):n.parentNode.firstChild==n||(e.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName=="TABLE"?e.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(t):e.parentNode.appendChild(t))})</script></body></html>