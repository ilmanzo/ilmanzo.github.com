<!doctype html><html lang=en dir=auto><head><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>Headless Testing of PySide/PyQt GUI Applications with pytest-qt | ilManzo's blog</title>
<meta name=keywords content="linux,python,tutorial,qt,testing,unit testing,gui,programming"><meta name=description content="An approach to headless testing of GUI programs"><meta name=author content="Andrea Manzini"><link rel=canonical href=https://ilmanzo.github.io/post/testing_pyside_gui_applications/><link crossorigin=anonymous href=/assets/css/stylesheet.f49d66caae9ea0fd43f21f29e71a8d3e284517ed770f2aa86fa012953ad3c9ef.css integrity="sha256-9J1myq6eoP1D8h8p5xqNPihFF+13Dyqob6ASlTrTye8=" rel="preload stylesheet" as=style><link rel=icon href=https://ilmanzo.github.io/favicon.ico><link rel=icon type=image/png sizes=16x16 href=https://ilmanzo.github.io/favicon-16x16.png><link rel=icon type=image/png sizes=32x32 href=https://ilmanzo.github.io/favicon-32x32.png><link rel=apple-touch-icon href=https://ilmanzo.github.io/apple-touch-icon.png><link rel=mask-icon href=https://ilmanzo.github.io/safari-pinned-tab.svg><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><link rel=alternate hreflang=en href=https://ilmanzo.github.io/post/testing_pyside_gui_applications/><noscript><style>#theme-toggle,.top-link{display:none}</style></noscript><script async src="https://www.googletagmanager.com/gtag/js?id=G-6PN4FTRLNL"></script><script>var dnt,doNotTrack=!1;if(!1&&(dnt=navigator.doNotTrack||window.doNotTrack||navigator.msDoNotTrack,doNotTrack=dnt=="1"||dnt=="yes"),!doNotTrack){window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-6PN4FTRLNL")}</script><meta property="og:url" content="https://ilmanzo.github.io/post/testing_pyside_gui_applications/"><meta property="og:site_name" content="ilManzo's blog"><meta property="og:title" content="Headless Testing of PySide/PyQt GUI Applications with pytest-qt"><meta property="og:description" content="An approach to headless testing of GUI programs"><meta property="og:locale" content="en-us"><meta property="og:type" content="article"><meta property="article:section" content="post"><meta property="article:published_time" content="2024-05-22T00:00:00+00:00"><meta property="article:modified_time" content="2024-05-22T00:00:00+00:00"><meta property="article:tag" content="Linux"><meta property="article:tag" content="Python"><meta property="article:tag" content="Tutorial"><meta property="article:tag" content="Qt"><meta property="article:tag" content="Testing"><meta property="article:tag" content="Unit Testing"><meta name=twitter:card content="summary"><meta name=twitter:title content="Headless Testing of PySide/PyQt GUI Applications with pytest-qt"><meta name=twitter:description content="An approach to headless testing of GUI programs"><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Posts","item":"https://ilmanzo.github.io/post/"},{"@type":"ListItem","position":2,"name":"Headless Testing of PySide/PyQt GUI Applications with pytest-qt","item":"https://ilmanzo.github.io/post/testing_pyside_gui_applications/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"Headless Testing of PySide/PyQt GUI Applications with pytest-qt","name":"Headless Testing of PySide\/PyQt GUI Applications with pytest-qt","description":"An approach to headless testing of GUI programs","keywords":["linux","python","tutorial","qt","testing","unit testing","gui","programming"],"articleBody":"ü§ì Intro Manual testing of GUI applications can become tedious and error-prone as features and complexity increase. Headless testing offers a solution by automating UI interactions without the need for a physical display. This approach allows for faster test execution, improved repeatability, and seamless integration with continuous integration and continuous delivery (CI/CD) pipelines. In this post, we‚Äôll explore how to leverage pytest-qt, a powerful framework for headless testing of PySide/PyQt applications.\nAs usual, all the code is available in my github repository.\nüßÆ Example As a starting point, let‚Äôs suppose we have a rather dummy app, comprising only two buttons and a label.\nYes, Towel Day is approaching.\nü§¨ The problem The application is quite simple, a numeric label that should be red when displaying odd numbers, green for even numbers. User can only increment or decrement the counter with the corresponding buttons.\nWhen we press +1 button, the number correctly increases:\nAn user kindly shows us the problem: when we press the -1 button, something weird is happening!\nProbably for this simple issue we can just inspect the code and find the error in no time, but as we are testers, we want to add some tests to our interactive application.\nüßë‚Äçüî¨ First test To validate the error, we are going to use the pytest-qt plugin for the pytest framework. Creating a test to reproduce the issue not only helps us to spot the specific problem, but contributes to build a growing test suite that will also prevent future regressions.\nLet‚Äôs start with a simple test: application should be able to start up, and initial counter value must be 42. With pytest, it‚Äôs just one function:\nfrom mainwindow import MainWindow def test_application_start(qtbot): widget = MainWindow() qtbot.addWidget(widget) assert widget.number == 42 qtbot is a rather cool Fixture provided by pytest-qt plugin, to ‚Äúrun‚Äù our app we just need to add our widget to the qtbot object.\ntest run:\n$ pytest =================== test session starts ====================== platform linux -- Python 3.11.9, pytest-8.2.1, pluggy-1.5.0 PySide6 6.7.0 -- Qt runtime 6.7.0 -- Qt compiled 6.7.0 rootdir: /home/andrea/projects/pyside-playground/testable_app configfile: pytest.ini plugins: qt-4.4.0 collected 1 item test_mainwindow.py . [100%] =================== 1 passed in 0.09s ======================== Success! As you can see, pytest-qt Fixture is handling for us all the gory details of instantiating a QApplication, running an event loop listening for signal/slots. The GUI doesn‚Äôt even get rendered on the screen, making this approach feasible to run also in an automated environment like a CI.\n‚úÖ Second test Let‚Äôs add a second test, we tell the application to ‚Äúpress‚Äù the +1 button and expect both right number and label color attribute:\nimport pytest from pytestqt.qt_compat import qt_api from mainwindow import MainWindow @pytest.fixture def widget(qtbot): widget = MainWindow() qtbot.addWidget(widget) return widget def test_application_start(qtbot, widget): assert widget.number == 42 def test_inc_button(qtbot, widget): # click in the + button and make sure it updates the numeric label qtbot.mouseClick(widget.ui.btnInc, qt_api.QtCore.Qt.MouseButton.LeftButton) assert widget.ui.lbl_number.text()==\"43\" assert \"background-color: red\" in widget.ui.lbl_number.styleSheet() We also refactored the common part, by providing a widget setup fixture that manages the initial state for each test. The second run is green as well:\n$ pytest =================== test session starts ====================== platform linux -- Python 3.11.9, pytest-8.2.1, pluggy-1.5.0 PySide6 6.7.0 -- Qt runtime 6.7.0 -- Qt compiled 6.7.0 rootdir: /home/andrea/projects/pyside-playground/testable_app configfile: pytest.ini plugins: qt-4.4.0 collected 2 items test_mainwindow.py .. [100%] =================== 2 passed in 0.09s ======================== üêû A failing test We miss only the third test, that should trigger the issue:\nimport pytest from pytestqt.qt_compat import qt_api from mainwindow import MainWindow @pytest.fixture def widget(qtbot): widget = MainWindow() qtbot.addWidget(widget) return widget def test_application_start(qtbot,widget): assert widget.number == 42 def test_inc_button(qtbot,widget): # click in the + button and make sure it updates the numeric label qtbot.mouseClick(widget.ui.btnInc, qt_api.QtCore.Qt.MouseButton.LeftButton) assert widget.ui.lbl_number.text()==\"43\" assert \"background-color: red\" in widget.ui.lbl_number.styleSheet() def test_dec_button(qtbot,widget): # click in the - button and make sure it updates the numeric label qtbot.mouseClick(widget.ui.btnDec, qt_api.QtCore.Qt.MouseButton.LeftButton) assert widget.ui.lbl_number.text()==\"41\" assert \"background-color: red\" in widget.ui.lbl_number.styleSheet() AHA! (bear with me, for a QA engineer a failing test is pure happiness)\n$ pytest =========================== test session starts ========================== platform linux -- Python 3.11.9, pytest-8.2.1, pluggy-1.5.0 PySide6 6.7.0 -- Qt runtime 6.7.0 -- Qt compiled 6.7.0 rootdir: /home/andrea/projects/pyside-playground/testable_app configfile: pytest.ini plugins: qt-4.4.0 collected 3 items test_mainwindow.py ..F [100%] =============================== FAILURES ================================= ___________________________ test_dec_button ______________________________ qtbot = widget = def test_dec_button(qtbot,widget): # click in the - button and make sure it updates the numeric label qtbot.mouseClick(widget.ui.btnDec, qt_api.QtCore.Qt.MouseButton.LeftButton) \u003e assert widget.ui.lbl_number.text()==\"41\" E AssertionError: assert '-1' == '41' E E - 41 E + -1 test_mainwindow.py:25: AssertionError ========================= short test summary info ========================= FAILED test_mainwindow.py::test_dec_button - AssertionError: assert '-1' == '41' ========================= 1 failed, 2 passed in 0.11s ===================== Pressing -1 we expect the label to say ‚Äú41‚Äù but it displays -1. In the test we can not only check the appearance of the label, but also inspect the internal application state and clarify if the wrong behaviour is caused by a typo or some logic bug.\n‚úçÔ∏è Wrapping up We found the error, and now it‚Äôs an easy fix. When the application is really complex, it‚Äôs very important to have a test suite that validates the interface behavior, because when complexity increases, manual testing gets repetitive and very error prone. For example we can easily validate that the number does not exceed limits:\ndef test_inc_button_10_times(qtbot,widget): # click 10 times the + button and make sure it updates the numeric label for i in range(10): qtbot.mouseClick(widget.ui.btnInc, qt_api.QtCore.Qt.MouseButton.LeftButton) assert widget.ui.lbl_number.text()==\"52\" assert \"background-color: green\" in widget.ui.lbl_number.styleSheet() def test_inc_button_100_times(qtbot,widget): # click 100 times the + button and make sure it updates the numeric label for i in range(100): qtbot.mouseClick(widget.ui.btnInc, qt_api.QtCore.Qt.MouseButton.LeftButton) assert widget.ui.lbl_number.text()==\"100\" These tests runs in 1/10th of a second and can save us from many future bugs.\nAs we‚Äôve seen, pytest-qt offers a powerful and efficient way to automate testing for PySide/PyQt GUI applications. With minimal code changes, we can achieve robust test coverage and ensure consistent application behavior. Feel free to explore the provided code example further and leverage pytest-qt in your own projects! For a deeper dive, consider exploring the official documentation for pytest-qt and pytest. While headless testing excels in functional validation, it‚Äôs important to remember that it might not cover all aspects of UI testing, such as visual layout verification.\nAs a final hint, remember to configure your pytest.ini with the exact flavor of the framework:\n$ cat pytest.ini [pytest] qt_api=pyside6 Enjoy!\n","wordCount":"1057","inLanguage":"en","datePublished":"2024-05-22T00:00:00Z","dateModified":"2024-05-22T00:00:00Z","author":{"@type":"Person","name":"Andrea Manzini"},"mainEntityOfPage":{"@type":"WebPage","@id":"https://ilmanzo.github.io/post/testing_pyside_gui_applications/"},"publisher":{"@type":"Organization","name":"ilManzo's blog","logo":{"@type":"ImageObject","url":"https://ilmanzo.github.io/favicon.ico"}}}</script></head><body class=dark id=top><script>localStorage.getItem("pref-theme")==="light"&&document.body.classList.remove("dark")</script><header class=header><nav class=nav><div class=logo><a href=https://ilmanzo.github.io/ accesskey=h title="ilManzo's blog (Alt + H)">ilManzo's blog</a><div class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)" aria-label="Toggle theme"><svg id="moon" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></div></div><ul id=menu><li><a href=https://ilmanzo.github.io/curriculum title=Curriculum><span>Curriculum</span></a></li><li><a href=https://ilmanzo.github.io/tags title=Tags><span>Tags</span></a></li><li><a href=https://ilmanzo.github.io/categories title=Categories><span>Categories</span></a></li><li><a href=https://ilmanzo.github.io/search title="Search (Alt + /)" accesskey=/><span>Search</span></a></li><li><a href=https://ilmanzo.github.io/post/ title=Posts><span>Posts</span></a></li></ul></nav></header><main class=main><article class=post-single><header class=post-header><div class=breadcrumbs><a href=https://ilmanzo.github.io/>Home</a>&nbsp;¬ª&nbsp;<a href=https://ilmanzo.github.io/post/>Posts</a></div><h1 class="post-title entry-hint-parent">Headless Testing of PySide/PyQt GUI Applications with pytest-qt</h1><div class=post-description>An approach to headless testing of GUI programs</div><div class=post-meta><span title='2024-05-22 00:00:00 +0000 UTC'>May 22, 2024</span>&nbsp;¬∑&nbsp;Andrea Manzini</div></header><div class=post-content><h2 id=-intro>ü§ì Intro<a hidden class=anchor aria-hidden=true href=#-intro>#</a></h2><p>Manual testing of GUI applications can become tedious and error-prone as features and complexity increase. Headless testing offers a solution by automating UI interactions without the need for a physical display. This approach allows for faster test execution, improved repeatability, and seamless integration with continuous integration and continuous delivery (CI/CD) pipelines. In this post, we&rsquo;ll explore how to leverage pytest-qt, a powerful framework for headless testing of <a href=https://wiki.qt.io/Qt_for_Python>PySide/PyQt</a> applications.</p><p>As usual, all the code is available in my <a href=https://github.com/ilmanzo/pyside-playground/tree/master/testable_app>github repository</a>.</p><h2 id=-example>üßÆ Example<a hidden class=anchor aria-hidden=true href=#-example>#</a></h2><p>As a starting point, let&rsquo;s suppose we have a rather dummy app, comprising only two buttons and a label.</p><p><img alt=crappycounter0 loading=lazy src=/img/crappycounter0.png></p><p>Yes, <a href=https://en.wikipedia.org/wiki/Towel_Day>Towel Day</a> is approaching.</p><h2 id=-the-problem>ü§¨ The problem<a hidden class=anchor aria-hidden=true href=#-the-problem>#</a></h2><p>The application is quite simple, a numeric label that should be red when displaying odd numbers, green for even numbers.
User can only increment or decrement the counter with the corresponding buttons.</p><p>When we press <code>+1</code> button, the number correctly increases:</p><p><img alt=crappycounter1 loading=lazy src=/img/crappycounter1.png></p><p>An user kindly shows us the problem: when we press the <code>-1</code> button, <em>something weird is happening!</em></p><p><img alt=crappycounter2 loading=lazy src=/img/crappycounter2.png></p><p>Probably for this simple issue we can just inspect the code and find the error in no time, but as we are testers, we want to add some tests to our interactive application.</p><h2 id=-first-test>üßë‚Äçüî¨ First test<a hidden class=anchor aria-hidden=true href=#-first-test>#</a></h2><p>To validate the error, we are going to use the <a href=https://pytest-qt.readthedocs.io/en/latest/>pytest-qt</a> plugin for the <a href=https://docs.pytest.org/>pytest</a> framework.
Creating a test to reproduce the issue not only helps us to spot the specific problem, but contributes to build a growing test suite that will also prevent future regressions.</p><p>Let&rsquo;s start with a simple test: application should be able to start up, and initial counter value must be 42.
With <code>pytest</code>, it&rsquo;s just one function:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#f92672>from</span> mainwindow <span style=color:#f92672>import</span> MainWindow
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>def</span> <span style=color:#a6e22e>test_application_start</span>(qtbot):
</span></span><span style=display:flex><span>    widget <span style=color:#f92672>=</span> MainWindow()
</span></span><span style=display:flex><span>    qtbot<span style=color:#f92672>.</span>addWidget(widget)
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>assert</span> widget<span style=color:#f92672>.</span>number <span style=color:#f92672>==</span> <span style=color:#ae81ff>42</span></span></span></code></pre></div><p><code>qtbot</code> is a rather cool <em>Fixture</em> provided by <code>pytest-qt</code> plugin, to &ldquo;run&rdquo; our app we just need to add our widget to the <code>qtbot</code> object.</p><p>test run:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-fallback data-lang=fallback><span style=display:flex><span>$ pytest                                          
</span></span><span style=display:flex><span>=================== test session starts ======================
</span></span><span style=display:flex><span>platform linux -- Python 3.11.9, pytest-8.2.1, pluggy-1.5.0
</span></span><span style=display:flex><span>PySide6 6.7.0 -- Qt runtime 6.7.0 -- Qt compiled 6.7.0
</span></span><span style=display:flex><span>rootdir: /home/andrea/projects/pyside-playground/testable_app
</span></span><span style=display:flex><span>configfile: pytest.ini
</span></span><span style=display:flex><span>plugins: qt-4.4.0
</span></span><span style=display:flex><span>collected 1 item  
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>test_mainwindow.py .                                    [100%]
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>=================== 1 passed in 0.09s ========================
</span></span></code></pre></div><p>Success! As you can see, <code>pytest-qt</code> <em>Fixture</em> is handling for us all the gory details of instantiating a <em>QApplication</em>, running an event loop listening for signal/slots. The GUI doesn&rsquo;t even get rendered on the screen, making this approach feasible to run also in an automated environment like a CI.</p><h2 id=-second-test>‚úÖ Second test<a hidden class=anchor aria-hidden=true href=#-second-test>#</a></h2><p>Let&rsquo;s add a second test, we tell the application to &ldquo;press&rdquo; the +1 button and expect both right number and label color attribute:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#f92672>import</span> pytest
</span></span><span style=display:flex><span><span style=color:#f92672>from</span> pytestqt.qt_compat <span style=color:#f92672>import</span> qt_api
</span></span><span style=display:flex><span><span style=color:#f92672>from</span> mainwindow <span style=color:#f92672>import</span> MainWindow
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>@pytest.fixture</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>def</span> <span style=color:#a6e22e>widget</span>(qtbot):
</span></span><span style=display:flex><span>    widget <span style=color:#f92672>=</span> MainWindow()
</span></span><span style=display:flex><span>    qtbot<span style=color:#f92672>.</span>addWidget(widget)
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> widget
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>def</span> <span style=color:#a6e22e>test_application_start</span>(qtbot, widget):
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>assert</span> widget<span style=color:#f92672>.</span>number <span style=color:#f92672>==</span> <span style=color:#ae81ff>42</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>def</span> <span style=color:#a6e22e>test_inc_button</span>(qtbot, widget):
</span></span><span style=display:flex><span>    <span style=color:#75715e># click in the + button and make sure it updates the numeric label</span>
</span></span><span style=display:flex><span>    qtbot<span style=color:#f92672>.</span>mouseClick(widget<span style=color:#f92672>.</span>ui<span style=color:#f92672>.</span>btnInc, qt_api<span style=color:#f92672>.</span>QtCore<span style=color:#f92672>.</span>Qt<span style=color:#f92672>.</span>MouseButton<span style=color:#f92672>.</span>LeftButton)
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>assert</span> widget<span style=color:#f92672>.</span>ui<span style=color:#f92672>.</span>lbl_number<span style=color:#f92672>.</span>text()<span style=color:#f92672>==</span><span style=color:#e6db74>&#34;43&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>assert</span> <span style=color:#e6db74>&#34;background-color: red&#34;</span> <span style=color:#f92672>in</span> widget<span style=color:#f92672>.</span>ui<span style=color:#f92672>.</span>lbl_number<span style=color:#f92672>.</span>styleSheet()</span></span></code></pre></div><p>We also refactored the common part, by providing a widget <code>setup</code> fixture that manages the initial state for each test.
The second run is green as well:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-fallback data-lang=fallback><span style=display:flex><span>$ pytest                                          
</span></span><span style=display:flex><span>=================== test session starts ======================
</span></span><span style=display:flex><span>platform linux -- Python 3.11.9, pytest-8.2.1, pluggy-1.5.0
</span></span><span style=display:flex><span>PySide6 6.7.0 -- Qt runtime 6.7.0 -- Qt compiled 6.7.0
</span></span><span style=display:flex><span>rootdir: /home/andrea/projects/pyside-playground/testable_app
</span></span><span style=display:flex><span>configfile: pytest.ini
</span></span><span style=display:flex><span>plugins: qt-4.4.0
</span></span><span style=display:flex><span>collected 2 items    
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>test_mainwindow.py ..                                   [100%]
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>=================== 2 passed in 0.09s ========================
</span></span></code></pre></div><h2 id=-a-failing-test>üêû A failing test<a hidden class=anchor aria-hidden=true href=#-a-failing-test>#</a></h2><p>We miss only the third test, that should trigger the issue:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#f92672>import</span> pytest
</span></span><span style=display:flex><span><span style=color:#f92672>from</span> pytestqt.qt_compat <span style=color:#f92672>import</span> qt_api
</span></span><span style=display:flex><span><span style=color:#f92672>from</span> mainwindow <span style=color:#f92672>import</span> MainWindow
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>@pytest.fixture</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>def</span> <span style=color:#a6e22e>widget</span>(qtbot):
</span></span><span style=display:flex><span>    widget <span style=color:#f92672>=</span> MainWindow()
</span></span><span style=display:flex><span>    qtbot<span style=color:#f92672>.</span>addWidget(widget)
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> widget
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>def</span> <span style=color:#a6e22e>test_application_start</span>(qtbot,widget):
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>assert</span> widget<span style=color:#f92672>.</span>number <span style=color:#f92672>==</span> <span style=color:#ae81ff>42</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>def</span> <span style=color:#a6e22e>test_inc_button</span>(qtbot,widget):
</span></span><span style=display:flex><span>    <span style=color:#75715e># click in the + button and make sure it updates the numeric label</span>
</span></span><span style=display:flex><span>    qtbot<span style=color:#f92672>.</span>mouseClick(widget<span style=color:#f92672>.</span>ui<span style=color:#f92672>.</span>btnInc, qt_api<span style=color:#f92672>.</span>QtCore<span style=color:#f92672>.</span>Qt<span style=color:#f92672>.</span>MouseButton<span style=color:#f92672>.</span>LeftButton)
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>assert</span> widget<span style=color:#f92672>.</span>ui<span style=color:#f92672>.</span>lbl_number<span style=color:#f92672>.</span>text()<span style=color:#f92672>==</span><span style=color:#e6db74>&#34;43&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>assert</span> <span style=color:#e6db74>&#34;background-color: red&#34;</span> <span style=color:#f92672>in</span> widget<span style=color:#f92672>.</span>ui<span style=color:#f92672>.</span>lbl_number<span style=color:#f92672>.</span>styleSheet()
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>def</span> <span style=color:#a6e22e>test_dec_button</span>(qtbot,widget):
</span></span><span style=display:flex><span>    <span style=color:#75715e># click in the - button and make sure it updates the numeric label</span>
</span></span><span style=display:flex><span>    qtbot<span style=color:#f92672>.</span>mouseClick(widget<span style=color:#f92672>.</span>ui<span style=color:#f92672>.</span>btnDec, qt_api<span style=color:#f92672>.</span>QtCore<span style=color:#f92672>.</span>Qt<span style=color:#f92672>.</span>MouseButton<span style=color:#f92672>.</span>LeftButton)
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>assert</span> widget<span style=color:#f92672>.</span>ui<span style=color:#f92672>.</span>lbl_number<span style=color:#f92672>.</span>text()<span style=color:#f92672>==</span><span style=color:#e6db74>&#34;41&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>assert</span> <span style=color:#e6db74>&#34;background-color: red&#34;</span> <span style=color:#f92672>in</span> widget<span style=color:#f92672>.</span>ui<span style=color:#f92672>.</span>lbl_number<span style=color:#f92672>.</span>styleSheet()</span></span></code></pre></div><p><strong>AHA!</strong>
(bear with me, for a QA engineer a failing test is pure happiness)</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-fallback data-lang=fallback><span style=display:flex><span>$ pytest
</span></span><span style=display:flex><span>=========================== test session starts ==========================
</span></span><span style=display:flex><span>platform linux -- Python 3.11.9, pytest-8.2.1, pluggy-1.5.0
</span></span><span style=display:flex><span>PySide6 6.7.0 -- Qt runtime 6.7.0 -- Qt compiled 6.7.0
</span></span><span style=display:flex><span>rootdir: /home/andrea/projects/pyside-playground/testable_app
</span></span><span style=display:flex><span>configfile: pytest.ini
</span></span><span style=display:flex><span>plugins: qt-4.4.0
</span></span><span style=display:flex><span>collected 3 items     
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>test_mainwindow.py ..F                                              [100%]
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>=============================== FAILURES =================================
</span></span><span style=display:flex><span>___________________________ test_dec_button ______________________________
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>qtbot = &lt;pytestqt.qtbot.QtBot object at 0x7fc7912d1210&gt;
</span></span><span style=display:flex><span>widget = &lt;mainwindow.MainWindow(0x5615c0cb2ae0, name=&#34;MainWindow&#34;) at 0x7fc7912d1580&gt;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    def test_dec_button(qtbot,widget):
</span></span><span style=display:flex><span>        # click in the - button and make sure it updates the numeric label
</span></span><span style=display:flex><span>        qtbot.mouseClick(widget.ui.btnDec, qt_api.QtCore.Qt.MouseButton.LeftButton)
</span></span><span style=display:flex><span>&gt;       assert widget.ui.lbl_number.text()==&#34;41&#34;
</span></span><span style=display:flex><span>E       AssertionError: assert &#39;-1&#39; == &#39;41&#39;
</span></span><span style=display:flex><span>E         
</span></span><span style=display:flex><span>E         - 41
</span></span><span style=display:flex><span>E         + -1
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>test_mainwindow.py:25: AssertionError
</span></span><span style=display:flex><span>========================= short test summary info =========================
</span></span><span style=display:flex><span>FAILED test_mainwindow.py::test_dec_button - AssertionError: assert &#39;-1&#39; == &#39;41&#39;
</span></span><span style=display:flex><span>========================= 1 failed, 2 passed in 0.11s =====================
</span></span></code></pre></div><p>Pressing <code>-1</code> we expect the label to say &ldquo;41&rdquo; but it displays <code>-1</code>. In the test we can not only check the appearance of the label, but also inspect the internal application state and clarify if the wrong behaviour is caused by a typo or some logic bug.</p><h2 id=-wrapping-up>‚úçÔ∏è Wrapping up<a hidden class=anchor aria-hidden=true href=#-wrapping-up>#</a></h2><p>We found the error, and now it&rsquo;s an easy fix. When the application is really complex, it&rsquo;s very important to have a test suite that validates the interface behavior, because when complexity increases, manual testing gets repetitive and very error prone. For example we can easily validate that the number does not exceed limits:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#66d9ef>def</span> <span style=color:#a6e22e>test_inc_button_10_times</span>(qtbot,widget):
</span></span><span style=display:flex><span>    <span style=color:#75715e># click 10 times the + button and make sure it updates the numeric label</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>for</span> i <span style=color:#f92672>in</span> range(<span style=color:#ae81ff>10</span>):
</span></span><span style=display:flex><span>        qtbot<span style=color:#f92672>.</span>mouseClick(widget<span style=color:#f92672>.</span>ui<span style=color:#f92672>.</span>btnInc, qt_api<span style=color:#f92672>.</span>QtCore<span style=color:#f92672>.</span>Qt<span style=color:#f92672>.</span>MouseButton<span style=color:#f92672>.</span>LeftButton)
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>assert</span> widget<span style=color:#f92672>.</span>ui<span style=color:#f92672>.</span>lbl_number<span style=color:#f92672>.</span>text()<span style=color:#f92672>==</span><span style=color:#e6db74>&#34;52&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>assert</span> <span style=color:#e6db74>&#34;background-color: green&#34;</span> <span style=color:#f92672>in</span> widget<span style=color:#f92672>.</span>ui<span style=color:#f92672>.</span>lbl_number<span style=color:#f92672>.</span>styleSheet()
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>def</span> <span style=color:#a6e22e>test_inc_button_100_times</span>(qtbot,widget):
</span></span><span style=display:flex><span>    <span style=color:#75715e># click 100 times the + button and make sure it updates the numeric label</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>for</span> i <span style=color:#f92672>in</span> range(<span style=color:#ae81ff>100</span>):
</span></span><span style=display:flex><span>        qtbot<span style=color:#f92672>.</span>mouseClick(widget<span style=color:#f92672>.</span>ui<span style=color:#f92672>.</span>btnInc, qt_api<span style=color:#f92672>.</span>QtCore<span style=color:#f92672>.</span>Qt<span style=color:#f92672>.</span>MouseButton<span style=color:#f92672>.</span>LeftButton)
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>assert</span> widget<span style=color:#f92672>.</span>ui<span style=color:#f92672>.</span>lbl_number<span style=color:#f92672>.</span>text()<span style=color:#f92672>==</span><span style=color:#e6db74>&#34;100&#34;</span></span></span></code></pre></div><p>These tests runs in 1/10th of a second and can save us from many future bugs.</p><p>As we&rsquo;ve seen, pytest-qt offers a powerful and efficient way to automate testing for PySide/PyQt GUI applications. With minimal code changes, we can achieve robust test coverage and ensure consistent application behavior. Feel free to explore the provided code example further and leverage pytest-qt in your own projects! For a deeper dive, consider exploring the official documentation for <a href=https://readthedocs.org/projects/pytest/>pytest-qt</a> and <a href=https://docs.pytest.org/en/latest/contents.html>pytest</a>. While headless testing excels in functional validation, it&rsquo;s important to remember that it might not cover all aspects of UI testing, such as visual layout verification.</p><p>As a final hint, remember to configure your <code>pytest.ini</code> with the exact flavor of the framework:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>$ cat pytest.ini 
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>pytest<span style=color:#f92672>]</span>
</span></span><span style=display:flex><span>qt_api<span style=color:#f92672>=</span>pyside6
</span></span></code></pre></div><p>Enjoy!</p></div><footer class=post-footer><ul class=post-tags><li><a href=https://ilmanzo.github.io/tags/linux/>Linux</a></li><li><a href=https://ilmanzo.github.io/tags/python/>Python</a></li><li><a href=https://ilmanzo.github.io/tags/tutorial/>Tutorial</a></li><li><a href=https://ilmanzo.github.io/tags/qt/>Qt</a></li><li><a href=https://ilmanzo.github.io/tags/testing/>Testing</a></li><li><a href=https://ilmanzo.github.io/tags/unit-testing/>Unit Testing</a></li><li><a href=https://ilmanzo.github.io/tags/gui/>Gui</a></li><li><a href=https://ilmanzo.github.io/tags/programming/>Programming</a></li></ul><nav class=paginav><a class=prev href=https://ilmanzo.github.io/post/measure_your_power_consumption/><span class=title>¬´ Prev</span><br><span>Measure your program's power consumption</span>
</a><a class=next href=https://ilmanzo.github.io/post/first_steps_with_golang_tui/><span class=title>Next ¬ª</span><br><span>A different approach to terminal user interfaces</span></a></nav></footer></article></main><footer class=footer><span>¬© 2012-2024 Andrea Manzini</span> ¬∑
<span>Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
        <a href=https://github.com/adityatelange/hugo-PaperMod/ rel=noopener target=_blank>PaperMod</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg>
</a><script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))})</script><script>document.querySelectorAll("pre > code").forEach(e=>{const n=e.parentNode.parentNode,t=document.createElement("button");t.classList.add("copy-code"),t.innerHTML="copy";function s(){t.innerHTML="copied!",setTimeout(()=>{t.innerHTML="copy"},2e3)}t.addEventListener("click",t=>{if("clipboard"in navigator){navigator.clipboard.writeText(e.textContent),s();return}const n=document.createRange();n.selectNodeContents(e);const o=window.getSelection();o.removeAllRanges(),o.addRange(n);try{document.execCommand("copy"),s()}catch{}o.removeRange(n)}),n.classList.contains("highlight")?n.appendChild(t):n.parentNode.firstChild==n||(e.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName=="TABLE"?e.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(t):e.parentNode.appendChild(t))})</script></body></html>